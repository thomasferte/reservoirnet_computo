<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas Ferté">
<meta name="author" content="Kalidou Ba">
<meta name="author" content="Dan Dutartre">
<meta name="author" content="Pierrick Legrand">
<meta name="author" content="Vianney Jouhet">
<meta name="author" content="Rodolphe Thiébaut">
<meta name="author" content="Xavier Hinaut">
<meta name="author" content="Boris Hejblum">
<meta name="dcterms.date" content="2025-04-14">
<meta name="keywords" content="Reservoir Computing, Covid-19, Electronic Health Records, Time series">

<title>Reservoir Computing in R: a Tutorial for Using reservoirnet to Predict Complex Time-Series</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="template-computo-R_files/libs/clipboard/clipboard.min.js"></script>
<script src="template-computo-R_files/libs/quarto-html/quarto.js"></script>
<script src="template-computo-R_files/libs/quarto-html/popper.min.js"></script>
<script src="template-computo-R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="template-computo-R_files/libs/quarto-html/anchor.min.js"></script>
<link href="template-computo-R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="template-computo-R_files/libs/quarto-html/quarto-syntax-highlighting-7fd0fe4245b865325b8ce8dccb604d59.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="template-computo-R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="template-computo-R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="template-computo-R_files/libs/bootstrap/bootstrap-5f1fb0355f74790845d18183fcf83f78.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="template-computo-R_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="template-computo-R_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #FFFFFF;
      }

      .quarto-title-block .quarto-title-banner {
        color: #FFFFFF;
background: #034E79;
      }
</style>
<meta name="quarto:status" content="draft">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><a href="https://computo.sfds.asso.fr">
        <img src="https://computo.sfds.asso.fr/assets/img/logo_notext_white.png" height="60px">
      </a> &nbsp; Reservoir Computing in R: a Tutorial for Using reservoirnet to Predict Complex Time-Series</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> source</button></div></div>
            <p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/80x15.png" alt="Creative Commons BY License"></a>
ISSN 2824-7795</p>
                </div>
  </div>
    
    <div class="quarto-title-meta-author">
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-heading">Affiliations</div>
          
          <div class="quarto-title-meta-contents">
        Thomas Ferté <a href="https://orcid.org/0000-0001-8455-4665" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inserm, Inria
                </p>
              <p class="affiliation">
                  CHU de Bordeaux
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Kalidou Ba <a href="https://orcid.org/0000-0001-6552-265X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inserm, Inria
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Dan Dutartre <a href="https://orcid.org/0000-0001-8210-461X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inria
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Pierrick Legrand 
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inria
                </p>
              <p class="affiliation">
                  IMB
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Vianney Jouhet <a href="https://orcid.org/0000-0001-5272-2265" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inserm
                </p>
              <p class="affiliation">
                  CHU de Bordeaux
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Rodolphe Thiébaut <a href="https://orcid.org/0000-0002-5235-3962" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inserm, Inria
                </p>
              <p class="affiliation">
                  CHU de Bordeaux
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Xavier Hinaut <a href="https://orcid.org/0000-0002-1924-1184" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inria
                </p>
              <p class="affiliation">
                  CNRS
                </p>
              <p class="affiliation">
                  LaBRI
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        Boris Hejblum <a href="https://orcid.org/0000-0003-0646-452X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Inserm, Inria
                </p>
            </div>
        </div>
                    
  <div class="quarto-title-meta">
                                
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 14, 2025</p>
      </div>
    </div>
                                    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">April 14, 2025</p>
      </div>
    </div>
      
                  
      <div>
      <div class="quarto-title-meta-heading">Keywords</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Reservoir Computing, Covid-19, Electronic Health Records, Time series</p>
      </div>
    </div>
    
    <div>
      <div class="quarto-title-meta-heading">Status</div>
      <div class="quarto-title-meta-contents">
              <p class="date">draft</p>
                  </div>
    </div>

  </div>
                                                
  <div>
    <div class="abstract">
    <div class="abstract-title">Abstract</div>
      <p>Reservoir Computing (RC) is a machine learning method based on neural networks that efficiently process information generated by dynamical systems. It has been successful in solving various tasks including time series forecasting, language processing or voice processing. RC is implemented in <code>Python</code> and <code>Julia</code> but not in <code>R</code>. This article introduces <code>reservoirnet</code>, an <code>R</code> package providing access to the <code>Python</code> API <code>ReservoirPy</code>, allowing <code>R</code> users to harness the power of reservoir computing. This article provides an introduction to the fundamentals of RC and showcases its real-world applicability through three distinct sections. First, we cover the foundational concepts of RC, setting the stage for understanding its capabilities. Next, we delve into the practical usage of <code>reservoirnet</code> through two illustrative examples. These examples demonstrate how it can be applied to real-world problems, specifically, regression of COVID-19 hospitalizations and classification of Japanese vowels. Finally, we present a comprehensive analysis of a real-world application of <code>reservoirnet</code>, where it was used to forecast COVID-19 hospitalizations at Bordeaux University Hospital using public data and electronic health records.</p>
    </div>
  </div>

  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#sec-rcpresentation" id="toc-sec-rcpresentation" class="nav-link" data-scroll-target="#sec-rcpresentation"><span class="header-section-number">2</span> RC presentation</a></li>
  <li><a href="#sec-basicpackageuse" id="toc-sec-basicpackageuse" class="nav-link" data-scroll-target="#sec-basicpackageuse"><span class="header-section-number">3</span> Usage workflow</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation"><span class="header-section-number">3.1</span> Installation</a></li>
  <li><a href="#package-workflow-overview" id="toc-package-workflow-overview" class="nav-link" data-scroll-target="#package-workflow-overview"><span class="header-section-number">3.2</span> Package workflow overview</a></li>
  <li><a href="#sec-basicregression" id="toc-sec-basicregression" class="nav-link" data-scroll-target="#sec-basicregression"><span class="header-section-number">3.3</span> Basic regression use-case</a>
  <ul class="collapse">
  <li><a href="#covid-19-data" id="toc-covid-19-data" class="nav-link" data-scroll-target="#covid-19-data"><span class="header-section-number">3.3.1</span> Covid-19 data</a></li>
  <li><a href="#first-reservoir" id="toc-first-reservoir" class="nav-link" data-scroll-target="#first-reservoir"><span class="header-section-number">3.3.2</span> First reservoir</a></li>
  <li><a href="#forecast" id="toc-forecast" class="nav-link" data-scroll-target="#forecast"><span class="header-section-number">3.3.3</span> Forecast</a></li>
  </ul></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">3.4</span> Classification</a>
  <ul class="collapse">
  <li><a href="#the-japanese-vowel-dataset" id="toc-the-japanese-vowel-dataset" class="nav-link" data-scroll-target="#the-japanese-vowel-dataset"><span class="header-section-number">3.4.1</span> The Japanese vowel dataset</a></li>
  <li><a href="#classification-sequence-to-vector-model" id="toc-classification-sequence-to-vector-model" class="nav-link" data-scroll-target="#classification-sequence-to-vector-model"><span class="header-section-number">3.4.2</span> Classification (sequence-to-vector model)</a></li>
  <li><a href="#transduction-sequence-to-sequence-model" id="toc-transduction-sequence-to-sequence-model" class="nav-link" data-scroll-target="#transduction-sequence-to-sequence-model"><span class="header-section-number">3.4.3</span> Transduction (sequence-to-sequence model)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-studycase" id="toc-sec-studycase" class="nav-link" data-scroll-target="#sec-studycase"><span class="header-section-number">4</span> Avanced case-study: Covid-19 hospitalizations forecast</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="header-section-number">4.1</span> Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">4.2</span> Methods</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">4.2.1</span> Data</a></li>
  <li><a href="#evaluation-framework" id="toc-evaluation-framework" class="nav-link" data-scroll-target="#evaluation-framework"><span class="header-section-number">4.2.2</span> Evaluation framework</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models"><span class="header-section-number">4.2.3</span> Models</a></li>
  <li><a href="#hyperparameter-optimisation-using-random-search" id="toc-hyperparameter-optimisation-using-random-search" class="nav-link" data-scroll-target="#hyperparameter-optimisation-using-random-search"><span class="header-section-number">4.2.4</span> Hyperparameter optimisation using random search</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">4.3</span> Results</a>
  <ul class="collapse">
  <li><a href="#hyperparameter-selection" id="toc-hyperparameter-selection" class="nav-link" data-scroll-target="#hyperparameter-selection"><span class="header-section-number">4.3.1</span> Hyperparameter selection</a></li>
  <li><a href="#forecast-performance" id="toc-forecast-performance" class="nav-link" data-scroll-target="#forecast-performance"><span class="header-section-number">4.3.2</span> Forecast performance</a></li>
  <li><a href="#number-of-model-to-aggregate" id="toc-number-of-model-to-aggregate" class="nav-link" data-scroll-target="#number-of-model-to-aggregate"><span class="header-section-number">4.3.3</span> Number of model to aggregate</a></li>
  <li><a href="#input-feature-importance" id="toc-input-feature-importance" class="nav-link" data-scroll-target="#input-feature-importance"><span class="header-section-number">4.3.4</span> Input feature importance</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">4.4</span> Discussion</a></li>
  </ul></li>
  <li><a href="#sec-discussion-and-conclusion" id="toc-sec-discussion-and-conclusion" class="nav-link" data-scroll-target="#sec-discussion-and-conclusion"><span class="header-section-number">5</span> Discussion and conclusion</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="template-computo-R.pdf"><i class="bi bi-file-pdf"></i>PDF (computo)</a></li></ul></div></nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Reservoir Computing (RC) is a prominent machine learning method, proposed by <span class="citation" data-cites="jaeger__2001">Jaeger (<a href="#ref-jaeger__2001" role="doc-biblioref">2001</a>)</span>, <span class="citation" data-cites="maass_real-time_2002">Maass, Natschläger, and Markram (<a href="#ref-maass_real-time_2002" role="doc-biblioref">2002</a>)</span> and <span class="citation" data-cites="lukosevicius_reservoir_2009">Lukoševičius and Jaeger (<a href="#ref-lukosevicius_reservoir_2009" role="doc-biblioref">2009</a>)</span> that has gained significant attention in recent years for its ability to efficiently process information generated by dynamical systems. This innovative approach leverages the dynamics of a high-dimensional “reservoir” (we define it below) to perform complex computations and solve various tasks based on the response of this dynamical system to input signals. RC has demonstrated its efficacy in tackling various challenges, encompassing pattern classification and time series forecasting in applications ranging from electrocardiogram analysis to bird calls <span class="citation" data-cites="trouvain_canary_2021">(<a href="#ref-trouvain_canary_2021" role="doc-biblioref">Trouvain and Hinaut 2021</a>)</span>, language processing <span class="citation" data-cites="hinaut_real-time_2013">(<a href="#ref-hinaut_real-time_2013" role="doc-biblioref">Hinaut and Dominey 2013</a>)</span>, power plants, internet traffic, stock prices, and beyond <span class="citation" data-cites="lukosevicius_reservoir_2009 tanaka_recent_2019">(<a href="#ref-lukosevicius_reservoir_2009" role="doc-biblioref">Lukoševičius and Jaeger 2009</a>; <a href="#ref-tanaka_recent_2019" role="doc-biblioref">Tanaka et al. 2019</a>)</span>.</p>
<p>Originally, the RC paradigm was implemented in artificial firing-rate neurons (“Echo State Networks”, <span class="citation" data-cites="jaeger__2001">Jaeger (<a href="#ref-jaeger__2001" role="doc-biblioref">2001</a>)</span>) and spiking neurons (“Liquid State Machine”, <span class="citation" data-cites="maass_real-time_2002">Maass, Natschläger, and Markram (<a href="#ref-maass_real-time_2002" role="doc-biblioref">2002</a>)</span>) as a recurrent neural network (RNN) where the internal recurrent connections, denoted as the reservoir, are randomly generated and only the output layer (named “read-out”) is trained. The reservoir projects temporal input signals onto a high-dimensional feature space, facilitating the learning of non-linear and temporal interactions. Thus, this recurrent layer contains high-dimensional non-linear recombination of the inputs and past states: it is a “reservoir of computations” from which useful information can be linearly extracted (or “read-out”) to provide the desired outputs. This offers the advantage of decreasing the computing time compared to conventional RNNs while consistently maintaining performance <span class="citation" data-cites="vlachas_backpropagation_2020">(<a href="#ref-vlachas_backpropagation_2020" role="doc-biblioref">Vlachas et al. 2020</a>)</span>. Besides, this RC paradigm fostered increasing interest thanks to its ability to be implemented on classical computers, as the hidden recurrent layer can be kept untrained. A wide range of physical media can be also used to replace it and <span class="citation" data-cites="tanaka_recent_2019">Tanaka et al. (<a href="#ref-tanaka_recent_2019" role="doc-biblioref">2019</a>)</span> recently reviewed this prolific field: from FPGA hardware <span class="citation" data-cites="penkovsky_efficient_2018">(<a href="#ref-penkovsky_efficient_2018" role="doc-biblioref">Penkovsky, Larger, and Brunner 2018</a>)</span>, to spin waves using magnetic properties <span class="citation" data-cites="nakane_reservoir_2018">(<a href="#ref-nakane_reservoir_2018" role="doc-biblioref">Nakane, Tanaka, and Hirose 2018</a>)</span>, skrymions <span class="citation" data-cites="prychynenko_magnetic_2018">(<a href="#ref-prychynenko_magnetic_2018" role="doc-biblioref">Prychynenko et al. 2018</a>)</span> or optical implementations <span class="citation" data-cites="rafayelyan_large-scale_2020">(<a href="#ref-rafayelyan_large-scale_2020" role="doc-biblioref">Rafayelyan et al. 2020</a>)</span>. This provides interesting and potentially more efficient alternative to traditional machine learning computing.</p>
<p>RC leverages various hyperparameters to introduce prior knowledge about the relationship between input variables and output targets. But because the connections within the reservoir are randomly initialized, the same set of hyperparameters may exhibit diverse behaviors across different instances of the reservoir connections. This unpredictability makes it challenging to anticipate the performance of a particular hyperparameter setting, as identical settings may produce varying outcomes when applied to distinct instances of the reservoir. Moreover, selecting the most suitable hyperparameters often requires researchers to experiment with multiple combinations on a training dataset and evaluate their performance on a separate test set<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Although this approach can be resource-intensive and time-consuming, it is a compromise that is acceptable considering the rapid simulation capabilities offered by RC. Furthermore, there is a current absence of implementation in <code>R</code>, rendering the method challenging for users unfamiliar with Python <span class="citation" data-cites="trouvain_reservoirpy_2022">(<a href="#ref-trouvain_reservoirpy_2022" role="doc-biblioref">Trouvain and Hinaut 2022</a>)</span> or Julia <span class="citation" data-cites="martinuzzi_reservoircomputingjl_2022">(<a href="#ref-martinuzzi_reservoircomputingjl_2022" role="doc-biblioref">Martinuzzi et al. 2022</a>)</span>.</p>
<p>Here, we offer comprehensive guidance to assist new users in maximizing the benefits of RC. Initially, a broad introduction to reservoir computing is presented in <a href="#sec-rcpresentation" class="quarto-xref">Section&nbsp;2</a>, followed in <a href="#sec-basicpackageuse" class="quarto-xref">Section&nbsp;3</a> by a tutorial on its application using <code>reservoirnet</code>, an <code>R</code> package built upon the <code>ReservoirPy</code> <code>Python</code> module <span class="citation" data-cites="trouvain_create_2022 trouvain_reservoirpy_2022 trouvain_reservoirpy_2020">(<a href="#ref-trouvain_create_2022" role="doc-biblioref">Trouvain, Rougier, and Hinaut 2022</a>; <a href="#ref-trouvain_reservoirpy_2022" role="doc-biblioref">Trouvain and Hinaut 2022</a>; <a href="#ref-trouvain_reservoirpy_2020" role="doc-biblioref">Trouvain et al. 2020</a>)</span>. <a href="#sec-basicpackageuse" class="quarto-xref">Section&nbsp;3</a> then introduces the workflow usage on <code>reservoirnet</code> for RC with two basic use-cases, and finally, in <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a> we investigate the various challenges associated with an advanced case-study leveraging RC for forecasting COVID-19 hospitalizations. This case-study exploration includes detailed guidance on the modeling strategy, the selection of hyperparameters, and the implementation process.</p>
</section>
<section id="sec-rcpresentation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> RC presentation</h1>
<p>RC is a machine learning paradigm which is most often implemented as Echo State Networks (ESNs), i.e.&nbsp;the firing-rate neuron version <span class="citation" data-cites="jaeger__2001">(<a href="#ref-jaeger__2001" role="doc-biblioref">Jaeger 2001</a>)</span>. An ESN is described by three matrices of connectivity: an input layer <span class="math inline">W_{in}</span>, a recurrent layer <span class="math inline">W</span> and an output layer <span class="math inline">W_{out}</span>. At each time step, the input vector <span class="math inline">u_t</span> is projected into the reservoir which is also combined with reservoir past state <span class="math inline">x(t-1)</span> through the recurrent connections. The output <span class="math inline">y(t)</span> is linearly read-out from the reservoir. Input <span class="math inline">W_{in}</span> and recurrent <span class="math inline">W</span> matrices are kept random; only the output matrix <span class="math inline">W_{out}</span> is trained in an offline or online method. Often a ridge regression (i.e.&nbsp;a regularized linear regression) is used to obtain the desired outputs <span class="math inline">y(t)</span> from the reservoir states <span class="math inline">x(t)</span>. <a href="#fig-rcpresentation" class="quarto-xref">Figure&nbsp;1</a> depicts the architecture. For simplicity, we will use the term “reservoir computing” for “Echo State Network” in the remainder of the paper.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-rcpresentation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rcpresentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/image1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rcpresentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Reservoir computing is composed of an input layer, a reservoir and an output layer. Connection between input layer and reservoir and inside reservoir are random. Only the output layer is optimized based on a ridge regression. Adapted from <span class="citation" data-cites="trouvain_reservoirpy_2020">Trouvain et al. (<a href="#ref-trouvain_reservoirpy_2020" role="doc-biblioref">2020</a>)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>The input layer <span class="math inline">u(t)</span> is an <span class="math inline">M</span>-dimension vector, where <span class="math inline">M</span> is the number of input time series, which corresponds to the values of the input time series at time <span class="math inline">t</span> where <span class="math inline">t = 1, \dots, T</span>. The reservoir layer <span class="math inline">x(t)</span> is an <span class="math inline">N_{res}</span>-dimensional vector where <span class="math inline">N_{res}</span> is the number of nodes in the reservoir. The value <span class="math inline">x(t)</span> is defined as follow: <span class="math display">\begin{equation}
x( t+1 ) = ( 1 - \alpha )  x ( t) + \alpha \: tanh\left( W x(t) + W_{in} u(t+1)\right).
\end{equation}</span></p>
<p>The leaking rate <span class="math inline">\alpha \in [0, 1]</span> defines the update rate of the nodes. The closer <span class="math inline">\alpha</span> is to <span class="math inline">1</span>, the more the reservoir is sensitive to new inputs <span class="math inline">u(t)</span>. Therefore, the reservoir state at time <span class="math inline">t+1</span> denoted <span class="math inline">x(t+1)</span> depends on the reservoir state at the previous time <span class="math inline">x(t)</span> and the new inputs <span class="math inline">u(t+1)</span>. The function <span class="math inline">tanh()</span> represents the activation function, applied element-wise to each component of the vector, ensuring that each node’s activation is scaled between <span class="math inline">-1</span> and <span class="math inline">1</span>. Both <span class="math inline">W_{in}</span> and <span class="math inline">W</span> are random matrices of size <span class="math inline">N_{res} \times M</span> and <span class="math inline">N_{res} \times N_{res}</span> respectively.</p>
<p>The input-reservoir connection matrix (<span class="math inline">W_{in}</span>) and the intra-reservoir connection matrix (<span class="math inline">W</span>) are generated in three steps. <span class="math inline">W_{in}</span> is generated using a Bernoulli (bimodal) distribution where each value can be either <span class="math inline">-I_{scale}(m)</span> or <span class="math inline">I_{scale}(m)</span> with an equal probability where <span class="math inline">m = 1, \dots, M</span> corresponds to a given feature in the input layer. The input scaling, denoted <span class="math inline">I_{scale}</span>, is a hyperparameter coefficient common to all features from the input layer or specific to each feature <span class="math inline">m</span>. In that case, the more important the feature is, the greater should be its input scaling. <span class="math inline">W</span> is generated from a Gaussian distribution <span class="math inline">\mathcal{N}(0,1)</span>. Both <span class="math inline">W_{in}</span> and <span class="math inline">W</span> then undergo sparsification, where a connectivity mask is applied to retain only <span class="math inline">10\%</span> of the connections, enforcing sparsity. In a third step, the <span class="math inline">W</span> matrix is scaled according to the defined spectral radius, a hyperparameter defining the highest eigen value of <span class="math inline">W</span>.</p>
<p>The final layer is a linear regression with ridge penalization where the explanatory features are the reservoir state and the variable to be explained is the outcome to predict such that: <span class="math display">W_{out} = YX^T ( XX^T + \lambda  I)^{ -1 }.</span> Where x(t) and y(t) are accumulated in X and Y respectively such that: <span class="math display">
X = \begin{bmatrix} x(1) \\ x(2) \\ ... \\ x(T) \end{bmatrix}
\text{ and } Y = \begin{bmatrix} y(1) \\ y(2) \\ ... \\ y(T) \end{bmatrix}.
</span> The parameter <span class="math inline">\lambda</span> is the ridge penalization which aims to prevent overfitting. Additionally, one can also connect the input layer to the output layer to the reservoir nodes. In that case, <span class="math inline">X</span> is the accumulation of both such that : <span class="math display">X = \begin{bmatrix} x(1), u(1) \\ x(2), u(2) \\ ... \\ x(T), u(T) \end{bmatrix}
\text{ and } Y = \begin{bmatrix} y(1) \\ y(2) \\ ... \\ y(T) \end{bmatrix}.</span></p>
<p>Overall, there are four main hyperparameters to be chosen by the user: i) the leaking rate which defines the memory of the RC, ii) the input scaling which defines the relative importance of the features, iii) the spectral radius which defines the connections of the neurons inside the reservoir which in turn defines the degree of non-linear combination of features, and iv) the ridge penalization which controls the degree of overfitting. The choice of hyperparameters often requires the user to evaluate the performance of different combinations of hyperparameters on a validation set before selecting the optimal combination to forecast on the test set.</p>
</section>
<section id="sec-basicpackageuse" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Usage workflow</h1>
<p>In this section, we will cover the basics of <code>reservoirnet</code> use including installation, classification and regression. A more in depth description is provided in <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a> with the covid-19 forecast use case.</p>
<section id="installation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="installation"><span class="header-section-number">3.1</span> Installation</h2>
<p><code>reservoirnet</code> is an <code>R</code> package making the <code>Python</code> module <code>ReservoirPy</code> easily callable from <code>R</code> using <code>reticulate</code> <code>R</code> package <span class="citation" data-cites="reticulate_2024">Ushey, Allaire, and Tang (<a href="#ref-reticulate_2024" role="doc-biblioref">2024</a>)</span>. It is available on CRAN (see <a href="https://cran.r-project.org/package=reservoirnet">https://cran.r-project.org/package=reservoirnet</a>) and can be installed using:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install reservoirnet package from CRAN</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"reservoirnet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Alternatively, it can also be installed from GitHub:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install reservoirnet package from GitHub</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">"reservoirpy/reservoirR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For <code>reservoirnet</code> to work, it will require <code>Python</code> version 3.8 or higher, along with the <code>reservoirpy</code> module which can be installed with the <code>install_reservoirpy()</code> function:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>reservoirnet<span class="sc">::</span><span class="fu">install_reservoirpy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Reservoir Computing (RC) is well suited to both regression and classification tasks. We will introduce a simple example for both task.</p>
</section>
<section id="package-workflow-overview" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="package-workflow-overview"><span class="header-section-number">3.2</span> Package workflow overview</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-schemaworkflow" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-schemaworkflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/schema_workflow.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schemaworkflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Worflow of <code>reservoirnet</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The workflow of <code>reservoirnet</code> is described in <a href="#fig-schemaworkflow" class="quarto-xref">Figure&nbsp;2</a>. A reservoir model is created by the association of an input layer (a matrix), a reservoir, and an output layer. Both the reservoir and the output layer are created using the function <code>reservoirnet::createNode()</code> by specifying the node type (i.e., either <code>Reservoir</code> or <code>Ridge</code>).</p>
<p>This function accepts several arguments to specify the hyperparameters of the reservoir and will be detailed in future sections. After the reservoir and output layer are created, they can be connected using the <code>%&gt;&gt;%</code> operator, a specific pipe operator dedicated to <code>reservoirnet</code>. The model can then be fitted using <code>reservoirR_fit()</code> and used to make predictions on a new dataset using <code>predict_seq()</code>.</p>
</section>
<section id="sec-basicregression" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-basicregression"><span class="header-section-number">3.3</span> Basic regression use-case</h2>
<section id="covid-19-data" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="covid-19-data"><span class="header-section-number">3.3.1</span> Covid-19 data</h3>
<p>In this first use-case, we will introduce the fundamental usage of the <code>reservoirnet</code> package. This demonstration will be conducted using the COVID-19 dataset that is included within the package. These data encompass hospitalization, positive RT-PCR (Reverse Transcription Polymerase Chain Reaction) results, and overall RT-PCR data sourced from Santé Publique France, which are publicly available on data.gouv.fr (for further details, refer to <code>help(dfCovid)</code>). Our primary objective is to predict the number of hospitalized patients 14 days into the future. To accomplish this, we will initially train our model on data preceding the date of January 1, 2022, and then apply it to forecast values using the following dataset.</p>
<p>We can proceed by loading useful packages - namely <code>ggplot2</code> <span class="citation" data-cites="wickham_ggplot2_2016">Wickham, Navarro, and Pedersen (<a href="#ref-wickham_ggplot2_2016" role="doc-biblioref">2018</a>)</span> and <code>dplyr</code> <span class="citation" data-cites="wickham_dplyr_2023">Wickham et al. (<a href="#ref-wickham_dplyr_2023" role="doc-biblioref">2023</a>)</span>, data and define the task:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load usefull packages</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reservoirnet)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load dfCovid data from the reservoirnet package which contains Covid data</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"dfCovid"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the forecast horizon to 14 days</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>dist_forecast <span class="ot">=</span> <span class="dv">14</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the train-test split to 2022-01-01</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>traintest_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Due to the substantial fluctuations observed in both RT-PCR metrics, our initial step involves applying a moving average computation over the most recent 7-day periods for these features. Additionally, we augment the dataset by introducing an <code>outcome</code> column and an <code>outcomeDate</code> column, which will serve as valuable inputs for model training. Moreover, we calculate the <code>outcome_deriv</code> as the difference between the outcome and the number of hospitalized patients (<code>hosp</code>), representing the variation in hospitalization in relation to the current count of hospitalized individuals. The resulting smoothed data is visualized in <a href="#fig-covidintro" class="quarto-xref">Figure&nbsp;3</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dfOutcome <span class="ot">&lt;-</span> dfCovid <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcome at 14 days</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">lead</span>(<span class="at">x =</span> hosp, <span class="at">n =</span> dist_forecast),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcome' which contains the number of</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="co"># hospitalizations ('hosp') shifted forward by 'dist_forecast' days</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="co"># (14 days). This represents the outcome we want to predict.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcomeDate =</span> date <span class="sc">+</span> dist_forecast,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcomeDate' which is the current date plus the</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="co"># forecast period (14 days).</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome_deriv =</span> outcome <span class="sc">-</span> hosp) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcome_deriv' which is the difference between</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>         <span class="co"># the predicted outcome and current hospitalizations.</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>         <span class="co"># This represents the change in hospitalizations over the forecast</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>         <span class="co"># period.</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rolling average for tested and positive_pcr</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"Positive"</span>, <span class="st">"Tested"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs =</span> <span class="cf">function</span>(x) slider<span class="sc">::</span><span class="fu">slide_dbl</span>(<span class="at">.x =</span> x,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">.before =</span> <span class="dv">6</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">.f =</span> mean))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Apply a rolling mean (7-day average) to the 'Positive' and</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Tested' columns.</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The 'slider::slide_dbl' function is used to calculate the mean</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># over a window of 7 days (current day + 6 days before). This</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># smooths out daily fluctuations and provides a better trend</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># indicator.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-covidintro" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-covidintro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-covidintro-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-covidintro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Hospitalizations, number of positive RT-PCR and number of RT-PCR of Bordeaux University Hospital.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="first-reservoir" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="first-reservoir"><span class="header-section-number">3.3.2</span> First reservoir</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-schemaregression" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-schemaregression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/regression_usecase.PNG" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schemaregression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Regression use case: Forecasting the number of hospitalized patients 14 days ahead.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The objective of this task is to train a RC model using the input features to forecast the number of hospitalized patients 14 days ahead, as illustrated in Figure <a href="#fig-schemaregression" class="quarto-xref">Figure&nbsp;4</a>.</p>
<p>Setting a reservoir is done with the <code>createNode()</code> function. The important hyperparameters are the following :</p>
<ul>
<li>Number of nodes (<code>units</code>) : it corresponds to the number of nodes inside the reservoir. Usually, the more the better, but more nodes increases the computation time.</li>
<li>Leaking rate (<code>lr</code>) : the leaking rate corresponds to the balance between the new inputs and the previous state. A leaking rate of 1 only consider information from new inputs.</li>
<li>Spectral radius (<code>sr</code>): the spectral radius is the largest eigenvalue in modulus of the reservoir connectivity matrix. A small spectral radius induces stable dynamics inside the reservoir, a high spectral radius induces a chaotic regime inside the reservoir.</li>
<li>Input scaling (<code>input_scaling</code>): the input scaling is a gain applied to the input features of the reservoir.</li>
<li>Warmup (<code>warmup</code>) : it corresponds to the number of time step during which the data are propagating into the reservoir but not used to fit the output layer. This hyperparameter is set in the <code>reservoirR_fit()</code> function.</li>
</ul>
<p>In addition, we can set the seed (<code>seed</code>). Because the reservoir connections are set at random, setting the seed is a good approach to ensure reproducibility.</p>
<p>For this part of the tutorial, we will set the hyperparameter at a given value. Hyperparameter optimization will be detailed at <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reservoir computing node using the 'createNode' function from the</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - nodeType = "Reservoir": Specify the type of node to be a reservoir.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - seed = 1: Set the seed for reproducibility, ensuring consistent results</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             when the model is run multiple times.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - units = 500: Set the number of reservoir units (neurons) to 500.</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - lr = 0.7: Set the leakage rate (lr) of the reservoir, which controls how</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#             quickly the reservoir state decays over time.</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - sr = 1: Set the spectral radius (sr) of the reservoir, which influences the</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#           stability and memory capacity of the reservoir.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - input_scaling = 1: Set the input scaling factor, which scales the input</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                       signal before it is fed into the reservoir.</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="at">nodeType =</span> <span class="st">"Reservoir"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">units =</span> <span class="dv">500</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">lr =</span> <span class="fl">0.7</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">sr =</span> <span class="dv">1</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">input_scaling =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can feed the data to the reservoir and see the activation state of the reservoir <span class="math inline">x(t)</span>. To do so, we first prepare the data and transform it to a matrix.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## select explanatory features of the train set and transform it to an array</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outcomeDate <span class="sc">&lt;</span> traintest_date) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hosp, Positive, Tested) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we run the <code>predict_seq()</code> function. It takes as input a node (i.e a reservoir or a reservoir associated with an output layer) and the feature matrix.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the state of the reservoir using the 'predict_seq' function from the</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - node = reservoir: The reservoir computing node created earlier.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - X = X: The input data matrix containing the features 'hosp', 'Positive',</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#           and 'Tested'.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The function computes the state of the reservoir for each time step in the</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># input sequence, effectively transforming the input data into the reservoir's</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># high-dimensional state space.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>reservoir_state <span class="ot">&lt;-</span> <span class="fu">predict_seq</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can visualize node activation using the <code>plot()</code> function presented at <a href="#fig-nodeactivationbad" class="quarto-xref">Figure&nbsp;5</a> .</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the reservoir state activation over time</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reservoir_state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nodeactivationbad" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nodeactivationbad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-nodeactivationbad-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nodeactivationbad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: 20 random nodes activation over time.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Numerous nodes within the system exhibit a consistent equilibrium state. The challenge arises when the output layer attempts to extract knowledge from these nodes, as they do not convey meaningful information. This issue can be attributed to the disparate scales of the features. To address this concern, a practical approach involves normalizing the features by dividing each of them by their respective maximum values, thereby scaling them within the range of <span class="math inline">-1</span> to <span class="math inline">1</span> by dividing by the maximum of the absolute value. Of note, here the features will be scaled between <span class="math inline">0</span> and <span class="math inline">1</span> because all features are positive.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardise features by dividing by the maximum value can improve performance</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># After standardisation, all features are on a similar scale which helps RC</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>stand_max <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">return</span>(x<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(x)))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scaled features</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Xstand <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> traintest_date) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hosp, Positive, Tested) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="at">.funs =</span> stand_max) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then feed them to the reservoir and plot the node activation again. Compared to <a href="#fig-nodeactivationbad" class="quarto-xref">Figure&nbsp;5</a>, the obtained node activation at <a href="#fig-nodeactivationgood" class="quarto-xref">Figure&nbsp;6</a> shows interesting trend outputs as no node seems saturated.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># feed the scaled features to the reservoir</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>reservoir_state_stand <span class="ot">&lt;-</span> <span class="fu">predict_seq</span>(<span class="at">node =</span> reservoir,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">X =</span> Xstand,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the output</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reservoir_state_stand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nodeactivationgood" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nodeactivationgood-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-nodeactivationgood-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nodeactivationgood-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: 20 random node activation over time. Scaled features.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="forecast" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="forecast"><span class="header-section-number">3.3.3</span> Forecast</h3>
<p>In order to train the reservoir, we should train the last layer which linearly combines the neuron’s output.</p>
<section id="set-the-esn" class="level4" data-number="3.3.3.1">
<h4 data-number="3.3.3.1" class="anchored" data-anchor-id="set-the-esn"><span class="header-section-number">3.3.3.1</span> Set the ESN</h4>
<p>Initially, we establish the output layer with the <code>createNode()</code> function, incorporating a ridge penalty set at <code>1e3</code>. It’s important to note that this hyperparameter can be subject to optimization, a topic that will be explored in <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a>. This parameter plays a pivotal role in fine-tuning the model’s conformity to the data. When set excessively high, the risk of underfitting arises, whereas setting it too low can lead to overfitting. We connect the output layer to the reservoir, with the <code>%&gt;&gt;%</code> operator, making the model ready to be trained.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="at">nodeType =</span> <span class="st">"Ridge"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ridge =</span> <span class="fl">1e3</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a readout node using ridge regression with the 'createNode' function</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoirnet package.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - nodeType = "Ridge": Specify the type of node to be a ridge regression</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                       readout.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - ridge = 1e3: Set the regularization parameter (ridge) for the ridge</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                 regression to 1000.</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression is used to prevent overfitting by adding a penalty on the</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># size of the coefficients.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> reservoir <span class="sc">%&gt;&gt;%</span> readout</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Link the reservoir and readout nodes to form a complete reservoir computing</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># model. The '%&gt;&gt;%' operator connects the high-dimensional state generated by</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># the reservoir to the readout layer, allowing the model to learn the mapping</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoir states to the target outputs.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="set-the-data" class="level4" data-number="3.3.3.2">
<h4 data-number="3.3.3.2" class="anchored" data-anchor-id="set-the-data"><span class="header-section-number">3.3.3.2</span> Set the data</h4>
<p>First we separate the train set on which we will learn the ridge coefficients and the test set on which we will make the forecast. We define the train set to be all the data before 2022-01-01 and the test data to be all the data to have forecast both on train and test sets.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform some data management to isolate train and test sets</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># train set</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dftrain <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span> <span class="fu">filter</span>(outcomeDate <span class="sc">&lt;=</span> traintest_date)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>yTrain <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(outcome)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>yTrain_variation <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(outcome_deriv)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>xTrain <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(hosp, Positive, Tested)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># test set</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>xTest <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span> <span class="fu">select</span>(hosp, Positive, Tested)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We standardize with the same formula as seen before. We learn the standardization on the training set and apply it on the test set. Then we convert the dataframe to matrix.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># copy train and test sets</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>xTrainstand <span class="ot">&lt;-</span> xTrain</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>xTeststand <span class="ot">&lt;-</span> xTest</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise based on training set values</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ls_fct_stand <span class="ot">&lt;-</span> <span class="fu">apply</span>(xTrain,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="cf">function</span>(feature) feature<span class="sc">/</span>(<span class="fu">max</span>(x)))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">names</span>(ls_fct_stand),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>         xTrainstand[,x] <span class="ot">&lt;&lt;-</span> ls_fct_stand[[x]](<span class="at">feature =</span> xTrain[,x])</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>         xTeststand[,x] <span class="ot">&lt;&lt;-</span> ls_fct_stand[[x]](<span class="at">feature =</span> xTest[,x])</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>()</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>       })</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to array</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>lsdf <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">list</span>(<span class="at">yTrain =</span> yTrain,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yTrain_variation =</span> yTrain_variation,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xTrain =</span> xTrainstand,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xTest =</span> xTeststand),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>               <span class="cf">function</span>(x) <span class="fu">as.matrix</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="train-the-model-and-predict" class="level4" data-number="3.3.3.3">
<h4 data-number="3.3.3.3" class="anchored" data-anchor-id="train-the-model-and-predict"><span class="header-section-number">3.3.3.3</span> Train the model and predict</h4>
<p>We then feed the reservoir with the train set using the <code>reservoirR_fit()</code> function. To do so, we set a <code>warmup</code> of <code>30</code> days during which the data are propagating into the reservoir but not used to fit the output layer.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">### train the reservoir ridge output</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">reservoirR_fit</span>(<span class="at">node =</span> model,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">X =</span> lsdf<span class="sc">$</span>xTrain,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Y =</span> lsdf<span class="sc">$</span>yTrain,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">warmup =</span> <span class="dv">30</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">reset =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that the ridge layer is trained, we can forecast using the <code>predict_seq()</code> function. We set the parameter <code>reset</code> to <code>TRUE</code> in order to clean the reservoir from the data used by the training set.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast with the trained reservoir on the test data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>vec_pred <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> fit<span class="sc">$</span>fit,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">X =</span> lsdf<span class="sc">$</span>xTest,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">reset =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make figure to represent forecast on the train and test sets.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> vec_pred) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcomeDate)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> outcome,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"observed"</span>)) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> pred,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"forecast"</span>)) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> traintest_date,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcomeDate, <span class="at">na.rm =</span> T),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">0</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcome, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="fl">1.1</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Test set"</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-08-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Train set"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-03-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#3772ff"</span>, <span class="st">"#080708"</span>)) <span class="sc">+</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Hospitalizations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-forecast" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-forecast-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forecast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Forecast
</figcaption>
</figure>
</div>
</div>
</div>
<p>We observe that the model forecast at <a href="#fig-forecast" class="quarto-xref">Figure&nbsp;7</a> is not fully accurate, both on the test set and the train set. In that case, one option could be to reduce ridge penalization to fit more closely the data, the optimization of ridge hyperparameter will be discussed at <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a>. Another possibility is to ease the learning of the algorithm by forecasting the variation of the hospitalization instead of the number of hospitalized patients. For that step, we will learn on the <code>outcome_deriv</code> contained in <code>yTrain_variation</code> data which is defined outcome as <code>outcome_deriv = outcome - hosp</code>. As depicted at <a href="#fig-figForecastDerivvsRaw" class="quarto-xref">Figure&nbsp;8</a>, this strategy improved the model forecast.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit reservoir on outcome variation instead of raw outcome</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">reservoirR_fit</span>(<span class="at">node =</span> model,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">X =</span> lsdf<span class="sc">$</span>xTrain,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">Y =</span> lsdf<span class="sc">$</span>yTrain_variation,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">warmup =</span> <span class="dv">30</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Get the forecast on the test set</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>vec_pred2_variation <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> fit2<span class="sc">$</span>fit,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">X =</span> lsdf<span class="sc">$</span>xTest,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Transform the outcome variation forecast into hospitalization forecast</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>vec_pred2 <span class="ot">&lt;-</span> vec_pred2_variation <span class="sc">+</span> xTest<span class="sc">$</span>hosp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the results</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Raw =</span> vec_pred,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Variation =</span> vec_pred2) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Raw, Variation),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"Outcome_type"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values_to =</span> <span class="st">"Forecast"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcomeDate)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> outcome,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"observed"</span>)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> Forecast,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"Forecast"</span>)) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> traintest_date,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcomeDate, <span class="at">na.rm =</span> T),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">0</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcome, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="fl">1.1</span>, </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Test set"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-08-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Train set"</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-03-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(Outcome_type <span class="sc">~</span> .,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(<span class="at">cols =</span> <span class="st">"Outcome"</span> <span class="sc">:</span> .(Outcome_type))) <span class="sc">+</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#3772ff"</span>, <span class="st">"#080708"</span>)) <span class="sc">+</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Hospitalizations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-figForecastDerivvsRaw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figForecastDerivvsRaw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-figForecastDerivvsRaw-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figForecastDerivvsRaw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Covid-19 hospitalizations forecast. The model is either trained to forecast the number of hospitalizations (denoted Raw) or the variation of the hospitalizations compared to current level of hospitalisation (denoted Variation)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="classification" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="classification"><span class="header-section-number">3.4</span> Classification</h2>
<section id="the-japanese-vowel-dataset" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="the-japanese-vowel-dataset"><span class="header-section-number">3.4.1</span> The Japanese vowel dataset</h3>
<p>This example is largely inspired from the <a href="https://github.com/reservoirpy/reservoirpy/blob/master/tutorials/5-Classification-with-RC.ipynb">classification tutorial of reservoirpy</a>. To illustrate the classification task, we will use the Japanese vowel dataset (<span class="citation" data-cites="kudo_multidimensional_1999">Kudo, Toyama, and Shimbo (<a href="#ref-kudo_multidimensional_1999" role="doc-biblioref">1999</a>)</span>). The data can be loaded from <code>reservoirnet</code> as follow :</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Japanese vowels dataset using the 'generate_data' function from the</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset contains preprocessed features and labels for classification.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we isolate train and test sets</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>japanese_vowels <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">generate_data</span>(<span class="at">dataset =</span> <span class="st">"japanese_vowels"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_train</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_train</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_test</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The dataset comprises 640 vocalizations of the Japanese vowel , contributed by nine distinct speakers. Each vocalization represents a time series spanning between 7 and 29 time steps, encoded as a 12-dimensional vector denoting the Linear Prediction Coefficients (LPC). A visual representation of six distinct utterances from the test set, originating from three different speakers, is depicted in <a href="#fig-vowelpresentation" class="quarto-xref">Figure&nbsp;9</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vowelpresentation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vowelpresentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-vowelpresentation-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vowelpresentation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Vowel dataset, sample with 3 speakers and 2 utterance each.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-schemaclassif" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-schemaclassif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/classif_usecase.PNG" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-schemaclassif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Classification use-case, identifying the speaker from an utterance.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The primary objective involves the attribution of each utterance to its respective speaker, this is denoted as classification or sequence-to-vector encoding. The secondary objective involves the attribution of each time step of each utterance to its speaker, this is denoted as transduction or sequence-to-sequence encoding. While this second approach may seem somewhat superfluous in this context, it could be useful, for example, in cases where multiple speakers take turns speaking, allowing us to identify which sequence belongs to each individual speaker. Figure <a href="#fig-schemaregression" class="quarto-xref">Figure&nbsp;4</a> illustrates this task.</p>
</section>
<section id="classification-sequence-to-vector-model" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="classification-sequence-to-vector-model"><span class="header-section-number">3.4.2</span> Classification (sequence-to-vector model)</h3>
<p>The first approach is the sequence-to-vector encoding. For this task we aim to predict the speaker of the whole utterance (i.e the label is assigned to the whole sequence). We first start by creating the reservoir and the output layer using <code>createNode()</code> function.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="st">"Reservoir"</span>, <span class="at">units =</span> <span class="dv">500</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">lr=</span><span class="fl">0.1</span>, <span class="at">sr=</span><span class="fl">0.9</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reservoir computing node with 500 units using the 'createNode'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># function from the reservoirnet package.</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - units = 500: Set the number of reservoir units (neurons) to 500.</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - lr = 0.1: Set the leakage rate (lr) of the reservoir to 0.1, controlling</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#             how quickly the reservoir state decays over time.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - sr = 0.9: Set the spectral radius (sr) of the reservoir to 0.9, influencing</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#             the stability and memory capacity of the reservoir.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - seed = 1: Set the seed for reproducibility, ensuring consistent results</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#             when the model is run multiple times.</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="st">"Ridge"</span>,<span class="at">ridge=</span><span class="fl">1e-6</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a readout node using ridge regression with the 'createNode' function</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoirnet package.</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - ridge = 1e-6: Set the regularization parameter (ridge) for the ridge</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                 regression to 1e-6.</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression is used to prevent overfitting by adding a penalty on the</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># size of the coefficients.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To perform this task, we need to modify the training and testing processes. Leveraging the inherent inertia of the reservoir, information from preceding time steps is preserved, effectively endowing the RC with a form of memory. Consequently, the final state vector encapsulates insights gathered from all antecedent states. In the context of the sequence-to-vector encoding task, only the final state is used. To simplify this process, we introduce the <code>last_reservoir_state()</code> function, which extracts the final reservoir state. This process is executed as follows:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>states_train <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">last_reservoir_state</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we use only the final state for prediction. We first extract the final state using the <code>last_reservoir_state()</code> function and then use the trained readout to predict the vowel using the <code>predict_seq()</code> function with the <code>seq_to_vec</code> parameter set to <code>TRUE</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the reservoir using the last state vector (each observation is the whole</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vowel sequence)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">reservoirR_fit</span>(<span class="at">node =</span> readout, <span class="at">X =</span> states_train, <span class="at">Y =</span> Y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can perform the prediction using only the final state. We first get the final state using the <code>last_reservoir_state()</code> function and use the trained readout to predict the vowel using the <code>predict_seq()</code> function with the <code>seq_to_vec</code> parameter set to <code>TRUE</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The operation is repeated for the test set :</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>states_test <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">last_reservoir_state</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X_test)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> readout, <span class="at">X =</span> states_test, <span class="at">seq_to_vec =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><a href="#fig-seqtovec" class="quarto-xref">Figure&nbsp;11</a> shows the prediction for the 6 utterances depicted at <a href="#fig-vowelpresentation" class="quarto-xref">Figure&nbsp;9</a> where the model correctly identifies the speaker.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A figure represents the performance on the test set</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>dfplotseqtovec <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vec_sample,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> <span class="cf">function</span>(i){</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                   speaker <span class="ot">&lt;-</span> <span class="fu">which</span>(Y_test[[i]][<span class="dv">1</span>,] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                   Y_pred[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                     tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">names_to =</span> <span class="st">"pred_speaker"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">values_to =</span> <span class="st">"prediction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">pred_speaker =</span> <span class="fu">gsub</span>(<span class="at">x =</span> pred_speaker,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">pattern =</span> <span class="st">"V"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">speaker =</span> speaker, <span class="at">.before =</span> <span class="dv">1</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">uterrance =</span> i,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">target =</span> speaker <span class="sc">==</span> pred_speaker) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">return</span>()</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                 }) <span class="sc">%&gt;%</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfplotseqtovec,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> pred_speaker,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> prediction,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> target)) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(uterrance <span class="sc">~</span> speaker,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(<span class="at">cols =</span> <span class="st">"speaker"</span> <span class="sc">:</span> .(speaker)),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#BDBDBD"</span>, <span class="st">"#A3CEF1"</span>)) <span class="sc">+</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Score'</span>,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Speaker"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-seqtovec" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-seqtovec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-seqtovec-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-seqtovec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Prediction in a sequence-to-sequence approach 6 samples with 3 speakers and 2 utterance each. The speaker to predict is depicted in blue. For each of the 6 utterance, the model correctly identifies the speaker.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Then, we can also compute the overall accuracy :</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The overall accuracy is evaluated</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(pred, truth) <span class="fu">mean</span>(pred <span class="sc">==</span> truth)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Y_pred_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_pred,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),<span class="dv">1</span>,which.max))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>Y_test_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_test,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),<span class="dv">1</span>,which.max))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="at">pred =</span> Y_test_class, <span class="at">truth =</span> Y_pred_class)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Accuracy: "</span>, <span class="fu">round</span>(score <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">3</span>) ,<span class="st">"%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Accuracy: 92.703%"</code></pre>
</div>
</div>
</section>
<section id="transduction-sequence-to-sequence-model" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="transduction-sequence-to-sequence-model"><span class="header-section-number">3.4.3</span> Transduction (sequence-to-sequence model)</h3>
<p>For this task, the goal is to predict the speaker for each time step of each utterance. The first step is to get the data where the label is repeated for each time step. This is easily done with the <code>repeat_targets</code> argument as follow :</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For this new task where we want to forecast for each time step (instead of each utterance)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we start by getting the data in the appropriate format</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we split the train and test data</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>japanese_vowels <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">generate_data</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset =</span> <span class="st">"japanese_vowels"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">repeat_targets=</span><span class="cn">TRUE</span>)<span class="sc">$</span>japanese_vowels</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_train</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_train</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_test</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we can train a simple Echo State Network to solve this task. For this example, we will connect both the input layer and the reservoir layer to the readout layer, which is performed by the <code>%&gt;&gt;%</code> operator. This direct connection between the input layer and the output layer can be particularly useful when the relationship between the input sequences and the output is mostly linear, potentially improving performance, especially in tasks where linear dependencies play a significant role. <a href="#sec-studycase" class="quarto-xref">Section&nbsp;4</a> will explore this aspect in more detail through the SARS-CoV-2 prediction task.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an input, a reservoir and an output layers</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>source <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Input"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Ridge"</span>,<span class="at">ridge=</span><span class="fl">1e-6</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Reservoir"</span>,<span class="at">units =</span> <span class="dv">500</span>,<span class="at">lr=</span><span class="fl">0.1</span>, <span class="at">sr=</span><span class="fl">0.9</span>, <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect the input layer to the reservoir and connect both the input layer and</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the reservoir to the output layer</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>(source <span class="sc">%&gt;&gt;%</span> reservoir, source) <span class="sc">%&gt;&gt;%</span> readout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then fit the model and predict the labels for the test data. The <code>reset</code> parameter is set to <code>TRUE</code> to remove information from the reservoir from the training process.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the RC model</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>model_fit <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">reservoirR_fit</span>(<span class="at">node =</span> model,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">X =</span> X_train,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">Y =</span> Y_train,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">warmup =</span> <span class="dv">2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict with the fitted model</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> model_fit<span class="sc">$</span>fit,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">X =</span> X_test,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">reset =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From the <code>Y_pred</code> and <code>Y_test</code> we represent at <a href="#fig-figseqtoseq" class="quarto-xref">Figure&nbsp;12</a> the predictions for the same patients as in <a href="#fig-vowelpresentation" class="quarto-xref">Figure&nbsp;9</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a graph with a label for each time of each utterance</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dfplotseqtoseq <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vec_sample,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> <span class="cf">function</span>(i){</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                   speaker <span class="ot">&lt;-</span> <span class="fu">which</span>(Y_test[[i]][<span class="dv">1</span>,] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                   Y_pred[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                     tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"Time"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                     tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Time,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">names_to =</span> <span class="st">"pred_speaker"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">values_to =</span> <span class="st">"prediction"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">pred_speaker =</span> <span class="fu">gsub</span>(<span class="at">x =</span> pred_speaker,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">pattern =</span> <span class="st">"V"</span>, <span class="st">""</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">speaker =</span> speaker,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">uterrance =</span> i,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">return</span>()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>                 }) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfplotseqtoseq, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Time,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">y =</span> pred_speaker,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">fill =</span> prediction)) <span class="sc">+</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(uterrance <span class="sc">~</span> speaker,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">label_bquote</span>(<span class="at">cols =</span> <span class="st">"speaker"</span> <span class="sc">:</span> .(speaker)),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"#8ECAE6"</span>, <span class="at">high =</span> <span class="st">"#FB8500"</span>, <span class="at">mid =</span> <span class="st">"#023047"</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">'Predicted speaker'</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Prediction score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-figseqtoseq" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-figseqtoseq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-figseqtoseq-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-figseqtoseq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Prediction in a sequence-to-sequence approach 6 samples with 3 speakers and 2 utterance each. The higher the score of the speaker, the lighter the color.
</figcaption>
</figure>
</div>
</div>
</div>
<p>For those 6 utterances, the model correctly identify the speaker for most of the time steps. We can then evaluate the overall accuracy of the model :</p>
<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Y_pred_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_pred, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                                                       which.max))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>Y_test_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_test, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                                                       which.max))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="fu">array</span>(<span class="fu">unlist</span>(Y_pred_class)), <span class="fu">array</span>(<span class="fu">unlist</span>(Y_test_class)))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Accuracy: "</span>, <span class="fu">round</span>(score <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">3</span>) ,<span class="st">"%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Accuracy: 92.456%"</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sec-studycase" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Avanced case-study: Covid-19 hospitalizations forecast</h1>
<section id="introduction-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">4.1</span> Introduction</h2>
<p>Since late 2020, millions of cases of SARS-CoV-2 infection have been documented across the globe <span class="citation" data-cites="world_health_organisation_who_2020 noauthor_estimating_2022 carrat_evidence_2021">(<a href="#ref-world_health_organisation_who_2020" role="doc-biblioref">World Health Organisation 2020</a>; <a href="#ref-noauthor_estimating_2022" role="doc-biblioref">COVID-19 Cumulative Infection Collaborators 2022</a>; <a href="#ref-carrat_evidence_2021" role="doc-biblioref">Carrat et al. 2021</a>)</span>. This ongoing pandemic has exerted significant strain on healthcare systems, resulting in a surge in hospitalizations. This surge, in turn, necessitated modifications to the healthcare infrastructure and gave rise to population-wide lockdown measures aimed at preventing the saturation of healthcare facilities <span class="citation" data-cites="simoes_organisation_2021 hubner_surgery_2020 kim_health_2020">(<a href="#ref-simoes_organisation_2021" role="doc-biblioref">Simões et al. 2021</a>; <a href="#ref-hubner_surgery_2020" role="doc-biblioref">Hübner et al. 2020</a>; <a href="#ref-kim_health_2020" role="doc-biblioref">Kim et al. 2020</a>)</span>. The capacity to predict the trajectory of the epidemic on a regional scale is of paramount importance for effective healthcare system management.</p>
<p>Numerous COVID-19 forecasting algorithms have been proposed using different methods (e.g ensemble, deep learning, mechanistic), yet none has proven entirely satisfactory <span class="citation" data-cites="cramer_evaluation_2022-1 rahimi_review_2021">(<a href="#ref-cramer_evaluation_2022-1" role="doc-biblioref">Cramer et al. 2022</a>; <a href="#ref-rahimi_review_2021" role="doc-biblioref">Rahimi, Chen, and Gandomi 2021</a>)</span>. In France, short-term forecasts with different methods have been evaluated with similar results <span class="citation" data-cites="paireau_ensemble_2022 carvalho_analysis_2021 mohimont_convolutional_2021 pottier_forecast_2021">(<a href="#ref-paireau_ensemble_2022" role="doc-biblioref">Paireau et al. 2022</a>; <a href="#ref-carvalho_analysis_2021" role="doc-biblioref">Carvalho et al. 2021</a>; <a href="#ref-mohimont_convolutional_2021" role="doc-biblioref">Mohimont et al. 2021</a>; <a href="#ref-pottier_forecast_2021" role="doc-biblioref">Pottier 2021</a>)</span>. In this context a machine learning algorithm based on linear regression with elastic-net penalization, leveraging both Electronic Health Records (EHRs) and public data, was implemented at Bordeaux University Hospital <span class="citation" data-cites="ferte_benefit_2022">(<a href="#ref-ferte_benefit_2022" role="doc-biblioref">Ferté et al. 2022</a>)</span>. This model, which aimed at forecasting the number of hospitalized patients at 14 days, showed good performance but struggled to accurately anticipate dynamic shifts of the epidemic.</p>
<p>RC has been used in the context of covid-19 epidemic forecast <span class="citation" data-cites="kmet_bezier_2019 liu_nanophotonic_2023 ray_optimized_2021 zhang_sentiment_2023 ghosh_reservoir_2021">(<a href="#ref-kmet_bezier_2019" role="doc-biblioref">Kmet and Kmetova 2019</a>; <a href="#ref-liu_nanophotonic_2023" role="doc-biblioref">Liu et al. 2023</a>; <a href="#ref-ray_optimized_2021" role="doc-biblioref">Ray, Chakraborty, and Ghosh 2021</a>; <a href="#ref-zhang_sentiment_2023" role="doc-biblioref">Q. Zhang et al. 2023</a>; <a href="#ref-ghosh_reservoir_2021" role="doc-biblioref">Ghosh et al. 2021</a>)</span>. Among them, <span class="citation" data-cites="ghosh_reservoir_2021">Ghosh et al. (<a href="#ref-ghosh_reservoir_2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="liu_nanophotonic_2023">Liu et al. (<a href="#ref-liu_nanophotonic_2023" role="doc-biblioref">2023</a>)</span> and <span class="citation" data-cites="ray_optimized_2021">Ray, Chakraborty, and Ghosh (<a href="#ref-ray_optimized_2021" role="doc-biblioref">2021</a>)</span> used it to forecast epidemic, <span class="citation" data-cites="zhang_sentiment_2023">Q. Zhang et al. (<a href="#ref-zhang_sentiment_2023" role="doc-biblioref">2023</a>)</span> performed sentiment analysis and <span class="citation" data-cites="kmet_bezier_2019">Kmet and Kmetova (<a href="#ref-kmet_bezier_2019" role="doc-biblioref">2019</a>)</span> used it to solve optimal control related to vaccine. The evaluation of RC for epidemic forecast showed promising results in all approaches, being competitive with Long-Short Term Memory (LSTM) and Feed-Forward Neural Network (FFNN) in <span class="citation" data-cites="ray_optimized_2021">Ray, Chakraborty, and Ghosh (<a href="#ref-ray_optimized_2021" role="doc-biblioref">2021</a>)</span>. However, the test period was short for <span class="citation" data-cites="ghosh_reservoir_2021">Ghosh et al. (<a href="#ref-ghosh_reservoir_2021" role="doc-biblioref">2021</a>)</span>} (21 and 14 days) and <span class="citation" data-cites="ray_optimized_2021">Ray, Chakraborty, and Ghosh (<a href="#ref-ray_optimized_2021" role="doc-biblioref">2021</a>)</span> (86 days) making it difficult to evaluate the behavior of the methods during epidemic dynamic shift. This was not the case for <span class="citation" data-cites="liu_nanophotonic_2023">Liu et al. (<a href="#ref-liu_nanophotonic_2023" role="doc-biblioref">2023</a>)</span> (6 months) but they implemented daily ahead forecast which would be difficult to use to manage a hospital. Finally, all three implementations used only one time series as input whereas it has been shown that using different data sources could improve forecast <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span>. Therefore, it is still difficult to assess the usefulness of RC over a large period and using many time series as inputs.</p>
<p>RC can be viewed as an extension of penalized linear regression, where inputs undergo processing by a reservoir, introducing the capacity for memory and non-linear combinations. Given the effectiveness of penalized linear regression in COVID-19 forecasting, as highlighted in <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span>, and the promising results exhibited by RC in epidemic forecasting, as demonstrated in studies such as <span class="citation" data-cites="ghosh_reservoir_2021">Ghosh et al. (<a href="#ref-ghosh_reservoir_2021" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="liu_nanophotonic_2023">Liu et al. (<a href="#ref-liu_nanophotonic_2023" role="doc-biblioref">2023</a>)</span>, and <span class="citation" data-cites="ray_optimized_2021">Ray, Chakraborty, and Ghosh (<a href="#ref-ray_optimized_2021" role="doc-biblioref">2021</a>)</span>, we have opted to employ RC for the prediction of hospitalizations at 14 days at the University Hospital of Bordeaux.</p>
<p>The aim of this study is to showcase the use of <code>reservoirnet</code> for an advanced use case in forecasting the SARS-CoV-2 pandemic in <code>R</code>. Several architectural choices will be evaluated, such as the connection between the input layer and the output layer, and the use of either individual input scaling per feature or a common input scaling. The performance of Reservoir Computing (RC) will be compared with elastic-net penalized regression (identified as the optimal model in <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span>), while a more in-depth comparison of performance against other methods can be found in <span class="citation" data-cites="ferte_reservoir_2024">Ferté, Dutartre, Hejblum, Griffier, Jouhet, Thiébaut, Legrand, et al. (<a href="#ref-ferte_reservoir_2024" role="doc-biblioref">2024</a>)</span>.</p>
</section>
<section id="methods" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="methods"><span class="header-section-number">4.2</span> Methods</h2>
<section id="data" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="data"><span class="header-section-number">4.2.1</span> Data</h3>
<p>The study utilized aggregated data spanning from May 16, 2020, to January 17, 2022, regarding the COVID-19 epidemic in France, drawing from various sources to enhance forecasting accuracy. These sources encompassed epidemiological statistics from Santé Publique France, weather data from the National Oceanic and Atmospheric Administration (NOAA), both providing department-level data <span class="citation" data-cites="smith_integrated_2011 etalab_les_2020">(<a href="#ref-smith_integrated_2011" role="doc-biblioref">Smith, Lott, and Vose 2011</a>; <a href="#ref-etalab_les_2020" role="doc-biblioref">Etalab 2020</a>)</span> and Electronic Health Record (EHR) data from the Bordeaux Hospital providing hospital-level data. All data were daily updated. Santé Publique France data included information on hospitalizations, RT-PCR tests, positive RT-PCR results, variant prevalence, and vaccination data, categorized by age groups. NOAA data contributed temperature, wind speed, humidity, and dew point data, allowing for the computation of the COVID-19 Climate Transmissibility Predict Index <span class="citation" data-cites="roumagnac_etude_2021">(<a href="#ref-roumagnac_etude_2021" role="doc-biblioref">Roumagnac et al. 2021</a>)</span>. EHRs data included hospitalizations, ICU admissions, ambulance service records, and emergency unit notes, with relevant COVID-19-related concepts extracted from the notes. Data are discussed more in depth in <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span>.</p>
<p>First derivative over the last <span class="math inline">7</span> days were computed to enrich model information. To take into account measurement error and daily noise variation, data were smoothed using a local polynomial regression with a span of 21 days. As previously described, input features were scaled between -1 and 1 by dividing the observed value by the maximum of the absolute value of the given input feature.</p>
<p>All data are publicly available. Weather data can be obtained from <span class="citation" data-cites="smith_integrated_2011">Smith, Lott, and Vose (<a href="#ref-smith_integrated_2011" role="doc-biblioref">2011</a>)</span> using <code>R</code> package <code>worldmet</code> <span class="citation" data-cites="carslaw_worldmet_2023">(<a href="#ref-carslaw_worldmet_2023" role="doc-biblioref">Carslaw 2023</a>)</span>. <a href="https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-personnes-vaccinees-contre-la-covid-19-1/">Vaccine data</a> can be downloaded from <span class="citation" data-cites="etalab_les_2020">Etalab (<a href="#ref-etalab_les_2020" role="doc-biblioref">2020</a>)</span>. EHRs data can be downloaded on dryad <span class="citation" data-cites="ferte_benefit_2023">(<a href="#ref-ferte_benefit_2023" role="doc-biblioref">Ferté et al. 2023</a>)</span>. For privacy issues, publicly available EHRs data below 10 patients were obfuscated to 0. For convenience, all data were downloaded, merged and provided as replication material.</p>
</section>
<section id="evaluation-framework" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="evaluation-framework"><span class="header-section-number">4.2.2</span> Evaluation framework</h3>
<p>The task was to forecast 14 days ahead the number of hospitalized patients. As seen at <a href="#sec-basicregression" class="quarto-xref">Section&nbsp;3.3</a>, we will train the model to predict the variation of hospitalization, denoted as <span class="math inline">hosp</span>, defined as <span class="math inline">outcome_{t+14} = hosp_{t+14} - hosp_{t}</span> with <span class="math inline">t = 1, ..., T</span>. Metrics computation and visualizations will be performed on the predicted number of hospitalizations denoted as <span class="math inline">\widehat{hosp_{t+14}} = \widehat{outcome_{t+14}} + hosp_{t}</span>.</p>
<p>The dataset was separated into two periods. First period from May 16, 2020 to March 1, 2021 served to identify relevant hyperparameters. Remaining data was used to evaluate the model performance.</p>
<p>The performance of the model was evaluated according to several metrics:</p>
<ul>
<li>the mean absolute error : <span class="math inline">\text{MAE} = \frac{1}{T} \sum_{t=1}^{T} \left| \hat{hosp}_{t+14} - hosp_{t+14} \right|</span>.</li>
<li>the median relative error : <span class="math inline">\text{MRE} = \text{median} \left( \left| \frac{\hat{hosp}_{t+14} - hosp_{t+14}}{hosp_{t+14}} \right| \right)</span>.</li>
<li>the mean absolute error to baseline : <span class="math inline">\text{MAEB} = \frac{1}{T} \sum_{t=1}^{T} \left( \left| \hat{hosp}_{t+14} - hosp_{t+14} \right| - \left| hosp_{t} - hosp_{t+14} \right| \right)</span>.</li>
<li>the median relative error to baseline : <span class="math inline">\text{MREB} = \text{median} \left( \left| \frac{\hat{hosp}_{t+14} - hosp_{t+14}}{hosp_{t} - hosp_{t+14}} \right| \right)</span>)</li>
</ul>
<p>Median was chosen over mean for <span class="math inline">MRE</span> and <span class="math inline">MREB</span> because those metrics tend to have extremely high values when the denominator is close to 0 (i.e when the number of hospitalized patients is close to 0 or the number of patients hospitalized at 14 days is close to the current number of hospitalized patients respectively). <span class="math inline">MAEB</span> and <span class="math inline">MREB</span> compare model performance to a baseline model which predicts the current number of hospitalized patients at 14 days. Those metrics help to determine the information added by the model and is a good baseline as covid-19 forecast model do not always outperform this basic forecast (<span class="citation" data-cites="cramer_evaluation_2022-1">Cramer et al. (<a href="#ref-cramer_evaluation_2022-1" role="doc-biblioref">2022</a>)</span>).</p>
<p>Because the outcome is obfuscated below 10 hospitalizations for privacy reason, we set both the outcome and the forecast to 10 when the observed value was 0 or the forecasted value was below 10 when evaluating the model performance.</p>
</section>
<section id="models" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="models"><span class="header-section-number">4.2.3</span> Models</h3>
<p>We compared RC to elastic-net penalized regression (denoted as Enet). Furthermore we evaluated RC based on several architectures. First we compared RC with a single input scaling common to all features and a RC with a specific input scaling per feature. Second we compared RC where the input layer is connected to the output layer in addition to the connection between reservoir and output layer. Therefore, five models were evaluated :</p>
<ul>
<li>Elastic-net penalized regression denoted <em>Enet</em></li>
<li>RC with a single input scaling and no connection between input and ouput layers denoted <em>Common IS R %&gt;&gt;% O</em></li>
<li>RC with a single input scaling and connection between input and ouput layers denoted <em>Common IS I+R %&gt;&gt;% O</em></li>
<li>RC with multiple input scaling and no connection between input and ouput layers denoted <em>Multiple IS R %&gt;&gt;% O</em></li>
<li>RC with multiple input scaling and connection between input and ouput layers denoted <em>Multiple IS I+R %&gt;&gt;% O</em></li>
</ul>
<p>Because of the randomness of the reservoir, we took the median forecast of 10 reservoir on the train set to evaluate the performance of a given hyperparameter set. On the test set we aggregated the forecast of 40 reservoirs, each of them having one of the 40 best hyperparameter sets found on the train set. In addition, because covid-19 hospitalization is a non-stationary process, models were re-trained everyday using all previous days. To ease computation burden, only one day over two was used to find hyperparameters on the training set.</p>
</section>
<section id="hyperparameter-optimisation-using-random-search" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="hyperparameter-optimisation-using-random-search"><span class="header-section-number">4.2.4</span> Hyperparameter optimisation using random search</h3>
<p>RC relies mainly on 4 hyperparameters including the leaking rate (i.e “memory” parameter), spectral radius (i.e “chaoticity” parameter), input scaling (i.e “feature gain” parameter) and ridge (i.e penalization parameter). Input scaling can be either, common to all features or specific to each feature which increases the number of hyperparameter by the number of features.</p>
<p>Following the notation from <code>glmnet</code> package <span class="citation" data-cites="friedman_regularization_2010">(<a href="#ref-friedman_regularization_2010" role="doc-biblioref">Friedman, Hastie, and Tibshirani 2010</a>)</span>, elastic-net penalized linear regression relies on two hyperparameters, lambda (i.e the penalization parameter) and alpha (i.e the compromise between lasso and ridge penalty)</p>
<p>Hyperparameter were selected in the training set (i.e before March 1, 2021) using a wrapper approach and a random search sampler using 2000 samples for each model. The sampling distribution were defined as follow :</p>
<ul>
<li>(RC) ridge and (Enet) lambda : log-uniform law defined between 1e-10 and 1e5</li>
<li>(RC) input scaling and spectral radius : log-uniform law defined between 1e-5 and 1e5</li>
<li>(RC) leaking rate : log-uniform law defined between 1e-3 and 1</li>
<li>(Enet) alpha : uniform defined between 0 and 1</li>
</ul>
<p>We provided large search space for all hyper-parameters. Search space was slightly reduced for leaking rate based on previous results and because a leaking rate of 1e-3 already imply that new inputs make the reservoir change really slowly which is not inline with the dynamic of covid-19 but would be appropriate for an application where the phenomena to forecast has a slow dynamic.</p>
<p>Finally, we provided an additional Enet model similar to the one in <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span> where alpha was set to <span class="math inline">0.5</span> and lambda was re-evaluated everyday in the test set based on previous data using the cross-validation procedure provided by <code>glmnet</code>.</p>
</section>
</section>
<section id="results" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="results"><span class="header-section-number">4.3</span> Results</h2>
<p>The goal of this task is to predict 14 days ahead the hospitalization. <a href="#fig-ucPresentData" class="quarto-xref">Figure&nbsp;13</a> shows both the training set (i.e before 2021-03-01) and the test set where the blue curve correspond to the input features (first derivatives are not shown) and the orange curves correspond to the outcome the model is trained on (i.e the hospitalization variation) and the hospitalizations at 14 days on which the performance metrics are computed. The figures outline that the relation between the input features and the outcome evolve over time and that the time series is not stationary. For instance IPTCC (<em>Index PREDICT de Transmissivité Climatique de la COVID-19</em>) seems correlated to the outcome except that it completely miss the summer 2021 increase.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ucPresentData" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ucPresentData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-ucPresentData-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ucPresentData-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Covid-19 epidemic at BUH. Outcome of interest is presented in orange. Model is trained to forecast Outcome curve which corresonds to the difference between Hospitalisatiosn at 14 days and current hospitalisations. Other features are scaled (divide by the maximum of the feature) represented in darkblue.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="hyperparameter-selection" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="hyperparameter-selection"><span class="header-section-number">4.3.1</span> Hyperparameter selection</h3>
<p><a href="#fig-ucHyperparam" class="quarto-xref">Figure&nbsp;14</a> shows the hyperparameter optimisation using random search for the different RC architectures. We observe that model with multiple input scaling achieved better performance on the train set compared to model with single input scaling which is expected as they can adapt more closely to the data thanks to specific input scaling for each feature.</p>
<p>As expected, we observe that the optimal leaking rate is above 1e-2 for all RC which is coherent with the short term dynamic of covid-19 epidemic. Trends for other hyperparameters are less clear even though best hyperparameters sets were close for RC with common input scaling and for RC with multiple input scaling.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ucHyperparam" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ucHyperparam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-ucHyperparam-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ucHyperparam-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Hyperparameter evaluation on training set by random search. Hp sets with MAE above 30 were removed for clarity of visualisation.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-ucHyperparamMultipleIS" class="quarto-xref">Figure&nbsp;15</a> shows the hyperparameter search for RC with multiple input scaling and connected input layer. We observe that the random search tends to favor high importance given to derivative of positive RT-PCR (including the elderly) and the derivative of IPTCC. The remaining features do not exhibit a clear pattern.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ucHyperparamMultipleIS" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ucHyperparamMultipleIS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-ucHyperparamMultipleIS-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ucHyperparamMultipleIS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Hyperparameter evaluation on training set by random search of the model with multiple input scaling and no connection between input layer and output layer. Hp sets with MAE above 30 were removed for clarity of visualisation.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="forecast-performance" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="forecast-performance"><span class="header-section-number">4.3.2</span> Forecast performance</h3>
<div class="cell">
<div id="tbl-performance" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Model performance with several reservoir configuration. For each setting, 40 reservoirs are computed and the forecast is the median of the 40 forecasts. Results show the performance metrics : MAE = Mean Absolute Error, MRE = Median Relative Error, MAEB = Mean Absolute Error to Baseline, MREB = Median Relative Error to Baseline.
</figcaption>
<div aria-describedby="tbl-performance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Model Performance</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MRE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAEB</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MREB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Common IS: R %&gt;&gt;% O</td>
<td style="text-align: right;">15.23</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">-3.50</td>
<td style="text-align: right;">0.85</td>
</tr>
<tr class="even">
<td style="text-align: left;">Common IS: I + R %&gt;&gt;% O</td>
<td style="text-align: right;">14.84</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">-3.89</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple IS: R %&gt;&gt;% O</td>
<td style="text-align: right;">15.38</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">-3.35</td>
<td style="text-align: right;">0.82</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple IS: I + R %&gt;&gt;% O</td>
<td style="text-align: right;">15.25</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">-3.49</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elastic-net</td>
<td style="text-align: right;">16.40</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">-2.34</td>
<td style="text-align: right;">0.93</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p><a href="#tbl-performance" class="quarto-xref">Table&nbsp;1</a> shows the performance on the test set. Best model according to all metrics was RC with common input scaling and connection between input and output layers. Having one input scaling per feature did not improve the model which might be due to low generalisability of the hyperparameter of the training set to the test set due to non-stationarity. Additionaly, connecting input layer to output layer improved the model forecast. All RC models performed better than the elastic-net model.</p>
<p><a href="#fig-forecastwithorwithoutUpdate" class="quarto-xref">Figure&nbsp;16</a> shows the forecast of the different models. We note that models struggle to accurately forecast slope shifts. For instance, summer 2021 initial increase is partially predicted by all models but its decrease is not well predicted. Winter 2021 increase is anticipated by all models but they tend to overestimate it because of the rise of vaccine effect.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-forecastwithorwithoutUpdate" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forecastwithorwithoutUpdate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-forecastwithorwithoutUpdate-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forecastwithorwithoutUpdate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Reservoir computing forecast depending on the setting with and without monthly update. Red line is the median forecast of 40 reservoirs. Grey lines are individual forecast of each of the 40 reservoirs.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="number-of-model-to-aggregate" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="number-of-model-to-aggregate"><span class="header-section-number">4.3.3</span> Number of model to aggregate</h3>
<p><a href="#fig-ucAggregationSpread" class="quarto-xref">Figure&nbsp;17</a> show the individual forecast for the 40 best sets of hyperparameters of each RC architecture. Due to the internal random connection of the reservoir, we observe forecast stochasticity and relying on only one forecast is unreliable. We explored the number of model needed at <a href="#fig-ucAggregationNb" class="quarto-xref">Figure&nbsp;18</a> which shows that after 10 models, forecast is stable and even 5 models for the simpler model with common input scaling which rely on less hyperparamters.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ucAggregationSpread" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ucAggregationSpread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-ucAggregationSpread-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ucAggregationSpread-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Individual forecast the 40 best hyperparameter sets for the different RC configuration. Forecast value above 200 were set to 200 for clarity.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ucAggregationNb" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ucAggregationNb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-ucAggregationNb-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ucAggregationNb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Mean absolute error depending on the number of aggregated reservoir.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="input-feature-importance" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="input-feature-importance"><span class="header-section-number">4.3.4</span> Input feature importance</h3>
<p>We compared the coefficients of the output layer estimated for the input layer and the reservoir nodes. Additionally, we compared the coefficient given to the input layer by the output layer in the reservoir and the coefficient estimated by the elastic-net model.</p>
<p><a href="#fig-importanceReservoir" class="quarto-xref">Figure&nbsp;19</a> illustrates the ranking of input layer compared to all connections to the output layer, including the 500 reservoir nodes and the 16 features of the input layer (excluding bias). The figure shows that the model with common input scaling tends to assign less weight to input layer compared to the model with multiple input scaling. This suggests that the reservoir with common input scaling provides more information than the reservoir with multiple input scaling, which aligns with its better performance, as shown in Table <a href="#tbl-performance" class="quarto-xref">Table&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-importanceReservoir" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-importanceReservoir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-importanceReservoir-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-importanceReservoir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Mean feature importance of the 40 best hyperparameter sets by model, focus on the connection between the input and output layers. Models with direct connection between input and output layer are included. The rank is obtained by comparing the feature input layer and all other connection coefficients (both input and reservoir corresponding coefficients) attributed by the output layer at each date for each hyperparameter set. The higher the output layer’s coefficient for the input layer, the closer its rank will be to 1 and the more important the feature is.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Furthermore, <a href="#fig-importanceReservoirvsEnet" class="quarto-xref">Figure&nbsp;20</a> compares the coefficients assigned to input features by the elastic-net model and the RC models. While the coefficients are generally consistent across RC models, there are some notable differences with elastic-net. Specifically, certain features deemed important by the elastic-net model, such as the derivative of RT-PCR, and the derivative of Vaccine, are less important for the reservoir computing model. This may indicate that these features predictive ability is better conveyed by their relationship with other features, which is captured by the reservoir computing model but might not be by the elastic-net model. Conversely, emergency, IPTCC, proportion of positive RT-PCR, and hospitalizations are more important for the reservoir computing model than for the elastic-net model.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-importanceReservoirvsEnet" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-importanceReservoirvsEnet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="template-computo-R_files/figure-html/fig-importanceReservoirvsEnet-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-importanceReservoirvsEnet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Mean feature coefficient of the 40 best hyperparameter sets by model and the elastic-net model. Only models with direct connection between input and output layer are included. The coefficients were calculated as the average value across all dates for each feature, model and hyperparamet set.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="discussion" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="discussion"><span class="header-section-number">4.4</span> Discussion</h2>
<p>In this specific application, we have demonstrated that RC exhibits commendable performance in comparison to Elastic-net, which serves as the reference model. Furthermore, we highlight the inherent challenges in forecasting within this context, primarily stemming from the non-stationarity of the time series.</p>
<p>All computations in this study were conducted using the <code>reservoirnet</code> package, and the entire codebase is accessible on Zenodo <span class="citation" data-cites="ferte_thomasfertejss_reservoirnet_2024">(<a href="#ref-ferte_thomasfertejss_reservoirnet_2024" role="doc-biblioref">Ferté, Ba, et al. 2024</a>)</span>. This <code>R</code> package demonstrates its efficacy in implementing various reservoir architectures, including connection between the input layer and the output layer, as well as the utilization of several input scaling, all within the context of a real-world use case.</p>
<p>Given the substantial number of hyperparameters involved, we acknowledge that random search may not be the most efficient optimization algorithm. We have retained this approach for the sake of simplicity in this tutorial paper; however, meta-heuristic approaches, particularly those utilizing evolutionary algorithms, may prove more efficient, especially when employing multiple input scaling <span class="citation" data-cites="bala_applications_2018 ferte_optimizing_2024">(<a href="#ref-bala_applications_2018" role="doc-biblioref">Bala et al. 2018</a>; <a href="#ref-ferte_optimizing_2024" role="doc-biblioref">Ferté, Dutartre, Hejblum, Griffier, Jouhet, Thiébaut, Hinaut, et al. 2024</a>)</span>.</p>
<p>This study represents a novel contribution to epidemic forecasting utilizing RC. Notably, previous literature predominantly focused on simpler problems characterized by fewer input features or shorter evaluation periods <span class="citation" data-cites="liu_nanophotonic_2023 ray_optimized_2021 ghosh_reservoir_2021">(<a href="#ref-liu_nanophotonic_2023" role="doc-biblioref">Liu et al. 2023</a>; <a href="#ref-ray_optimized_2021" role="doc-biblioref">Ray, Chakraborty, and Ghosh 2021</a>; <a href="#ref-ghosh_reservoir_2021" role="doc-biblioref">Ghosh et al. 2021</a>)</span>. Our findings underscore the potential of this approach for future epidemics, suggesting its potential to surpass more traditional epidemiological tools while maintaining a lightweight model structure compared to other RNNs.</p>
<p>It is worth noting that all models, including those presented in <span class="citation" data-cites="ferte_benefit_2022">Ferté et al. (<a href="#ref-ferte_benefit_2022" role="doc-biblioref">2022</a>)</span>, face challenges in accurately predicting slope shifts, highlighting the need for further investigation. Specifically, additional work is required to extend the application of Reservoir Computing (RC) to high-dimensional settings, building upon insights gained from models that use a more extensive feature set. While RC has demonstrated promising performance for epidemic forecasting in high-dimensional settings, this task remains challenging <span class="citation" data-cites="ferte_reservoir_2024">(<a href="#ref-ferte_reservoir_2024" role="doc-biblioref">Ferté, Dutartre, Hejblum, Griffier, Jouhet, Thiébaut, Legrand, et al. 2024</a>)</span>.</p>
<p>A new perspective may emerge from integrating New Generation Computing, a method inspired by RC and nonlinear vector-autoregression, where expert insights into the non-linear components of the model can be directly embedded within the reservoir <span class="citation" data-cites="zhang2022catch22s">(<a href="#ref-zhang2022catch22s" role="doc-biblioref">Y. Zhang and Cornelius 2022</a>)</span>. Additionally, we observe that reservoir predictions exhibit high instability, requiring the aggregation of multiple predictions to achieve meaningful results. To address this instability, <span class="citation" data-cites="zhang2024instability">Y. Zhang and Cornelius (<a href="#ref-zhang2024instability" role="doc-biblioref">2024</a>)</span> suggests implementing stronger penalization techniques that can be updated as more data becomes available or adopting a “training with noise” approach, where noise is added during training for regularization. These approaches could help mitigate instability in reservoir computing as the problem’s dimensionality increases.</p>
</section>
</section>
<section id="sec-discussion-and-conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Discussion and conclusion</h1>
<p>In this paper, we introduce the <code>R</code> package <code>reservoirnet</code>, which serves as a versatile tool for implementing reservoir computing based on <code>ReservoirPy</code>’s <code>Python</code> library. It offers flexibility in defining the reservoir architecture, including options for specifying connections between the input layer and the output layer, as well as variations in input scaling as demonstrated on a real-world use case.</p>
<p>We provided a comprehensive overview of the basic usage of the <code>reservoirnet</code> package through illustrative examples in regression and classification tasks. This introductory section serves as a foundation for <code>R</code> users, offering step-by-step guidance on constructing and training reservoir computing models using the package. By demonstrating the application of RC in both regression and classification scenarios, we aim to equip users with the essential knowledge and skills needed to harness the capabilities of reservoir computing for diverse tasks.</p>
<p>Drawing on the robust foundation of the <code>ReservoirPy</code> structure, a well-maintained <code>Python</code> library, this package inherits its reliability and longevity. We have focused on providing access to the fundamental features, building upon the strong base provided by <code>ReservoirPy</code>. Therefore, this initial version of <code>reservoirnet</code> must evolve in tandem with the growing understanding and adoption of RC within the <code>R</code> community.</p>
<!-- # Introduction -->
<!-- ## About this document -->
<!-- This document, accompanied with the [hopefully finely tuned git repos](https://github.com/computorg/template-computo-R/), provides a template for writing contributions to **Computo** [@computo]. We show how `R` code [@R-base] can be included and how the repository can be set up for triggering github actions for rendering the document, with dependencies handled by `renv`. -->
<!-- ## Setup a github repository for preparing your submission -->
<!-- You can start by clicking the **"use this template"** button, on the top of the page of the [github repository associated to this document](https://github.com/computorg/template-computo-R/). Of course, you can set your repository private during the preparation of your manuscript. -->
<!-- ## Quarto -->
<!-- [Quarto](https://quarto.org/) is a versatile formatting system for authoring documents integrating markdown, LaTeX and code blocks interpreted either via Jupyter or Knitr (thus supporting Python, R and Julia). It relies on the [Pandoc](https://pandoc.org/MANUAL.html) document converter. -->
<!-- ## Requirements -->
<!-- You need [quarto](https://quarto.org/) installed on your system and the [Computo extension](https://github.com/computorg/computo-quarto-extension) to prepare your document. For the latter, once quarto is installed,  run the following to install the extension in the current directory (it creates a `_extension` directory which is ignored by git thanks to `.gitignore` by default): -->
<!-- ```.bash -->
<!-- quarto add computorg/computo-quarto-extension -->
<!-- ``` -->
<!-- [`R`](https://www.r-project.org/) and the following `R` packages must be installed on your computer: [`knitr`](https://cran.r-project.org/package=knitr), [`markdown`](https://cran.r-project.org/package=markdown). -->
<!-- ## Link with your usual tools -->
<!-- Quarto is expecting a `.qmd` markdown file, but will also works with a standard [`Rmarkdown`](https://rmarkdown.rstudio.com/) (`.Rmd`) file. In addition, especially if you are not comfortable with the command line interface, quarto is fully integrated inside the [Rstudio IDE](https://quarto.org/docs/get-started/hello/rstudio.html) so that you can write and build your quarto document inside Rstudio. -->
<!-- Quarto can also process a [Jupyter notebook](https://quarto.org/docs/get-started/hello/jupyter.html) file if you are used to it (it will just require to add the proper YAML metadata^[the same metadata as in the [`template-computo-R.qmd` file](https://github.com/computorg/template-computo-R/blob/main/template-computo-R.qmd) in the first cell, type "Raw", of the notebook]). -->
<!-- **Note**: _More advanced Jupyter-related functionality like Myst/Jupyter book are not supported in this Quarto setup. The markdown syntax inside the Jupyter notebook should follow the Quarto syntax (c.f. [below](#formatting)). If you are more comfortable with using Myst/Jupyter book, we provide a [specific template](https://github.com/computorg/template-computo-myst) but it will requires more formatting work for Computo editorial team, thus highly encourage authors to use the Quarto templates._ -->
<!-- # Formatting -->
<!-- This section covers basic formatting guidelines for quarto documents. -->
<!-- To render a document, run `quarto render`. By default, both PDF and HTML documents are generated: -->
<!-- ```.bash -->
<!-- quarto render template-computo-R.qmd # will render both to html and PDF -->
<!-- ``` -->
<!-- ::: {.callout-tip} -->
<!-- ## Note -->
<!-- To check the syntax of the formatting below, you can use the `</> source` button at the top left of this document. -->
<!-- ::: -->
<!-- ## Basic markdown formatting -->
<!-- **Bold text** or _italic_ -->
<!-- - This is a list -->
<!-- - With more elements -->
<!-- - It isn't numbered. -->
<!-- But we can also do a numbered list -->
<!-- 1. This is my first item -->
<!-- 2. This is my second item -->
<!-- 3. This is my third item -->
<!-- ## Mathematics -->
<!-- ### Mathematical formulae -->
<!-- [LaTeX](https://www.latex-project.org/) code is natively supported[^lualatex], which makes it possible to use mathematical formulae: -->
<!-- [^lualatex]: We use [lualatex](https://lualatex.org/) for this purpose. -->
<!-- $$ -->
<!-- f(x_1, \dots, x_n; \mu, \sigma^2) = -->
<!-- \frac{1}{\sigma \sqrt{2\pi}} \exp{\left(- \frac{1}{2\sigma^2}\sum_{i=1}^n(x_i - \mu)^2\right)} -->
<!-- $$ -->
<!-- It is also posible to cross-reference an equation, see @eq-mylabel: -->
<!-- $$ -->
<!-- \begin{aligned} -->
<!-- D_{x_N} & = \frac12 -->
<!-- \left[\begin{array}{cc} -->
<!-- x_L^\top & x_N^\top \end{array}\right] \, -->
<!-- \left[\begin{array}{cc}  L_L & B \\ B^\top & L_N \end{array}\right] \, -->
<!-- \left[\begin{array}{c} -->
<!-- x_L \\ x_N \end{array}\right] \\ -->
<!-- & = \frac12 (x_L^\top L_L x_L + 2 x_N^\top B^\top x_L + x_N^\top L_N x_N), -->
<!-- \end{aligned} -->
<!-- $$ {#eq-mylabel} -->
<!-- ### Theorems and other amsthem-like environments -->
<!-- Quarto includes a nice support for theorems, with predefined prefix labels for theorems, lemmas, proposition, etc. see [this page](https://quarto.org/docs/authoring/cross-references.html#theorems-and-proofs). Here is a simple example: -->
<!-- ::: {#thm-slln} -->
<!-- ## Strong law of large numbers -->
<!-- The sample average converges almost surely to the expected value: -->
<!-- $$\overline{X}_n\ \xrightarrow{\text{a.s.}}\ \mu \qquad\textrm{when}\ n \to \infty.$$ -->
<!-- ::: -->
<!-- See @thm-slln. -->
<!-- ## R Code -->
<!-- Quarto uses either Jupyter or knitr to render code chunks. This can be triggered in the yaml header. In this tutorial, we use `knitr` (`R` and packages `knitr`, `markdown` must be installed on your computer). -->
<!-- ``` yaml -->
<!-- --- -->
<!-- title: "My Document" -->
<!-- author "Jane Doe" -->
<!-- --- -->
<!-- ``` -->
<!-- `R` code [@R-base] chunks may be embedded as follows: -->
<!-- ```{r r-code, echo=TRUE} -->
<!-- x <- rnorm(10) -->
<!-- ``` -->
<!-- ## Figures -->
<!-- Plots can be generated as follows: -->
<!-- ```{r pressure, message = FALSE} -->
<!-- library("ggplot2") -->
<!-- p <- ggplot(mpg, aes(displ, hwy)) + -->
<!--   geom_point() + -->
<!--   geom_smooth() -->
<!-- p -->
<!-- ``` -->
<!-- It is also possible to create figures from static images: -->
<!-- :::{#fig-logo} -->
<!-- ![](https://computo.sfds.asso.fr/assets/img/logo_text_vertical.png){height=200} -->
<!-- Computo logo (label) -->
<!-- ::: -->
<!-- **Note:** _Until Quarto version 1.3+ is released, including a remote image (from a web URL) in a document (like the image above) will work in the rendered HTML document but will generate an error when building the PDF document (c.f. [related bug report](https://github.com/quarto-dev/quarto-cli/issues/4443))._ -->
<!-- ## Tables -->
<!-- Tables (with label: `@tbl-mylabel` renders @tbl-mylabel) can be generated with markdown as follows -->
<!-- | Tables   |      Are      |  Cool | -->
<!-- |----------|:-------------:|------:| -->
<!-- | col 1 is |  left-aligned | $1600 | -->
<!-- | col 2 is |    centered   |   $12 | -->
<!-- | col 3 is | right-aligned |    $1 | -->
<!-- : my table caption {#tbl-mylabel} -->
<!-- Table can also be generated by some code, for instance with knitr here: -->
<!-- ```{r cars} -->
<!-- knitr::kable(summary(cars), caption = "Table caption.") -->
<!-- ``` -->
<!-- ## Handling references {#sec-references} -->
<!-- ### Bibliographic references -->
<!-- References are displayed as footnotes using -->
<!-- [BibTeX](http://www.bibtex.org/), e.g. `[@computo]` will be displayed -->
<!-- as [@computo], where `computo` is the bibtex key for this specific -->
<!-- entry. The bibliographic information is automatically retrieved from -->
<!-- the `.bib` file specified in the header of this document (here: -->
<!-- `references.bib`). -->
<!-- ### Other cross-references -->
<!-- As already (partially) seen, Quarto includes a mechanism similar to the -->
<!-- bibliographic references for sections, equations, theorems, figures, -->
<!-- lists, etc. Have a look at [this -->
<!-- page](https://quarto.org/docs/authoring/cross-references.html). -->
<!-- ## Advanced formatting -->
<!-- Advanced formatting features are possible and documented (including interactive plots, pseudo-code, (Tikz) diagrams, Lua filters, mixing R + Python in the same document), but are beyond the scope of this simple introduction. We point several entries in this direction. -->
<!-- ::: {.callout-warning} -->
<!-- ## More information -->
<!-- - [The Quarto web site](https://quarto.org) for comprehensive documentation, including: -->
<!--   + [Tutorial](https://quarto.org/docs/get-started/) -->
<!--   + [User guide](https://quarto.org/docs/guide/) -->
<!--   + [Options reference](https://quarto.org/docs/reference/) -->
<!-- - [The template distributed with the Computo Quarto extension](https://computo.sfds.asso.fr/computo-quarto-extension/), which uses such advanced features. -->
<!-- - [Our mock version of the t-SNE paper](https://computo.sfds.asso.fr/published-paper-tsne/), a full and advanced example using Python and the Jupyter kernel. -->
<!-- - [The previously published papers in Computo](https://computo.sfds.asso.fr/publications/) can be used as references. -->
<!-- ::: -->
<!-- # Finalize your submission -->
<!-- ## Handle `R` dependencies with `renv` -->
<!-- To make your work reproducible, you need to fix the packages and environment used to run your analysis. For the `R` system, the `renv` package is one of the possible reliable method, supported by the community. You basically need a couple of commands to setup your environment on your local machine. First, -->
<!-- ```{r, eval = FALSE} -->
<!-- renv::init() -->
<!-- ``` -->
<!-- will initialize your repository. Then you just need to install the dependencies required to run your contribution, for instance,  -->
<!-- ```{r, eval=FALSE} -->
<!-- renv::install("ggplot2") # or equivalently install.packages("ggplot2") -->
<!-- ``` -->
<!-- Non-CRAN packages (*e.g.* Github packages) can be used. Once you are done, you can fix everything with the command -->
<!-- ```{r, eval=FALSE} -->
<!-- renv::snapshot() -->
<!-- ``` -->
<!-- ::: {.callout-important} -->
<!-- The only file that needs to be versioned by git is `renv.lock`. By default, the rest is ignored thanks to `.gitignore`.  -->
<!-- ::: -->
<!-- More details for using `renv` can be found either -->
<!-- - on the [`renv` packge webpage](https://rstudio.github.io/renv/articles/renv.html), or -->
<!-- - on the [quarto page dedicated to environments](https://quarto.org/docs/projects/virtual-environments.html#using-renv) -->
<!-- ## Continuous integration -->
<!-- The repository associated with this template is pre-configure to trigger an action on push that performs the following: -->
<!-- 1. Check out repository on the `ubuntu-latest` machine -->
<!-- 2. Install quarto and dependencies, including the Computo extension -->
<!-- 3. Install R and dependencies with `renv`, using your `renv.lock` file -->
<!-- 4. Render your .qmd file and Publish the results on a gh-page (both HTML and PDF) -->
<!-- The file [.github/workflows/build.yml](https://github.com/computorg/template-computo-R/blob/main/.github/workflows/build.yml) is largely inspired from [this file](https://quarto.org/docs/publishing/github-pages.html#example-knitr-with-renv). -->
<!-- Once this is successful, you are ready to submit your manuscript to the [Computo submission platform](https://computo.scholasticahq.com/). -->
<!-- ::: {.callout-warning} -->
<!-- The first time, you possibly need to create the branch for the action to work. This can be done by running the following command from your computer, in your git repository: -->
<!-- ```.bash -->
<!-- quarto publish gh-pages -->
<!-- ``` -->
<!-- Then, set the branch `gh-page` as the source of your github page, and trigger the action to check that everything works fine. -->
<!-- ::: -->
<!-- ## Data and large files -->
<!-- If your submission materials contain files larger than 50MB, **especially data files**, they won’t fit on a git repository as is. For this reason, we encourage you to put your data or any materials you deem necessary on an external “open data” centered repository hub such a [Zenodo](https://zenodo.org/) or [OSF](https://osf.io/). -->
</section>
<section id="acknowledgements" class="level1 unnumbered">
<h1 class="unnumbered">Acknowledgements</h1>
<p>We thank Romain Griffier for his expertise on the Bordeaux University Hospital Data.</p>
<p>Experiments presented in this paper were conducted using the PlaFRIM experimental testbed, supported by Inria, CNRS (LABRI and IMB), Université de Bordeaux, Bordeaux INP and Conseil Régional d’Aquitaine (see https://www.plafrim.fr), as well as by the MCIA (Mésocentre de Calcul Intensif Aquitain).</p>
<p>This study was carried out in the framework of the University of Bordeaux’s France 2030 program / RRI PHDS.</p>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bala_applications_2018" class="csl-entry" role="listitem">
Bala, Abubakar, Idris Ismail, Rosdiazli Ibrahim, and Sadiq M. Sait. 2018. <span>“Applications of <span>Metaheuristics</span> in <span>Reservoir</span> <span>Computing</span> <span>Techniques</span>: <span>A</span> <span>Review</span>.”</span> <em>IEEE Access</em> 6: 58012–29. <a href="https://doi.org/10.1109/ACCESS.2018.2873770">https://doi.org/10.1109/ACCESS.2018.2873770</a>.
</div>
<div id="ref-carrat_evidence_2021" class="csl-entry" role="listitem">
Carrat, Fabrice, Julie Figoni, Joseph Henny, Jean-Claude Desenclos, Sofiane Kab, Xavier de Lamballerie, and Marie Zins. 2021. <span>“Evidence of Early Circulation of <span>SARS</span>-<span>CoV</span>-2 in <span>France</span>: Findings from the Population-Based <span>‘<span>CONSTANCES</span>’</span> Cohort.”</span> <em>European Journal of Epidemiology</em>, February, 1–4. <a href="https://doi.org/10.1007/s10654-020-00716-2">https://doi.org/10.1007/s10654-020-00716-2</a>.
</div>
<div id="ref-carslaw_worldmet_2023" class="csl-entry" role="listitem">
Carslaw, David. 2023. <span>“Worldmet: <span>Import</span> <span>Surface</span> <span>Meteorological</span> <span>Data</span> from <span>NOAA</span> <span>Integrated</span> <span>Surface</span> <span>Database</span> (<span>ISD</span>).”</span> <a href="https://cran.r-project.org/web/packages/worldmet/index.html">https://cran.r-project.org/web/packages/worldmet/index.html</a>.
</div>
<div id="ref-carvalho_analysis_2021" class="csl-entry" role="listitem">
Carvalho, Kathleen, João Paulo Vicente, Mihajlo Jakovljevic, and João Paulo Ramos Teixeira. 2021. <span>“Analysis and <span>Forecasting</span> <span>Incidence</span>, <span>Intensive</span> <span>Care</span> <span>Unit</span> <span>Admissions</span>, and <span>Projected</span> <span>Mortality</span> <span>Attributable</span> to <span>COVID</span>-19 in <span>Portugal</span>, the <span>UK</span>, <span>Germany</span>, <span>Italy</span>, and <span>France</span>: <span>Predictions</span> for 4 <span>Weeks</span> <span>Ahead</span>.”</span> <em>Bioengineering</em> 8 (6): 84. <a href="https://doi.org/10.3390/bioengineering8060084">https://doi.org/10.3390/bioengineering8060084</a>.
</div>
<div id="ref-noauthor_estimating_2022" class="csl-entry" role="listitem">
COVID-19 Cumulative Infection Collaborators. 2022. <span>“Estimating Global, Regional, and National Daily and Cumulative Infections with <span>SARS</span>-<span>CoV</span>-2 Through <span>Nov</span> 14, 2021: A Statistical Analysis.”</span> <em>Lancet</em>. <a href="https://doi.org/10.1016/S0140-6736(22)00484-6">https://doi.org/10.1016/S0140-6736(22)00484-6</a>.
</div>
<div id="ref-cramer_evaluation_2022-1" class="csl-entry" role="listitem">
Cramer, Estee Y., Evan L. Ray, Velma K. Lopez, Johannes Bracher, Andrea Brennen, and et al. 2022. <span>“Evaluation of Individual and Ensemble Probabilistic Forecasts of <span>COVID</span>-19 Mortality in the <span>United</span> <span>States</span>.”</span> <em>Proceedings of the National Academy of Sciences</em> 119 (15): e2113561119. <a href="https://doi.org/10.1073/pnas.2113561119">https://doi.org/10.1073/pnas.2113561119</a>.
</div>
<div id="ref-etalab_les_2020" class="csl-entry" role="listitem">
Etalab. 2020. <span>“Les Données Relatives Au <span>COVID</span>-19 En <span>France</span> - Data.gouv.fr.”</span> <a href="https://www.data.gouv.fr/fr/pages/donnees-coronavirus/">https://www.data.gouv.fr/fr/pages/donnees-coronavirus/</a>.
</div>
<div id="ref-ferte_thomasfertejss_reservoirnet_2024" class="csl-entry" role="listitem">
Ferté, Thomas, Kalidou Ba, Dan Dutartre, Pierrick Legrand, Vianney Jouhet, Romain Griffier, Rodolphe Thiébaut, Xavier Hinaut, and Boris P. Hejblum. 2024. <span>“Thomasferte/Jss_reservoirnet: <span>First</span> Release.”</span> Zenodo. <a href="https://doi.org/10.5281/ZENODO.11281341">https://doi.org/10.5281/ZENODO.11281341</a>.
</div>
<div id="ref-ferte_optimizing_2024" class="csl-entry" role="listitem">
Ferté, Thomas, Dan Dutartre, Boris P. Hejblum, Romain Griffier, Vianney Jouhet, Rodolphe Thiébaut, Xavier Hinaut, and Pierrick Legrand. 2024. <span>“Optimizing <span>Reservoir</span> <span>Computing</span> with <span>Genetic</span> <span>Algorithm</span> for <span>High</span>-<span>Dimensional</span> <span>SARS</span>-<span>CoV</span>-2 <span>Hospitalization</span> <span>Forecasting</span>: <span>Impacts</span> of <span>Genetic</span> <span>Algorithm</span> <span>Hyperparameters</span> on <span>Feature</span> <span>Selection</span> and <span>Reservoir</span> <span>Computing</span> <span>Hyperparameter</span> <span>Tuning</span>.”</span> In. <a href="https://inria.hal.science/hal-04905975">https://inria.hal.science/hal-04905975</a>.
</div>
<div id="ref-ferte_reservoir_2024" class="csl-entry" role="listitem">
Ferté, Thomas, Dan Dutartre, Boris P Hejblum, Romain Griffier, Vianney Jouhet, Rodolphe Thiébaut, Pierrick Legrand, and Xavier Hinaut. 2024. <span>“Reservoir Computing for Short High-Dimensional Time Series: An Application to <span>SARS</span>-<span>C</span>o<span>V</span>-2 Hospitalization Forecast.”</span> In <em>Proceedings of the 41st International Conference on Machine Learning</em>, edited by Ruslan Salakhutdinov, Zico Kolter, Katherine Heller, Adrian Weller, Nuria Oliver, Jonathan Scarlett, and Felix Berkenkamp, 235:13570–91. Proceedings of Machine Learning Research. PMLR. <a href="https://proceedings.mlr.press/v235/ferte24a.html">https://proceedings.mlr.press/v235/ferte24a.html</a>.
</div>
<div id="ref-ferte_benefit_2022" class="csl-entry" role="listitem">
Ferté, Thomas, Vianney Jouhet, Romain Griffier, Boris P. Hejblum, Rodolphe Thiébaut, and Bordeaux University Hospital Covid-19 Crisis Task Force. 2022. <span>“The Benefit of Augmenting Open Data with Clinical Data-Warehouse <span>EHR</span> for Forecasting <span>SARS</span>-<span>CoV</span>-2 Hospitalizations in <span>Bordeaux</span> Area, <span>France</span>.”</span> <em>JAMIA Open</em> 5 (4): ooac086. <a href="https://doi.org/10.1093/jamiaopen/ooac086">https://doi.org/10.1093/jamiaopen/ooac086</a>.
</div>
<div id="ref-ferte_benefit_2023" class="csl-entry" role="listitem">
Ferté, Thomas, Vianney Jouhet, Romain Griffier, Boris Hejblum, Rodolphe Thiébaut, and Bordeaux University Hospital Covid-19 Crisis Task Force. 2023. <span>“The Benefit of Augmenting Open Data with Clinical Data-Warehouse <span>EHR</span> for Forecasting <span>SARS</span>-<span>CoV</span>-2 Hospitalizations in <span>Bordeaux</span> Area, <span>France</span>.”</span> Dryad. <a href="https://doi.org/10.5061/DRYAD.HHMGQNKKX">https://doi.org/10.5061/DRYAD.HHMGQNKKX</a>.
</div>
<div id="ref-friedman_regularization_2010" class="csl-entry" role="listitem">
Friedman, Jerome, Trevor Hastie, and Rob Tibshirani. 2010. <span>“Regularization <span>Paths</span> for <span>Generalized</span> <span>Linear</span> <span>Models</span> via <span>Coordinate</span> <span>Descent</span>.”</span> <em>Journal of Statistical Software</em> 33 (1): 1–22.
</div>
<div id="ref-ghosh_reservoir_2021" class="csl-entry" role="listitem">
Ghosh, Subrata, Abhishek Senapati, Arindam Mishra, Joydev Chattopadhyay, Syamal K. Dana, Chittaranjan Hens, and Dibakar Ghosh. 2021. <span>“Reservoir Computing on Epidemic Spreading: <span>A</span> Case Study on <span>COVID</span>-19 Cases.”</span> <em>Physical Review E</em> 104 (1): 014308. <a href="https://doi.org/10.1103/PhysRevE.104.014308">https://doi.org/10.1103/PhysRevE.104.014308</a>.
</div>
<div id="ref-hinaut_real-time_2013" class="csl-entry" role="listitem">
Hinaut, Xavier, and Peter Ford Dominey. 2013. <span>“Real-<span>Time</span> <span>Parallel</span> <span>Processing</span> of <span>Grammatical</span> <span>Structure</span> in the <span>Fronto</span>-<span>Striatal</span> <span>System</span>: <span>A</span> <span>Recurrent</span> <span>Network</span> <span>Simulation</span> <span>Study</span> <span>Using</span> <span>Reservoir</span> <span>Computing</span>.”</span> <em>PLOS ONE</em> 8 (2): e52946. <a href="https://doi.org/10.1371/journal.pone.0052946">https://doi.org/10.1371/journal.pone.0052946</a>.
</div>
<div id="ref-hubner_surgery_2020" class="csl-entry" role="listitem">
Hübner, Martin, Tobias Zingg, David Martin, Philippe Eckert, and Nicolas Demartines. 2020. <span>“Surgery for Non-<span>Covid</span>-19 Patients During the Pandemic.”</span> <em>PLoS ONE</em> 15 (10): e0241331. <a href="https://doi.org/10.1371/journal.pone.0241331">https://doi.org/10.1371/journal.pone.0241331</a>.
</div>
<div id="ref-jaeger__2001" class="csl-entry" role="listitem">
Jaeger, Herbert. 2001. <span>“The" Echo State" Approach to Analysing and Training Recurrent Neural Networks-with an Erratum Note’.”</span> <em>Bonn, Germany: German National Research Center for Information Technology GMD Technical Report</em> 148 (January).
</div>
<div id="ref-kim_health_2020" class="csl-entry" role="listitem">
Kim, Gina, Mengru Wang, Hanh Pan, Giana H. Davidson, Alison C. Roxby, Jen Neukirch, Danna Lei, Elicia Hawken-Dennis, Louise Simpson, and Thuan D. Ong. 2020. <span>“A <span>Health</span> <span>System</span> <span>Response</span> to <span>COVID</span>-19 in <span>Long</span>-<span>Term</span> <span>Care</span> and <span>Post</span>-<span>Acute</span> <span>Care</span>: <span>A</span> <span>Three</span>-<span>Phase</span> <span>Approach</span>.”</span> <em>Journal of the American Geriatrics Society</em> 68 (6): 1155–61. <a href="https://doi.org/10.1111/jgs.16513">https://doi.org/10.1111/jgs.16513</a>.
</div>
<div id="ref-kmet_bezier_2019" class="csl-entry" role="listitem">
Kmet, Tibor, and Maria Kmetova. 2019. <span>“Bézier Curve Parametrisation and Echo State Network Methods for Solving Optimal Control Problems of <span>SIR</span> Model.”</span> <em>Biosystems</em> 186 (December): 104029. <a href="https://doi.org/10.1016/j.biosystems.2019.104029">https://doi.org/10.1016/j.biosystems.2019.104029</a>.
</div>
<div id="ref-kudo_multidimensional_1999" class="csl-entry" role="listitem">
Kudo, Mineichi, Jun Toyama, and Masaru Shimbo. 1999. <span>“Multidimensional Curve Classification Using Passing-Through Regions.”</span> <em>Pattern Recognition Letters</em> 20 (11): 1103–11. <a href="https://doi.org/10.1016/S0167-8655(99)00077-X">https://doi.org/10.1016/S0167-8655(99)00077-X</a>.
</div>
<div id="ref-liu_nanophotonic_2023" class="csl-entry" role="listitem">
Liu, Bocheng, Yiyuan Xie, Weichen Liu, Xiao Jiang, Yichen Ye, Tingting Song, Junxiong Chai, Manying Feng, and Haodong Yuan. 2023. <span>“Nanophotonic Reservoir Computing for <span>COVID</span>-19 Pandemic Forecasting.”</span> <em>Nonlinear Dynamics</em> 111 (7): 6895–6914. <a href="https://doi.org/10.1007/s11071-022-08190-z">https://doi.org/10.1007/s11071-022-08190-z</a>.
</div>
<div id="ref-lukosevicius_reservoir_2009" class="csl-entry" role="listitem">
Lukoševičius, Mantas, and Herbert Jaeger. 2009. <span>“Reservoir Computing Approaches to Recurrent Neural Network Training.”</span> <em>Computer Science Review</em> 3 (3): 127–49. <a href="https://doi.org/10.1016/j.cosrev.2009.03.005">https://doi.org/10.1016/j.cosrev.2009.03.005</a>.
</div>
<div id="ref-maass_real-time_2002" class="csl-entry" role="listitem">
Maass, Wolfgang, Thomas Natschläger, and Henry Markram. 2002. <span>“Real-Time Computing Without Stable States: A New Framework for Neural Computation Based on Perturbations.”</span> <em>Neural Computation</em> 14 (11): 2531–60. <a href="https://doi.org/10.1162/089976602760407955">https://doi.org/10.1162/089976602760407955</a>.
</div>
<div id="ref-martinuzzi_reservoircomputingjl_2022" class="csl-entry" role="listitem">
Martinuzzi, Francesco, Chris Rackauckas, Anas Abdelrehim, Miguel D. Mahecha, and Karin Mora. 2022. <span>“<span>ReservoirComputing</span>.jl: <span>An</span> <span>Efficient</span> and <span>Modular</span> <span>Library</span> for <span>Reservoir</span> <span>Computing</span> <span>Models</span>.”</span> <em>Journal of Machine Learning Research</em> 23 (288): 1–8. <a href="http://jmlr.org/papers/v23/22-0611.html">http://jmlr.org/papers/v23/22-0611.html</a>.
</div>
<div id="ref-mohimont_convolutional_2021" class="csl-entry" role="listitem">
Mohimont, Lucas, Amine Chemchem, François Alin, Michaël Krajecki, and Luiz Angelo Steffenel. 2021. <span>“Convolutional Neural Networks and Temporal <span>CNNs</span> for <span>COVID</span>-19 Forecasting in <span>France</span>.”</span> <em>Applied Intelligence</em>, April. <a href="https://doi.org/10.1007/s10489-021-02359-6">https://doi.org/10.1007/s10489-021-02359-6</a>.
</div>
<div id="ref-nakane_reservoir_2018" class="csl-entry" role="listitem">
Nakane, Ryosho, Gouhei Tanaka, and Akira Hirose. 2018. <span>“Reservoir <span>Computing</span> <span>With</span> <span>Spin</span> <span>Waves</span> <span>Excited</span> in a <span>Garnet</span> <span>Film</span>.”</span> <em>IEEE Access</em> PP (January): 1–1. <a href="https://doi.org/10.1109/ACCESS.2018.2794584">https://doi.org/10.1109/ACCESS.2018.2794584</a>.
</div>
<div id="ref-paireau_ensemble_2022" class="csl-entry" role="listitem">
Paireau, Juliette, Alessio Andronico, Nathanaël Hozé, Maylis Layan, Pascal Crépey, Alix Roumagnac, Marc Lavielle, Pierre-Yves Boëlle, and Simon Cauchemez. 2022. <span>“An Ensemble Model Based on Early Predictors to Forecast <span>COVID</span>-19 Health Care Demand in <span>France</span>.”</span> <em>Proceedings of the National Academy of Sciences</em> 119 (18): e2103302119. <a href="https://doi.org/10.1073/pnas.2103302119">https://doi.org/10.1073/pnas.2103302119</a>.
</div>
<div id="ref-penkovsky_efficient_2018" class="csl-entry" role="listitem">
Penkovsky, Bogdan, Laurent Larger, and Daniel Brunner. 2018. <span>“Efficient Design of Hardware-Enabled Reservoir Computing in <span>FPGAs</span>.”</span> <em>Journal of Applied Physics</em> 124 (16): 162101. <a href="https://doi.org/10.1063/1.5039826">https://doi.org/10.1063/1.5039826</a>.
</div>
<div id="ref-pottier_forecast_2021" class="csl-entry" role="listitem">
Pottier, Loı̈c. 2021. <span>“Forecast of the Covid19 Epidemic in France.”</span> <em><span>medRxiv</span></em>. <a href="https://doi.org/10.1101/2021.04.13.21255418">https://doi.org/10.1101/2021.04.13.21255418</a>.
</div>
<div id="ref-prychynenko_magnetic_2018" class="csl-entry" role="listitem">
Prychynenko, Diana, Matthias Sitte, Kai Litzius, Benjamin Krüger, George Bourianoff, Mathias Kläui, Jairo Sinova, and Karin Everschor-Sitte. 2018. <span>“Magnetic <span>Skyrmion</span> as a <span>Nonlinear</span> <span>Resistive</span> <span>Element</span>: <span>A</span> <span>Potential</span> <span>Building</span> <span>Block</span> for <span>Reservoir</span> <span>Computing</span>.”</span> <em>Physical Review Applied</em> 9 (1): 014034. <a href="https://doi.org/10.1103/PhysRevApplied.9.014034">https://doi.org/10.1103/PhysRevApplied.9.014034</a>.
</div>
<div id="ref-rafayelyan_large-scale_2020" class="csl-entry" role="listitem">
Rafayelyan, Mushegh, Jonathan Dong, Yongqi Tan, Florent Krzakala, and Sylvain Gigan. 2020. <span>“Large-<span>Scale</span> <span>Optical</span> <span>Reservoir</span> <span>Computing</span> for <span>Spatiotemporal</span> <span>Chaotic</span> <span>Systems</span> <span>Prediction</span>.”</span> <em>Physical Review X</em> 10 (4): 041037. <a href="https://doi.org/10.1103/PhysRevX.10.041037">https://doi.org/10.1103/PhysRevX.10.041037</a>.
</div>
<div id="ref-rahimi_review_2021" class="csl-entry" role="listitem">
Rahimi, Iman, Fang Chen, and Amir H. Gandomi. 2021. <span>“A Review on <span>COVID</span>-19 Forecasting Models.”</span> <em>Neural Computing &amp; Applications</em>, February, 1–11. <a href="https://doi.org/10.1007/s00521-020-05626-8">https://doi.org/10.1007/s00521-020-05626-8</a>.
</div>
<div id="ref-ray_optimized_2021" class="csl-entry" role="listitem">
Ray, Arnob, Tanujit Chakraborty, and Dibakar Ghosh. 2021. <span>“Optimized Ensemble Deep Learning Framework for Scalable Forecasting of Dynamics Containing Extreme Events.”</span> <em>Chaos (Woodbury, N.Y.)</em> 31 (11): 111105. <a href="https://doi.org/10.1063/5.0074213">https://doi.org/10.1063/5.0074213</a>.
</div>
<div id="ref-roumagnac_etude_2021" class="csl-entry" role="listitem">
Roumagnac, Alix, Eurico de Carvalho Filho, Raphaël Bertrand, Anne-Kim Banchereau, and Guillaume Lahache. 2021. <span>“Étude de l’influence Potentielle de l’humidité Et de La Température Dans La Propagation de La Pandémie <span>COVID</span>-19.”</span> <em>Médecine de Catastrophe - Urgences Collectives</em>, Douleur et situations d’<span>exceptionPandémie</span> <span>COVID</span>-19, 5 (1): 87–102. <a href="https://doi.org/10.1016/j.pxur.2021.01.002">https://doi.org/10.1016/j.pxur.2021.01.002</a>.
</div>
<div id="ref-simoes_organisation_2021" class="csl-entry" role="listitem">
Simões, Jorge, João Paulo Moreira Magalhães, André Biscaia, António da Luz Pereira, Gonçalo Figueiredo Augusto, and Inês Fronteira. 2021. <span>“Organisation of the <span>State</span>, Model of Health System and <span>COVID</span>‐19 Health Outcomes in Six <span>European</span> Countries, During the First Months of the <span>COVID</span>‐19 Epidemic in 2020.”</span> <em>The International Journal of Health Planning and Management</em>, June, 10.1002/hpm.3271. <a href="https://doi.org/10.1002/hpm.3271">https://doi.org/10.1002/hpm.3271</a>.
</div>
<div id="ref-smith_integrated_2011" class="csl-entry" role="listitem">
Smith, Adam, Neal Lott, and Russ Vose. 2011. <span>“The <span>Integrated</span> <span>Surface</span> <span>Database</span>: <span>Recent</span> <span>Developments</span> and <span>Partnerships</span>.”</span> <em>Bulletin of the American Meteorological Society</em> 92 (6): 704–8. <a href="https://doi.org/10.1175/2011BAMS3015.1">https://doi.org/10.1175/2011BAMS3015.1</a>.
</div>
<div id="ref-tanaka_recent_2019" class="csl-entry" role="listitem">
Tanaka, Gouhei, Toshiyuki Yamane, Jean Benoit Héroux, Ryosho Nakane, Naoki Kanazawa, Seiji Takeda, Hidetoshi Numata, Daiju Nakano, and Akira Hirose. 2019. <span>“Recent Advances in Physical Reservoir Computing: <span>A</span> Review.”</span> <em>Neural Networks</em> 115 (July): 100–123. <a href="https://doi.org/10.1016/j.neunet.2019.03.005">https://doi.org/10.1016/j.neunet.2019.03.005</a>.
</div>
<div id="ref-trouvain_canary_2021" class="csl-entry" role="listitem">
Trouvain, Nathan, and Xavier Hinaut. 2021. <span>“Canary <span>Song</span> <span>Decoder</span>: <span>Transduction</span> and <span>Implicit</span> <span>Segmentation</span> with <span>ESNs</span> and <span>LTSMs</span>.”</span> In <em>Artificial <span>Neural</span> <span>Networks</span> and <span>Machine</span> <span>Learning</span> – <span>ICANN</span> 2021</em>, edited by Igor Farkaš, Paolo Masulli, Sebastian Otte, and Stefan Wermter, 71–82. Lecture <span>Notes</span> in <span>Computer</span> <span>Science</span>. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-030-86383-8_6">https://doi.org/10.1007/978-3-030-86383-8_6</a>.
</div>
<div id="ref-trouvain_reservoirpy_2022" class="csl-entry" role="listitem">
———. 2022. <span>“Reservoirpy: <span>A</span> <span>Simple</span> and <span>Flexible</span> <span>Reservoir</span> <span>Computing</span> <span>Tool</span> in <span>Python</span>.”</span> <a href="https://inria.hal.science/hal-03699931">https://inria.hal.science/hal-03699931</a>.
</div>
<div id="ref-trouvain_reservoirpy_2020" class="csl-entry" role="listitem">
Trouvain, Nathan, Luca Pedrelli, Thanh Trung Dinh, and Xavier Hinaut. 2020. <span>“<span>ReservoirPy</span>: An <span>Efficient</span> and <span>User</span>-<span>Friendly</span> <span>Library</span> to <span>Design</span> <span>Echo</span> <span>State</span> <span>Networks</span>.”</span> In <em><span>A</span>rtificial <span>N</span>eural <span>N</span>etworks and <span>M</span>achine <span>L</span>earning – <span>ICANN</span> 2020</em>, 494–505. Springer International Publishing. <a href="https://inria.hal.science/hal-02595026">https://inria.hal.science/hal-02595026</a>.
</div>
<div id="ref-trouvain_create_2022" class="csl-entry" role="listitem">
Trouvain, Nathan, Nicolas Rougier, and Xavier Hinaut. 2022. <span>“Create <span>Efficient</span> and&nbsp;<span>Complex</span> <span>Reservoir</span> <span>Computing</span> <span>Architectures</span> with&nbsp;<span>ReservoirPy</span>.”</span> In <em>From <span>Animals</span> to <span>Animats</span> 16</em>, edited by Lola Cañamero, Philippe Gaussier, Myra Wilson, Sofiane Boucenna, and Nicolas Cuperlier, 91–102. Lecture <span>Notes</span> in <span>Computer</span> <span>Science</span>. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-031-16770-6_8">https://doi.org/10.1007/978-3-031-16770-6_8</a>.
</div>
<div id="ref-reticulate_2024" class="csl-entry" role="listitem">
Ushey, Kevin, JJ Allaire, and Yuan Tang. 2024. <em>Reticulate: Interface to ’Python’</em>. <a href="https://rstudio.github.io/reticulate/">https://rstudio.github.io/reticulate/</a>.
</div>
<div id="ref-vlachas_backpropagation_2020" class="csl-entry" role="listitem">
Vlachas, P. R., J. Pathak, B. R. Hunt, T. P. Sapsis, M. Girvan, E. Ott, and P. Koumoutsakos. 2020. <span>“Backpropagation Algorithms and <span>Reservoir</span> <span>Computing</span> in <span>Recurrent</span> <span>Neural</span> <span>Networks</span> for the Forecasting of Complex Spatiotemporal Dynamics.”</span> <em>Neural Networks</em> 126 (June): 191–217. <a href="https://doi.org/10.1016/j.neunet.2020.02.016">https://doi.org/10.1016/j.neunet.2020.02.016</a>.
</div>
<div id="ref-wickham_dplyr_2023" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <span>“<span class="nocase">dplyr</span>: <span>A</span> <span>Grammar</span> of <span>Data</span> <span>Manipulation</span>.”</span> <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-wickham_ggplot2_2016" class="csl-entry" role="listitem">
Wickham, Hadley, Danielle Navarro, and Thomas Lin Pedersen. 2018. <em><span class="nocase">ggplot2</span>: <span>Elegant</span> <span>Graphics</span> for <span>Data</span> <span>Analysis</span> (3e)</em>. 3rd ed. Springer-Verlag New York. <a href="https://ggplot2-book.org/">https://ggplot2-book.org/</a>.
</div>
<div id="ref-world_health_organisation_who_2020" class="csl-entry" role="listitem">
World Health Organisation. 2020. <span>“<span>WHO</span> <span>Coronavirus</span> (<span>COVID</span>-19) <span>Dashboard</span>.”</span> <a href="https://covid19.who.int">https://covid19.who.int</a>.
</div>
<div id="ref-zhang_sentiment_2023" class="csl-entry" role="listitem">
Zhang, Qihuang, Grace Y. Yi, Li-Pang Chen, and Wenqing He. 2023. <span>“Sentiment Analysis and Causal Learning of <span>COVID</span>-19 Tweets Prior to the Rollout of Vaccines.”</span> <em>PloS One</em> 18 (2): e0277878. <a href="https://doi.org/10.1371/journal.pone.0277878">https://doi.org/10.1371/journal.pone.0277878</a>.
</div>
<div id="ref-zhang2022catch22s" class="csl-entry" role="listitem">
Zhang, Yuanzhao, and Sean P. Cornelius. 2022. <span>“Catch-22s of Reservoir Computing.”</span> <em>arXiv Preprint arXiv:2210.10211</em>. <a href="https://arxiv.org/abs/2210.10211">https://arxiv.org/abs/2210.10211</a>.
</div>
<div id="ref-zhang2024instability" class="csl-entry" role="listitem">
———. 2024. <span>“How More Data Can Hurt: Instability and Regularization in Next-Generation Reservoir Computing.”</span> <em>arXiv Preprint arXiv:2407.08641</em>. <a href="https://arxiv.org/abs/2407.08641">https://arxiv.org/abs/2407.08641</a>.
</div>
</div>
</section>



<div id="quarto-appendix" class="default"><section id="session-information" class="level1 appendix unnumbered"><h2 class="anchored quarto-appendix-heading">Session information</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Hide/Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14)
Platform: x86_64-pc-linux-gnu
Running under: Ubuntu 24.04.2 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.12.0 
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.12.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
 [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
 [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
[10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

time zone: Etc/UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
[1] reservoirnet_0.2.0 ggplot2_3.5.1      dplyr_1.1.4       

loaded via a namespace (and not attached):
 [1] utf8_1.2.4        generics_0.1.3    tidyr_1.3.1       renv_1.0.11      
 [5] rstatix_0.7.2     lattice_0.20-45   stringi_1.8.4     digest_0.6.37    
 [9] magrittr_2.0.3    evaluate_1.0.1    grid_4.4.1        timechange_0.3.0 
[13] fastmap_1.2.0     rprojroot_2.0.4   jsonlite_1.8.9    Matrix_1.7-1     
[17] slider_0.3.2      backports_1.5.0   brio_1.1.5        Formula_1.2-5    
[21] purrr_1.0.2       fansi_1.0.6       scales_1.3.0      abind_1.4-8      
[25] cli_3.6.3         rlang_1.1.4       munsell_0.5.1     withr_3.0.2      
[29] yaml_2.3.10       tools_4.4.1       ggsignif_0.6.4    colorspace_2.1-1 
[33] ggpubr_0.6.0      here_1.0.1        broom_1.0.7       reticulate_1.40.0
[37] png_0.1-8         vctrs_0.6.5       R6_2.5.1          lifecycle_1.0.4  
[41] lubridate_1.9.3   snakecase_0.11.1  stringr_1.5.1     car_3.1-3        
[45] janitor_2.2.0     warp_0.2.1        pkgconfig_2.0.3   pillar_1.9.0     
[49] gtable_0.3.6      Rcpp_1.0.13-1     glue_1.8.0        xfun_0.49        
[53] tibble_3.2.1      tidyselect_1.2.1  knitr_1.49        farver_2.1.2     
[57] htmltools_0.5.8.1 labeling_0.4.3    rmarkdown_2.29    carData_3.0-5    
[61] testthat_3.2.1.1  compiler_4.4.1   </code></pre>
</div>
</div>
<!-- -->

</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>In this article, we employ the term “train set” to refer to the combined dataset consisting of both the training and validation sets, which are cycled through in a cross-validation manner.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@article{ferté2025,
  author = {Ferté, Thomas and Ba, Kalidou and Dutartre, Dan and Legrand,
    Pierrick and Jouhet, Vianney and Thiébaut, Rodolphe and Hinaut,
    Xavier and Hejblum, Boris},
  publisher = {Société Française de Statistique},
  title = {Reservoir {Computing} in {R:} A {Tutorial} for {Using}
    Reservoirnet to {Predict} {Complex} {Time-Series}},
  journal = {Computo},
  date = {2025-04-14},
  url = {https://computo.sfds.asso.fr/template-computo-quarto},
  doi = {xxxx},
  issn = {2824-7795},
  langid = {en},
  abstract = {Reservoir Computing (RC) is a machine learning method
    based on neural networks that efficiently process information
    generated by dynamical systems. It has been successful in solving
    various tasks including time series forecasting, language processing
    or voice processing. RC is implemented in `Python` and `Julia` but
    not in `R`. This article introduces `reservoirnet`, an `R` package
    providing access to the `Python` API `ReservoirPy`, allowing `R`
    users to harness the power of reservoir computing. This article
    provides an introduction to the fundamentals of RC and showcases its
    real-world applicability through three distinct sections. First, we
    cover the foundational concepts of RC, setting the stage for
    understanding its capabilities. Next, we delve into the practical
    usage of `reservoirnet` through two illustrative examples. These
    examples demonstrate how it can be applied to real-world problems,
    specifically, regression of COVID-19 hospitalizations and
    classification of Japanese vowels. Finally, we present a
    comprehensive analysis of a real-world application of
    `reservoirnet`, where it was used to forecast COVID-19
    hospitalizations at Bordeaux University Hospital using public data
    and electronic health records.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-ferté2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Ferté, Thomas, Kalidou Ba, Dan Dutartre, Pierrick Legrand, Vianney
Jouhet, Rodolphe Thiébaut, Xavier Hinaut, and Boris Hejblum. 2025.
<span>“Reservoir Computing in R: A Tutorial for Using Reservoirnet to
Predict Complex Time-Series.”</span> <em>Computo</em>, April. <a href="https://doi.org/xxxx">https://doi.org/xxxx</a>.
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Reservoir Computing in R: a Tutorial for Using reservoirnet to Predict Complex Time-Series"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subtitle: "Example dedicated to `R` users"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Thomas Ferté</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0001-8455-4665</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inserm, Inria</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inserm Bordeaux Population Health Research Center UMR 1219, Inria BSO, team SISTM, F-33000 Bordeaux, France</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: CHU de Bordeaux</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">        department: "Bordeaux Hospital University Center, Pôle de santé publique, Service d'information médicale, F-33000 Bordeaux, France"</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Kalidou Ba</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0001-6552-265X</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inserm, Inria</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inserm Bordeaux Population Health Research Center UMR 1219, Inria BSO, team SISTM, F-33000 Bordeaux, France</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Dan Dutartre</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0001-8210-461X</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inria</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inria BSO</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Pierrick Legrand</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inria</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inria BSO, F-33000 Bordeaux, France</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: IMB</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="co">        department: IMB, Institut de Mathématiques de Bordeaux, UMR CNRS 5251</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Vianney Jouhet</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0001-5272-2265</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inserm</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inserm Bordeaux Population Health Research Center UMR 1219, team AHeaD, F-33000 Bordeaux</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: CHU de Bordeaux</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="co">        department: "Bordeaux Hospital University Center, Pôle de santé publique, Service d'information médicale, F-33000 Bordeaux, France"</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Rodolphe Thiébaut</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0002-5235-3962</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inserm, Inria</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inserm Bordeaux Population Health Research Center UMR 1219, Inria BSO, team SISTM, F-33000 Bordeaux, France</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: CHU de Bordeaux</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="co">        department: "Bordeaux Hospital University Center, Pôle de santé publique, Service d'information médicale, F-33000 Bordeaux, France"</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Xavier Hinaut</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: false</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0002-1924-1184</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inria</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inria BSO, F-33000 Bordeaux, France</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: CNRS</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Univ. Bordeaux, CNRS, IMN, UMR 5293, Bordeaux, France</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: LaBRI</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="co">        department: LaBRI, Univ. Bordeaux, Bordeaux INP, CNRS UMR 5800.</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Boris Hejblum</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="co">    email: boris.hejblum@u-bordeaux.fr</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: true</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0003-0646-452X</span></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: Inserm, Inria</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="co">        department: Inserm Bordeaux Population Health Research Center UMR 1219, Inria BSO, team SISTM, F-33000 Bordeaux, France</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="co"># description: |</span></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   This document provides a template based on the [`quarto`](https://quarto.org/) system for contributions to Computo, using the [`quarto journal extension`](https://github.com/computorg/computo-quarto-extension), the knitr kernel (R user) and [`renv`](https://rstudio.github.io/renv/articles/renv.html) to set-up the dependencies.</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> &gt;+</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a><span class="co">  Reservoir Computing (RC) is a machine learning method based on neural networks that efficiently process information generated by dynamical systems. It has been successful in solving various tasks including time series forecasting, language processing or voice processing. RC is implemented in `Python` and `Julia` but not in `R`. This article introduces `reservoirnet`, an `R` package providing access to the `Python` API `ReservoirPy`, allowing `R` users to harness the power of reservoir computing. This article provides an introduction to the fundamentals of RC and showcases its real-world applicability through three distinct sections. First, we cover the foundational concepts of RC, setting the stage for understanding its capabilities. Next, we delve into the practical usage of `reservoirnet` through two illustrative examples. These examples demonstrate how it can be applied to real-world problems, specifically, regression of COVID-19 hospitalizations and classification of Japanese vowels. Finally, we present a comprehensive analysis of a real-world application of `reservoirnet`, where it was used to forecast COVID-19 hospitalizations at Bordeaux University Hospital using public data and electronic health records.</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span><span class="co"> [Reservoir Computing, Covid-19, Electronic Health Records, Time series]</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a><span class="co">  type: article-journal</span></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a><span class="co">  container-title: "Computo"</span></span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a><span class="co">  doi: "xxxx"</span></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://computo.sfds.asso.fr/template-computo-quarto</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a><span class="co">  publisher: "Société Française de Statistique"</span></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a><span class="co">  issn: "2824-7795"</span></span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="an">github-user:</span><span class="co"> computorg</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a><span class="an">repo:</span><span class="co"> "thomasferte/reservoirnet_computo"</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true # set to false once the build is running</span></span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="an">published:</span><span class="co"> false # will be set to true once accepted</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a><span class="co">  computo-html: default</span></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a><span class="co">  computo-pdf: </span></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: true</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a><span class="co">    tidy: styler</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, setup, include=FALSE}</span></span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a><span class="in">options(prompt = 'R&gt; ', continue = '+ ')</span></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(1)</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>Reservoir Computing (RC) is a prominent machine learning method, proposed by @jaeger__2001, @maass_real-time_2002 and @lukosevicius_reservoir_2009</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>that has gained significant attention in recent years for its ability to efficiently process information generated by dynamical systems. This</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>innovative approach leverages the dynamics of a high-dimensional "reservoir" (we define it below) to perform complex computations and solve various tasks based on the response of this dynamical system to input signals. RC has demonstrated its efficacy in tackling various challenges, encompassing pattern classification and time series forecasting in applications ranging from electrocardiogram analysis to bird calls <span class="co">[</span><span class="ot">@trouvain_canary_2021</span><span class="co">]</span>, language processing <span class="co">[</span><span class="ot">@hinaut_real-time_2013</span><span class="co">]</span>, power plants, internet traffic, stock prices, and beyond <span class="co">[</span><span class="ot">@lukosevicius_reservoir_2009; @tanaka_recent_2019</span><span class="co">]</span>.</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>Originally, the RC paradigm was implemented in artificial firing-rate neurons ("Echo State Networks", @jaeger__2001) and spiking neurons ("Liquid State Machine", @maass_real-time_2002) as a recurrent neural network (RNN) where the internal recurrent connections, denoted as the reservoir, are randomly generated and only the output layer (named "read-out") is trained. The reservoir projects temporal input signals onto a high-dimensional feature space, facilitating the learning of non-linear and temporal interactions. Thus, this recurrent layer contains high-dimensional non-linear recombination of the inputs and past states: it is a "reservoir of computations" from which useful information can be linearly extracted (or "read-out") to provide the desired outputs. This offers the advantage of decreasing the computing time compared to conventional RNNs while consistently maintaining performance <span class="co">[</span><span class="ot">@vlachas_backpropagation_2020</span><span class="co">]</span>. Besides, this RC paradigm fostered increasing interest thanks to its ability to be implemented on classical computers, as the hidden recurrent layer can be kept untrained. A wide range of physical media can be also used to replace it and @tanaka_recent_2019 recently reviewed this prolific field: from FPGA hardware <span class="co">[</span><span class="ot">@penkovsky_efficient_2018</span><span class="co">]</span>, to spin waves using magnetic properties <span class="co">[</span><span class="ot">@nakane_reservoir_2018</span><span class="co">]</span>, skrymions <span class="co">[</span><span class="ot">@prychynenko_magnetic_2018</span><span class="co">]</span> or optical implementations <span class="co">[</span><span class="ot">@rafayelyan_large-scale_2020</span><span class="co">]</span>. This provides interesting and potentially more efficient alternative to traditional machine learning computing.</span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>RC leverages various hyperparameters to introduce prior knowledge about the relationship between input variables and output targets. But because the connections within the reservoir are randomly initialized, the same set of hyperparameters may exhibit diverse behaviors across different instances of the reservoir connections. This unpredictability makes it challenging to anticipate the performance of a particular hyperparameter setting, as identical settings may produce varying outcomes when applied to distinct instances of the reservoir. Moreover, selecting the most suitable hyperparameters often requires researchers to experiment with multiple combinations on a training dataset and evaluate their performance on a separate test set^<span class="co">[</span><span class="ot">In this article, we employ the term "train set" to refer to the combined dataset consisting of both the training and validation sets, which are cycled through in a cross-validation manner.</span><span class="co">]</span>. Although this approach can be resource-intensive and time-consuming, it is a compromise that is acceptable considering the rapid simulation capabilities offered by RC. Furthermore, there is a current absence of implementation in <span class="in">`R`</span>, rendering the method challenging for users unfamiliar with Python <span class="co">[</span><span class="ot">@trouvain_reservoirpy_2022</span><span class="co">]</span> or Julia <span class="co">[</span><span class="ot">@martinuzzi_reservoircomputingjl_2022</span><span class="co">]</span>.</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>Here, we offer comprehensive guidance to assist new users in maximizing the benefits of RC. Initially, a broad introduction to reservoir computing is presented in @sec-rcpresentation, followed in @sec-basicpackageuse by a tutorial on its application using <span class="in">`reservoirnet`</span>, an <span class="in">`R`</span> package built upon the <span class="in">`ReservoirPy`</span> <span class="in">`Python`</span> module <span class="co">[</span><span class="ot">@trouvain_create_2022; @trouvain_reservoirpy_2022; @trouvain_reservoirpy_2020</span><span class="co">]</span>. @sec-basicpackageuse then introduces the workflow usage on <span class="in">`reservoirnet`</span> for RC with two basic use-cases, and finally, in @sec-studycase we investigate the various challenges associated with an advanced case-study leveraging RC for forecasting COVID-19 hospitalizations. This case-study exploration includes detailed guidance on the modeling strategy, the selection of hyperparameters, and the implementation process.</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a><span class="fu"># RC presentation {#sec-rcpresentation}</span></span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>RC is a machine learning paradigm which is most often implemented as Echo State Networks (ESNs), i.e. the firing-rate neuron version <span class="co">[</span><span class="ot">@jaeger__2001</span><span class="co">]</span>. An ESN is described by three matrices of connectivity: an input layer $W_{in}$, a recurrent layer $W$ and an output layer $W_{out}$. At each time step, the input vector $u_t$ is projected into the reservoir which is also combined with reservoir past state $x(t-1)$ through the recurrent connections. The output $y(t)$ is linearly read-out from the reservoir. Input $W_{in}$ and recurrent $W$ matrices are kept random; only the output matrix $W_{out}$ is trained in an offline or online method. Often a ridge regression (i.e. a regularized linear regression) is used to obtain the desired outputs $y(t)$ from the reservoir states $x(t)$. @fig-rcpresentation depicts the architecture. For simplicity, we will use the term "reservoir computing" for "Echo State Network" in the remainder of the paper.</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rcpresentation, echo=FALSE}</span></span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-rcpresentation</span></span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Reservoir computing is composed of an input layer, a reservoir and an output layer. Connection between input layer and reservoir and inside reservoir are random. Only the output layer is optimized based on a ridge regression. Adapted from @trouvain_reservoirpy_2020"</span></span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: "100%"</span></span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("images/image1.png")</span></span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>The input layer $u(t)$ is an $M$-dimension vector, where $M$ is the number of input time series, which corresponds to the values of the input time series at time $t$ where $t = 1, \dots, T$. The reservoir layer $x(t)$ is an $N_{res}$-dimensional vector where $N_{res}$ is the number of nodes in the reservoir. The value $x(t)$ is defined as follow:</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>x( t+1 ) = ( 1 - \alpha )  x ( t) + \alpha \: tanh\left( W x(t) + W_{in} u(t+1)\right).</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>The leaking rate $\alpha \in <span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$ defines the update rate of the nodes. The closer $\alpha$ is to $1$, the more the reservoir is sensitive to new inputs $u(t)$. Therefore, the reservoir state at time $t+1$ denoted $x(t+1)$ depends on the reservoir state at the previous time $x(t)$ and the new inputs $u(t+1)$. The function $tanh()$ represents the activation function, applied element-wise to each component of the vector, ensuring that each node’s activation is scaled between $-1$ and $1$. Both $W_{in}$ and $W$ are random matrices of size $N_{res} \times M$ and $N_{res} \times N_{res}$ respectively.</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>The input-reservoir connection matrix ($W_{in}$) and the intra-reservoir connection matrix ($W$) are generated in three steps. $W_{in}$ is generated using a Bernoulli (bimodal) distribution where each value can be either $-I_{scale}(m)$ or $I_{scale}(m)$ with an equal probability where $m = 1, \dots, M$ corresponds to a given feature in the input layer. The input scaling, denoted $I_{scale}$, is a hyperparameter coefficient common to all features from the input layer or specific to each feature $m$. In that case, the more important the feature is, the greater should be its input scaling. $W$ is generated from a Gaussian distribution $\mathcal{N}(0,1)$. Both $W_{in}$ and $W$ then undergo sparsification, where a connectivity mask is applied to retain only $10\%$ of the connections, enforcing sparsity. In a third step, the $W$ matrix is scaled according to the defined spectral radius, a hyperparameter defining the highest eigen value of $W$.</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>The final layer is a linear regression with ridge penalization where the</span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a>explanatory features are the reservoir state and the variable to be</span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>explained is the outcome to predict such that:</span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>$$W_{out} = YX^T ( XX^T + \lambda  I)^{ -1 }.$$</span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>Where x(t) and y(t) are accumulated in X and Y respectively such that:</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>X = \begin{bmatrix} x(1) <span class="sc">\\</span> x(2) <span class="sc">\\</span> ... <span class="sc">\\</span> x(T) \end{bmatrix}</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>\text{ and } Y = \begin{bmatrix} y(1) <span class="sc">\\</span> y(2) <span class="sc">\\</span> ... <span class="sc">\\</span> y(T) \end{bmatrix}.</span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>The parameter $\lambda$ is the ridge penalization which aims to prevent overfitting. Additionally, one can also connect the input layer to the output layer to the reservoir nodes. In that case, $X$ is the accumulation of both such that :</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>$$X = \begin{bmatrix} x(1), u(1) <span class="sc">\\</span> x(2), u(2) <span class="sc">\\</span> ... <span class="sc">\\</span> x(T), u(T) \end{bmatrix}</span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>\text{ and } Y = \begin{bmatrix} y(1) <span class="sc">\\</span> y(2) <span class="sc">\\</span> ... <span class="sc">\\</span> y(T) \end{bmatrix}.$$</span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>Overall, there are four main hyperparameters to be chosen by the user: i) the leaking rate which defines the memory of the RC, ii) the input scaling which defines the relative importance of the features, iii) the spectral radius which defines the connections of the neurons inside the reservoir which in turn defines the degree of non-linear combination of features, and iv) the ridge penalization which controls the degree of overfitting. The choice of hyperparameters often requires the user to evaluate the performance of different combinations of hyperparameters on a validation set before selecting the optimal combination to forecast on the test set.</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a><span class="fu"># Usage workflow {#sec-basicpackageuse}</span></span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a>In this section, we will cover the basics of <span class="in">`reservoirnet`</span> use including</span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a>installation, classification and regression. A more in depth description is provided in</span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a> @sec-studycase with the covid-19 forecast use case.</span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## Installation</span></span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a><span class="in">`reservoirnet`</span> is an <span class="in">`R`</span> package making the <span class="in">`Python`</span> module  <span class="in">`ReservoirPy`</span></span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>easily callable from <span class="in">`R`</span> using <span class="in">`reticulate`</span> <span class="in">`R`</span> package @reticulate_2024. It is available on CRAN (see</span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">https://cran.r-project.org/package=reservoirnet</span><span class="co">](https://cran.r-project.org/package=reservoirnet)</span>) and can be installed using:</span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a><span class="in"># Install reservoirnet package from CRAN</span></span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages("reservoirnet")</span></span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a>Alternatively, it can also be installed from GitHub:</span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a><span class="in"># Install reservoirnet package from GitHub</span></span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a><span class="in">devtools::install_github(repo = "reservoirpy/reservoirR")</span></span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a>For <span class="in">`reservoirnet`</span> to work, it will require <span class="in">`Python`</span> version 3.8 or higher, along with the <span class="in">`reservoirpy`</span> module which can be installed with the <span class="in">`install_reservoirpy()`</span> function:</span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a><span class="in">reservoirnet::install_reservoirpy()</span></span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a>Reservoir Computing (RC) is well suited to both regression and</span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true" tabindex="-1"></a>classification tasks. We will introduce a simple example for both task.</span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Package workflow overview</span></span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r schemaworkflow, echo=FALSE}</span></span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-schemaworkflow</span></span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Worflow of `reservoirnet`."</span></span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: "75%"</span></span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("images/schema_workflow.png")</span></span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a>The workflow of <span class="in">`reservoirnet`</span> is described in @fig-schemaworkflow. A reservoir model is created by the association of an input layer (a matrix), a reservoir, and an output layer. Both the reservoir and the output layer are created using the function <span class="in">`reservoirnet::createNode()`</span> by specifying the node type (i.e., either <span class="in">`Reservoir`</span> or <span class="in">`Ridge`</span>).</span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a>This function accepts several arguments to specify the hyperparameters of the reservoir and will be detailed in future sections. After the reservoir and output layer are created, they can be connected using the <span class="in">`%&gt;&gt;%`</span> operator, a specific pipe operator dedicated to <span class="in">`reservoirnet`</span>. The model can then be fitted using <span class="in">`reservoirR_fit()`</span> and used to make predictions on a new dataset using <span class="in">`predict_seq()`</span>.</span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic regression use-case {#sec-basicregression}</span></span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### Covid-19 data</span></span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a>In this first use-case, we will introduce the fundamental usage of the <span class="in">`reservoirnet`</span> package. This demonstration will be conducted using the COVID-19 dataset that is included within the package. These data encompass hospitalization, positive RT-PCR (Reverse Transcription Polymerase Chain Reaction) results, and overall RT-PCR data sourced from Santé Publique France, which are publicly available on data.gouv.fr (for further details, refer to <span class="in">`help(dfCovid)`</span>). Our primary objective is to predict the number of hospitalized patients 14 days into the future. To accomplish this, we will initially train our model on data preceding the date of January 1, 2022, and then apply it to forecast values using the following dataset.</span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a>We can proceed by loading useful packages - namely <span class="in">`ggplot2`</span> @wickham_ggplot2_2016 and <span class="in">`dplyr`</span> @wickham_dplyr_2023, data and define the task:</span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a><span class="in"># Load usefull packages</span></span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a><span class="in">library(reservoirnet)</span></span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a><span class="in"># load dfCovid data from the reservoirnet package which contains Covid data</span></span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a><span class="in">data("dfCovid")</span></span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a><span class="in"># Set the forecast horizon to 14 days</span></span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a><span class="in">dist_forecast = 14</span></span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a><span class="in"># Set the train-test split to 2022-01-01</span></span>
<span id="cb36-211"><a href="#cb36-211" aria-hidden="true" tabindex="-1"></a><span class="in">traintest_date = as.Date("2022-01-01")</span></span>
<span id="cb36-212"><a href="#cb36-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a>Due to the substantial fluctuations observed in both RT-PCR metrics, our initial step involves applying a moving average computation over the most recent 7-day periods for these features. Additionally, we augment the dataset by introducing an <span class="in">`outcome`</span> column and an <span class="in">`outcomeDate`</span> column, which will serve as valuable inputs for model training. Moreover, we calculate the <span class="in">`outcome_deriv`</span> as the difference between the outcome and the number of hospitalized patients (<span class="in">`hosp`</span>), representing the variation in hospitalization in relation to the current count of hospitalized individuals. The resulting smoothed data is visualized in @fig-covidintro.</span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a>dfOutcome <span class="ot">&lt;-</span> dfCovid <span class="sc">%&gt;%</span></span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcome at 14 days</span></span>
<span id="cb36-221"><a href="#cb36-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">lead</span>(<span class="at">x =</span> hosp, <span class="at">n =</span> dist_forecast),</span>
<span id="cb36-222"><a href="#cb36-222" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcome' which contains the number of</span></span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a>         <span class="co"># hospitalizations ('hosp') shifted forward by 'dist_forecast' days</span></span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a>         <span class="co"># (14 days). This represents the outcome we want to predict.</span></span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcomeDate =</span> date <span class="sc">+</span> dist_forecast,</span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcomeDate' which is the current date plus the</span></span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a>         <span class="co"># forecast period (14 days).</span></span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>         <span class="at">outcome_deriv =</span> outcome <span class="sc">-</span> hosp) <span class="sc">%&gt;%</span></span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Create a new column 'outcome_deriv' which is the difference between</span></span>
<span id="cb36-232"><a href="#cb36-232" aria-hidden="true" tabindex="-1"></a>         <span class="co"># the predicted outcome and current hospitalizations.</span></span>
<span id="cb36-233"><a href="#cb36-233" aria-hidden="true" tabindex="-1"></a>         <span class="co"># This represents the change in hospitalizations over the forecast</span></span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a>         <span class="co"># period.</span></span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rolling average for tested and positive_pcr</span></span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"Positive"</span>, <span class="st">"Tested"</span>),</span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a>            <span class="at">.funs =</span> <span class="cf">function</span>(x) slider<span class="sc">::</span><span class="fu">slide_dbl</span>(<span class="at">.x =</span> x,</span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">.before =</span> <span class="dv">6</span>,</span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">.f =</span> mean))</span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Apply a rolling mean (7-day average) to the 'Positive' and</span></span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Tested' columns.</span></span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The 'slider::slide_dbl' function is used to calculate the mean</span></span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a>            <span class="co"># over a window of 7 days (current day + 6 days before). This</span></span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a>            <span class="co"># smooths out daily fluctuations and provides a better trend</span></span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a>            <span class="co"># indicator.</span></span>
<span id="cb36-247"><a href="#cb36-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-248"><a href="#cb36-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r covidintro, echo = FALSE}</span></span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-covidintro</span></span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Hospitalizations, number of positive RT-PCR and number of RT-PCR of Bordeaux University Hospital."</span></span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a figure with hospitalizations, positive and tested RT-PCR from covid data</span></span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a><span class="in">dfOutcome %&gt;%</span></span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a><span class="in">  tidyr::pivot_longer(cols = c("hosp", "Positive", "Tested")) %&gt;%</span></span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot2::ggplot(mapping = aes(x = date, y = value)) +</span></span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line() +</span></span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(name ~ ., scales = "free_y") +</span></span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(color = "") +</span></span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom")</span></span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a><span class="fu">### First reservoir</span></span>
<span id="cb36-265"><a href="#cb36-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-266"><a href="#cb36-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r schemaregression, echo=FALSE}</span></span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-schemaregression</span></span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Regression use case: Forecasting the number of hospitalized patients 14 days ahead."</span></span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: "75%"</span></span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("images/regression_usecase.PNG")</span></span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a>The objective of this task is to train a RC model using the input features to forecast the number of hospitalized patients 14 days ahead, as illustrated in Figure @fig-schemaregression.</span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a>Setting a reservoir is done with the <span class="in">`createNode()`</span> function. The important hyperparameters are the following :</span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Number of nodes (<span class="in">`units`</span>) : it corresponds to the number of nodes inside the reservoir. Usually, the more the better, but more nodes increases the computation time.</span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Leaking rate (<span class="in">`lr`</span>) : the leaking rate corresponds to the balance between the new inputs and the previous state. A leaking rate of 1 only consider information from new inputs.</span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spectral radius (<span class="in">`sr`</span>): the spectral radius is the largest eigenvalue in modulus of the reservoir connectivity matrix. A small spectral radius induces stable dynamics inside the reservoir, a high spectral radius induces a chaotic regime inside the reservoir.</span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Input scaling (<span class="in">`input_scaling`</span>): the input scaling is a gain applied to the input features of the reservoir.</span>
<span id="cb36-281"><a href="#cb36-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Warmup (<span class="in">`warmup`</span>) : it corresponds to the number of time step during which the data are propagating into the reservoir but not used to fit the output layer. This hyperparameter is set in the <span class="in">`reservoirR_fit()`</span> function.</span>
<span id="cb36-282"><a href="#cb36-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a>In addition, we can set the seed (<span class="in">`seed`</span>). Because the reservoir connections are set at random, setting the seed is a good approach to ensure reproducibility.</span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a>For this part of the tutorial, we will set the hyperparameter at a given value. Hyperparameter optimization will be detailed at @sec-studycase.</span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reservoir computing node using the 'createNode' function from the</span></span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a><span class="co"># - nodeType = "Reservoir": Specify the type of node to be a reservoir.</span></span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a><span class="co"># - seed = 1: Set the seed for reproducibility, ensuring consistent results</span></span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a><span class="co">#             when the model is run multiple times.</span></span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a><span class="co"># - units = 500: Set the number of reservoir units (neurons) to 500.</span></span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a><span class="co"># - lr = 0.7: Set the leakage rate (lr) of the reservoir, which controls how</span></span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a><span class="co">#             quickly the reservoir state decays over time.</span></span>
<span id="cb36-299"><a href="#cb36-299" aria-hidden="true" tabindex="-1"></a><span class="co"># - sr = 1: Set the spectral radius (sr) of the reservoir, which influences the</span></span>
<span id="cb36-300"><a href="#cb36-300" aria-hidden="true" tabindex="-1"></a><span class="co">#           stability and memory capacity of the reservoir.</span></span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a><span class="co"># - input_scaling = 1: Set the input scaling factor, which scales the input</span></span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a><span class="co">#                       signal before it is fed into the reservoir.</span></span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="at">nodeType =</span> <span class="st">"Reservoir"</span>,</span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">units =</span> <span class="dv">500</span>,</span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">lr =</span> <span class="fl">0.7</span>,</span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">sr =</span> <span class="dv">1</span>,</span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">input_scaling =</span> <span class="dv">1</span>)</span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a>Then we can feed the data to the reservoir and see the activation state of the reservoir $x(t)$. To do so, we first prepare the data and transform it to a matrix.</span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a><span class="do">## select explanatory features of the train set and transform it to an array</span></span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb36-319"><a href="#cb36-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outcomeDate <span class="sc">&lt;</span> traintest_date) <span class="sc">%&gt;%</span></span>
<span id="cb36-320"><a href="#cb36-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hosp, Positive, Tested) <span class="sc">%&gt;%</span></span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>Then we run the <span class="in">`predict_seq()`</span> function. It takes as input a node (i.e a reservoir or a reservoir associated with an output layer) and the feature matrix.</span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the state of the reservoir using the 'predict_seq' function from the</span></span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a><span class="co"># - node = reservoir: The reservoir computing node created earlier.</span></span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a><span class="co"># - X = X: The input data matrix containing the features 'hosp', 'Positive',</span></span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a><span class="co">#           and 'Tested'.</span></span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a><span class="co"># The function computes the state of the reservoir for each time step in the</span></span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a><span class="co"># input sequence, effectively transforming the input data into the reservoir's</span></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a><span class="co"># high-dimensional state space.</span></span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a>reservoir_state <span class="ot">&lt;-</span> <span class="fu">predict_seq</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X)</span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-341"><a href="#cb36-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-342"><a href="#cb36-342" aria-hidden="true" tabindex="-1"></a>Now we can visualize node activation using the <span class="in">`plot()`</span> function presented at @fig-nodeactivationbad .</span>
<span id="cb36-343"><a href="#cb36-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-344"><a href="#cb36-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nodeactivationbad}</span></span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-nodeactivationbad</span></span>
<span id="cb36-346"><a href="#cb36-346" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "20 random nodes activation over time."</span></span>
<span id="cb36-347"><a href="#cb36-347" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the reservoir state activation over time</span></span>
<span id="cb36-348"><a href="#cb36-348" aria-hidden="true" tabindex="-1"></a><span class="in">plot(reservoir_state)</span></span>
<span id="cb36-349"><a href="#cb36-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-350"><a href="#cb36-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a>Numerous nodes within the system exhibit a consistent equilibrium state. The challenge arises when the output layer attempts to extract knowledge from these nodes, as they do not convey meaningful information. This issue can be attributed to the disparate scales of the features. To address this concern, a practical approach involves normalizing the features by dividing each of them by their respective maximum values, thereby scaling them within the range of $-1$ to $1$ by dividing by the maximum of the absolute value. Of note, here the features will be scaled between $0$ and $1$ because all features are positive.</span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardise features by dividing by the maximum value can improve performance</span></span>
<span id="cb36-357"><a href="#cb36-357" aria-hidden="true" tabindex="-1"></a><span class="co"># After standardisation, all features are on a similar scale which helps RC</span></span>
<span id="cb36-358"><a href="#cb36-358" aria-hidden="true" tabindex="-1"></a>stand_max <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">return</span>(x<span class="sc">/</span><span class="fu">max</span>(<span class="fu">abs</span>(x)))</span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a><span class="co"># scaled features</span></span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a>Xstand <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> traintest_date) <span class="sc">%&gt;%</span></span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hosp, Positive, Tested) <span class="sc">%&gt;%</span></span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="at">.funs =</span> stand_max) <span class="sc">%&gt;%</span></span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.array</span>()</span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-368"><a href="#cb36-368" aria-hidden="true" tabindex="-1"></a>We then feed them to the reservoir and plot the node activation again. Compared to @fig-nodeactivationbad, the obtained node activation at @fig-nodeactivationgood shows interesting trend outputs as no node seems saturated.</span>
<span id="cb36-369"><a href="#cb36-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nodeactivationgood}</span></span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-nodeactivationgood</span></span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "20 random node activation over time. Scaled features."</span></span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a><span class="in"># feed the scaled features to the reservoir</span></span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a><span class="in">reservoir_state_stand &lt;- predict_seq(node = reservoir,</span></span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a><span class="in">                                     X = Xstand,</span></span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a><span class="in">                                     reset = TRUE)</span></span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a><span class="in"># plot the output</span></span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a><span class="in">plot(reservoir_state_stand)</span></span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-380"><a href="#cb36-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-381"><a href="#cb36-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecast</span></span>
<span id="cb36-382"><a href="#cb36-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-383"><a href="#cb36-383" aria-hidden="true" tabindex="-1"></a>In order to train the reservoir, we should train the last layer which</span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a>linearly combines the neuron's output.</span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Set the ESN</span></span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a>Initially, we establish the output layer with the <span class="in">`createNode()`</span> function, incorporating a ridge penalty set at <span class="in">`1e3`</span>. It's important to note that this hyperparameter can be subject to optimization, a topic that will be explored in @sec-studycase. This parameter plays a pivotal role in fine-tuning the model's conformity to the data. When set excessively high, the risk of underfitting arises, whereas setting it too low can lead to overfitting. We connect the output layer to the reservoir, with the <span class="in">`%&gt;&gt;%`</span> operator, making the model ready to be trained.</span>
<span id="cb36-389"><a href="#cb36-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-392"><a href="#cb36-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-393"><a href="#cb36-393" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="at">nodeType =</span> <span class="st">"Ridge"</span>,</span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ridge =</span> <span class="fl">1e3</span>)</span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a readout node using ridge regression with the 'createNode' function</span></span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoirnet package.</span></span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a><span class="co"># - nodeType = "Ridge": Specify the type of node to be a ridge regression</span></span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a><span class="co">#                       readout.</span></span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a><span class="co"># - ridge = 1e3: Set the regularization parameter (ridge) for the ridge</span></span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a><span class="co">#                 regression to 1000.</span></span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression is used to prevent overfitting by adding a penalty on the</span></span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a><span class="co"># size of the coefficients.</span></span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> reservoir <span class="sc">%&gt;&gt;%</span> readout</span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Link the reservoir and readout nodes to form a complete reservoir computing</span></span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a><span class="co"># model. The '%&gt;&gt;%' operator connects the high-dimensional state generated by</span></span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a><span class="co"># the reservoir to the readout layer, allowing the model to learn the mapping</span></span>
<span id="cb36-409"><a href="#cb36-409" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoir states to the target outputs.</span></span>
<span id="cb36-410"><a href="#cb36-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-412"><a href="#cb36-412" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Set the data</span></span>
<span id="cb36-413"><a href="#cb36-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a>First we separate the train set on which we will learn the ridge coefficients and the test set on which we will make the forecast. We define the train set to be all the data before 2022-01-01 and the test data to be all the data to have forecast both on train and test sets.</span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-418"><a href="#cb36-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-419"><a href="#cb36-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform some data management to isolate train and test sets</span></span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a><span class="co"># train set</span></span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a>dftrain <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span> <span class="fu">filter</span>(outcomeDate <span class="sc">&lt;=</span> traintest_date)</span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a>yTrain <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(outcome)</span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a>yTrain_variation <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(outcome_deriv)</span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a>xTrain <span class="ot">&lt;-</span> dftrain <span class="sc">%&gt;%</span> <span class="fu">select</span>(hosp, Positive, Tested)</span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a><span class="co"># test set</span></span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a>xTest <span class="ot">&lt;-</span> dfOutcome <span class="sc">%&gt;%</span> <span class="fu">select</span>(hosp, Positive, Tested)</span>
<span id="cb36-427"><a href="#cb36-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-428"><a href="#cb36-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a>We standardize with the same formula as seen before. We learn the standardization on the training set and apply it on the test set. Then we convert the dataframe to matrix.</span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results=FALSE}</span></span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a><span class="in"># copy train and test sets</span></span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a><span class="in">xTrainstand &lt;- xTrain</span></span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a><span class="in">xTeststand &lt;- xTest</span></span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a><span class="in"># standardise based on training set values</span></span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a><span class="in">ls_fct_stand &lt;- apply(xTrain,</span></span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a><span class="in">                      MARGIN = 2,</span></span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a><span class="in">                      FUN = function(x) function(feature) feature/(max(x)))</span></span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a><span class="in">lapply(X = names(ls_fct_stand),</span></span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a><span class="in">       FUN = function(x){</span></span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a><span class="in">         xTrainstand[,x] &lt;&lt;- ls_fct_stand[[x]](feature = xTrain[,x])</span></span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a><span class="in">         xTeststand[,x] &lt;&lt;- ls_fct_stand[[x]](feature = xTest[,x])</span></span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a><span class="in">         return()</span></span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a><span class="in">       })</span></span>
<span id="cb36-445"><a href="#cb36-445" aria-hidden="true" tabindex="-1"></a><span class="in"># convert to array</span></span>
<span id="cb36-446"><a href="#cb36-446" aria-hidden="true" tabindex="-1"></a><span class="in">lsdf &lt;- lapply(list(yTrain = yTrain,</span></span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a><span class="in">                    yTrain_variation = yTrain_variation,</span></span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a><span class="in">                    xTrain = xTrainstand,</span></span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a><span class="in">                    xTest = xTeststand),</span></span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a><span class="in">               function(x) as.matrix(x))</span></span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Train the model and predict</span></span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a>We then feed the reservoir with the train set using the <span class="in">`reservoirR_fit()`</span> function. To do so, we set a <span class="in">`warmup`</span> of <span class="in">`30`</span> days during which the data are propagating into the reservoir but not used to fit the output layer.</span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results='hide'}</span></span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a><span class="in">### train the reservoir ridge output</span></span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a><span class="in">fit &lt;- reservoirnet::reservoirR_fit(node = model,</span></span>
<span id="cb36-460"><a href="#cb36-460" aria-hidden="true" tabindex="-1"></a><span class="in">                                    X = lsdf$xTrain,</span></span>
<span id="cb36-461"><a href="#cb36-461" aria-hidden="true" tabindex="-1"></a><span class="in">                                    Y = lsdf$yTrain,</span></span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a><span class="in">                                    warmup = 30,</span></span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a><span class="in">                                    reset = TRUE)</span></span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a>Now that the ridge layer is trained, we can forecast using the <span class="in">`predict_seq()`</span> function. We set the parameter <span class="in">`reset`</span> to <span class="in">`TRUE`</span> in order to clean the reservoir from the data used by the training set.</span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast with the trained reservoir on the test data</span></span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a>vec_pred <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> fit<span class="sc">$</span>fit,</span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">X =</span> lsdf<span class="sc">$</span>xTest,</span>
<span id="cb36-474"><a href="#cb36-474" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">reset =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-475"><a href="#cb36-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-forecast</span></span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Forecast"</span></span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Make figure to represent forecast on the train and test sets.</span></span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a>dfOutcome <span class="sc">%&gt;%</span></span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> vec_pred) <span class="sc">%&gt;%</span></span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> outcomeDate)) <span class="sc">+</span></span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> outcome,</span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"observed"</span>)) <span class="sc">+</span></span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> pred,</span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a>                          <span class="at">color =</span> <span class="st">"forecast"</span>)) <span class="sc">+</span></span>
<span id="cb36-492"><a href="#cb36-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>,</span>
<span id="cb36-493"><a href="#cb36-493" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> traintest_date,</span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcomeDate, <span class="at">na.rm =</span> T),</span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="dv">0</span>,</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymax =</span> <span class="fu">max</span>(dfOutcome<span class="sc">$</span>outcome, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="fl">1.1</span>, </span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Test set"</span>,</span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-08-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Train set"</span>,</span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-03-01"</span>), <span class="at">y =</span> <span class="dv">2200</span>, <span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#3772ff"</span>, <span class="st">"#080708"</span>)) <span class="sc">+</span></span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">""</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Hospitalizations"</span>)</span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a>We observe that the model forecast at @fig-forecast is not fully accurate, both on the test set and the train set. In that case, one option could be to reduce ridge penalization to fit more closely the data, the optimization of ridge hyperparameter will be discussed at  @sec-studycase. Another possibility is to ease the learning of the algorithm by forecasting the variation of the hospitalization instead of the number of hospitalized patients. For that step, we will learn on the <span class="in">`outcome_deriv`</span> contained in <span class="in">`yTrain_variation`</span> data which is defined outcome as <span class="in">`outcome_deriv = outcome - hosp`</span>. As depicted at @fig-figForecastDerivvsRaw, this strategy improved the model forecast.</span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results="hide"}</span></span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a><span class="in">## Fit reservoir on outcome variation instead of raw outcome</span></span>
<span id="cb36-511"><a href="#cb36-511" aria-hidden="true" tabindex="-1"></a><span class="in">fit2 &lt;- reservoirnet::reservoirR_fit(node = model,</span></span>
<span id="cb36-512"><a href="#cb36-512" aria-hidden="true" tabindex="-1"></a><span class="in">                                     X = lsdf$xTrain,</span></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a><span class="in">                                     Y = lsdf$yTrain_variation,</span></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a><span class="in">                                     warmup = 30,</span></span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a><span class="in">                                     reset = TRUE)</span></span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a><span class="in">## Get the forecast on the test set</span></span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a><span class="in">vec_pred2_variation &lt;- reservoirnet::predict_seq(node = fit2$fit,</span></span>
<span id="cb36-518"><a href="#cb36-518" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 X = lsdf$xTest,</span></span>
<span id="cb36-519"><a href="#cb36-519" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 reset = TRUE)</span></span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a><span class="in">## Transform the outcome variation forecast into hospitalization forecast</span></span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a><span class="in">vec_pred2 &lt;- vec_pred2_variation + xTest$hosp</span></span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-525"><a href="#cb36-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r figForecastDerivvsRaw}</span></span>
<span id="cb36-526"><a href="#cb36-526" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-figForecastDerivvsRaw</span></span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Covid-19 hospitalizations forecast. The model is either trained to forecast the number of hospitalizations (denoted Raw) or the variation of the hospitalizations compared to current level of hospitalisation (denoted Variation)"</span></span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a><span class="in">## Plot the results</span></span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a><span class="in">dfOutcome %&gt;%</span></span>
<span id="cb36-530"><a href="#cb36-530" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Raw = vec_pred,</span></span>
<span id="cb36-531"><a href="#cb36-531" aria-hidden="true" tabindex="-1"></a><span class="in">         Variation = vec_pred2) %&gt;%</span></span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a><span class="in">  tidyr::pivot_longer(cols = c(Raw, Variation),</span></span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a><span class="in">                      names_to = "Outcome_type",</span></span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a><span class="in">                      values_to = "Forecast") %&gt;%</span></span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a><span class="in">  na.omit() %&gt;%</span></span>
<span id="cb36-536"><a href="#cb36-536" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(mapping = aes(x = outcomeDate)) +</span></span>
<span id="cb36-537"><a href="#cb36-537" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(mapping = aes(y = outcome,</span></span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a><span class="in">                          color = "observed")) +</span></span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(mapping = aes(y = Forecast,</span></span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a><span class="in">                          color = "Forecast")) +</span></span>
<span id="cb36-541"><a href="#cb36-541" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb36-542"><a href="#cb36-542" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = traintest_date,</span></span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = max(dfOutcome$outcomeDate, na.rm = T),</span></span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = 0,</span></span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = max(dfOutcome$outcome, na.rm = T)*1.1, </span></span>
<span id="cb36-546"><a href="#cb36-546" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .2) +</span></span>
<span id="cb36-547"><a href="#cb36-547" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", label = "Test set",</span></span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a><span class="in">           x = as.Date("2022-08-01"), y = 2200, size = 5) +</span></span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", label = "Train set",</span></span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a><span class="in">           x = as.Date("2021-03-01"), y = 2200, size = 5) +</span></span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(Outcome_type ~ .,</span></span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = label_bquote(cols = "Outcome" : .(Outcome_type))) +</span></span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("#3772ff", "#080708")) +</span></span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom") +</span></span>
<span id="cb36-556"><a href="#cb36-556" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(color = "", x = "Date", y = "Hospitalizations")</span></span>
<span id="cb36-557"><a href="#cb36-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification</span></span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Japanese vowel dataset</span></span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a>This example is largely inspired from the <span class="co">[</span><span class="ot">classification tutorial of reservoirpy</span><span class="co">](https://github.com/reservoirpy/reservoirpy/blob/master/tutorials/5-Classification-with-RC.ipynb)</span>. To illustrate the classification task, we will use the Japanese vowel dataset (@kudo_multidimensional_1999). The data can be loaded from <span class="in">`reservoirnet`</span> as follow :</span>
<span id="cb36-564"><a href="#cb36-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the Japanese vowels dataset using the 'generate_data' function from the</span></span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a><span class="co"># reservoirnet package.</span></span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset contains preprocessed features and labels for classification.</span></span>
<span id="cb36-571"><a href="#cb36-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we isolate train and test sets</span></span>
<span id="cb36-572"><a href="#cb36-572" aria-hidden="true" tabindex="-1"></a>japanese_vowels <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">generate_data</span>(<span class="at">dataset =</span> <span class="st">"japanese_vowels"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_train</span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_train</span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_test</span>
<span id="cb36-576"><a href="#cb36-576" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_test</span>
<span id="cb36-577"><a href="#cb36-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a>The dataset comprises 640 vocalizations of the Japanese vowel \ae, contributed by nine distinct speakers. Each vocalization represents a time series spanning between 7 and 29 time steps, encoded as a 12-dimensional vector denoting the Linear Prediction Coefficients (LPC). A visual representation of six distinct utterances from the test set, originating from three different speakers, is depicted in @fig-vowelpresentation.</span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r vowelpresentation, echo = FALSE}</span></span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-vowelpresentation</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Vowel dataset, sample with 3 speakers and 2 utterance each."</span></span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a figure of the Vowel dataset of selected participants.</span></span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a><span class="in">vec_sample &lt;- c(1, 2, 41, 42, 71, 72)</span></span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a><span class="in">dfplot_vowel &lt;- lapply(vec_sample,</span></span>
<span id="cb36-587"><a href="#cb36-587" aria-hidden="true" tabindex="-1"></a><span class="in">                 FUN = function(i){</span></span>
<span id="cb36-588"><a href="#cb36-588" aria-hidden="true" tabindex="-1"></a><span class="in">                   speaker &lt;- which(Y_test[[i]] == 1)</span></span>
<span id="cb36-589"><a href="#cb36-589" aria-hidden="true" tabindex="-1"></a><span class="in">                   X_test[[i]] %&gt;%</span></span>
<span id="cb36-590"><a href="#cb36-590" aria-hidden="true" tabindex="-1"></a><span class="in">                     as.data.frame() %&gt;%</span></span>
<span id="cb36-591"><a href="#cb36-591" aria-hidden="true" tabindex="-1"></a><span class="in">                     tibble::rowid_to_column(var = "Time") %&gt;%</span></span>
<span id="cb36-592"><a href="#cb36-592" aria-hidden="true" tabindex="-1"></a><span class="in">                     tidyr::pivot_longer(cols = -Time,</span></span>
<span id="cb36-593"><a href="#cb36-593" aria-hidden="true" tabindex="-1"></a><span class="in">                                         names_to = "component",</span></span>
<span id="cb36-594"><a href="#cb36-594" aria-hidden="true" tabindex="-1"></a><span class="in">                                         values_to = "LPC") %&gt;%</span></span>
<span id="cb36-595"><a href="#cb36-595" aria-hidden="true" tabindex="-1"></a><span class="in">                     mutate(speaker = speaker, .before = 1,</span></span>
<span id="cb36-596"><a href="#cb36-596" aria-hidden="true" tabindex="-1"></a><span class="in">                            uterrance = i) %&gt;%</span></span>
<span id="cb36-597"><a href="#cb36-597" aria-hidden="true" tabindex="-1"></a><span class="in">                     return()</span></span>
<span id="cb36-598"><a href="#cb36-598" aria-hidden="true" tabindex="-1"></a><span class="in">                 }) %&gt;%</span></span>
<span id="cb36-599"><a href="#cb36-599" aria-hidden="true" tabindex="-1"></a><span class="in">  bind_rows()</span></span>
<span id="cb36-600"><a href="#cb36-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-601"><a href="#cb36-601" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dfplot_vowel, mapping = aes(x = Time, y = LPC, color = component)) +</span></span>
<span id="cb36-602"><a href="#cb36-602" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line() +</span></span>
<span id="cb36-603"><a href="#cb36-603" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(uterrance ~ speaker,</span></span>
<span id="cb36-604"><a href="#cb36-604" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = label_bquote(cols = "speaker" : .(speaker)),</span></span>
<span id="cb36-605"><a href="#cb36-605" aria-hidden="true" tabindex="-1"></a><span class="in">             ncol = 2) +</span></span>
<span id="cb36-606"><a href="#cb36-606" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb36-607"><a href="#cb36-607" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb36-608"><a href="#cb36-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-609"><a href="#cb36-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-610"><a href="#cb36-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-611"><a href="#cb36-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r schemaclassif, echo=FALSE}</span></span>
<span id="cb36-612"><a href="#cb36-612" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-schemaclassif</span></span>
<span id="cb36-613"><a href="#cb36-613" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Classification use-case, identifying the speaker from an utterance."</span></span>
<span id="cb36-614"><a href="#cb36-614" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: "75%"</span></span>
<span id="cb36-615"><a href="#cb36-615" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("images/classif_usecase.PNG")</span></span>
<span id="cb36-616"><a href="#cb36-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-617"><a href="#cb36-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-618"><a href="#cb36-618" aria-hidden="true" tabindex="-1"></a>The primary objective involves the attribution of each utterance to its respective speaker, this is denoted as classification or sequence-to-vector encoding. The secondary objective involves the attribution of each time step of each utterance to its speaker, this is denoted as transduction or sequence-to-sequence encoding. While this second approach may seem somewhat superfluous in this context, it could be useful, for example, in cases where multiple speakers take turns speaking, allowing us to identify which sequence belongs to each individual speaker. Figure @fig-schemaregression illustrates this task.</span>
<span id="cb36-619"><a href="#cb36-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-620"><a href="#cb36-620" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classification (sequence-to-vector model)</span></span>
<span id="cb36-621"><a href="#cb36-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-622"><a href="#cb36-622" aria-hidden="true" tabindex="-1"></a>The first approach is the sequence-to-vector encoding. For this task we aim to predict the speaker of the whole utterance (i.e the label is assigned to the whole sequence). We first start by creating the reservoir and the output layer using <span class="in">`createNode()`</span> function.</span>
<span id="cb36-623"><a href="#cb36-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-626"><a href="#cb36-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-627"><a href="#cb36-627" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="st">"Reservoir"</span>, <span class="at">units =</span> <span class="dv">500</span>,</span>
<span id="cb36-628"><a href="#cb36-628" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">lr=</span><span class="fl">0.1</span>, <span class="at">sr=</span><span class="fl">0.9</span>,</span>
<span id="cb36-629"><a href="#cb36-629" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb36-630"><a href="#cb36-630" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reservoir computing node with 500 units using the 'createNode'</span></span>
<span id="cb36-631"><a href="#cb36-631" aria-hidden="true" tabindex="-1"></a><span class="co"># function from the reservoirnet package.</span></span>
<span id="cb36-632"><a href="#cb36-632" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb36-633"><a href="#cb36-633" aria-hidden="true" tabindex="-1"></a><span class="co"># - units = 500: Set the number of reservoir units (neurons) to 500.</span></span>
<span id="cb36-634"><a href="#cb36-634" aria-hidden="true" tabindex="-1"></a><span class="co"># - lr = 0.1: Set the leakage rate (lr) of the reservoir to 0.1, controlling</span></span>
<span id="cb36-635"><a href="#cb36-635" aria-hidden="true" tabindex="-1"></a><span class="co">#             how quickly the reservoir state decays over time.</span></span>
<span id="cb36-636"><a href="#cb36-636" aria-hidden="true" tabindex="-1"></a><span class="co"># - sr = 0.9: Set the spectral radius (sr) of the reservoir to 0.9, influencing</span></span>
<span id="cb36-637"><a href="#cb36-637" aria-hidden="true" tabindex="-1"></a><span class="co">#             the stability and memory capacity of the reservoir.</span></span>
<span id="cb36-638"><a href="#cb36-638" aria-hidden="true" tabindex="-1"></a><span class="co"># - seed = 1: Set the seed for reproducibility, ensuring consistent results</span></span>
<span id="cb36-639"><a href="#cb36-639" aria-hidden="true" tabindex="-1"></a><span class="co">#             when the model is run multiple times.</span></span>
<span id="cb36-640"><a href="#cb36-640" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">createNode</span>(<span class="st">"Ridge"</span>,<span class="at">ridge=</span><span class="fl">1e-6</span>)</span>
<span id="cb36-641"><a href="#cb36-641" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a readout node using ridge regression with the 'createNode' function</span></span>
<span id="cb36-642"><a href="#cb36-642" aria-hidden="true" tabindex="-1"></a><span class="co"># from the reservoirnet package.</span></span>
<span id="cb36-643"><a href="#cb36-643" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb36-644"><a href="#cb36-644" aria-hidden="true" tabindex="-1"></a><span class="co"># - ridge = 1e-6: Set the regularization parameter (ridge) for the ridge</span></span>
<span id="cb36-645"><a href="#cb36-645" aria-hidden="true" tabindex="-1"></a><span class="co">#                 regression to 1e-6.</span></span>
<span id="cb36-646"><a href="#cb36-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression is used to prevent overfitting by adding a penalty on the</span></span>
<span id="cb36-647"><a href="#cb36-647" aria-hidden="true" tabindex="-1"></a><span class="co"># size of the coefficients.</span></span>
<span id="cb36-648"><a href="#cb36-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-649"><a href="#cb36-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-650"><a href="#cb36-650" aria-hidden="true" tabindex="-1"></a>To perform this task, we need to modify the training and testing processes. Leveraging the inherent inertia of the reservoir, information from preceding time steps is preserved, effectively endowing the RC with a form of memory. Consequently, the final state vector encapsulates insights gathered from all antecedent states. In the context of the sequence-to-vector encoding task, only the final state is used. To simplify this process, we introduce the <span class="in">`last_reservoir_state()`</span> function, which extracts the final reservoir state. This process is executed as follows:</span>
<span id="cb36-651"><a href="#cb36-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-654"><a href="#cb36-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-655"><a href="#cb36-655" aria-hidden="true" tabindex="-1"></a>states_train <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">last_reservoir_state</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X_train)</span>
<span id="cb36-656"><a href="#cb36-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-657"><a href="#cb36-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-658"><a href="#cb36-658" aria-hidden="true" tabindex="-1"></a>Then, we use only the final state for prediction. We first extract the final state using the <span class="in">`last_reservoir_state()`</span> function and then use the trained readout to predict the vowel using the <span class="in">`predict_seq()`</span> function with the <span class="in">`seq_to_vec`</span> parameter set to <span class="in">`TRUE`</span>:</span>
<span id="cb36-659"><a href="#cb36-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-660"><a href="#cb36-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results='hide'}</span></span>
<span id="cb36-661"><a href="#cb36-661" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the reservoir using the last state vector (each observation is the whole</span></span>
<span id="cb36-662"><a href="#cb36-662" aria-hidden="true" tabindex="-1"></a><span class="in"># vowel sequence)</span></span>
<span id="cb36-663"><a href="#cb36-663" aria-hidden="true" tabindex="-1"></a><span class="in">res &lt;- reservoirnet::reservoirR_fit(node = readout, X = states_train, Y = Y_train)</span></span>
<span id="cb36-664"><a href="#cb36-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-665"><a href="#cb36-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-666"><a href="#cb36-666" aria-hidden="true" tabindex="-1"></a>Then we can perform the prediction using only the final state. We first get the final state using the <span class="in">`last_reservoir_state()`</span> function and use the trained readout to predict the vowel using the <span class="in">`predict_seq()`</span> function with the <span class="in">`seq_to_vec`</span> parameter set to <span class="in">`TRUE`</span>.</span>
<span id="cb36-667"><a href="#cb36-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-670"><a href="#cb36-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-671"><a href="#cb36-671" aria-hidden="true" tabindex="-1"></a><span class="co"># The operation is repeated for the test set :</span></span>
<span id="cb36-672"><a href="#cb36-672" aria-hidden="true" tabindex="-1"></a>states_test <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">last_reservoir_state</span>(<span class="at">node =</span> reservoir, <span class="at">X =</span> X_test)</span>
<span id="cb36-673"><a href="#cb36-673" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">predict_seq</span>(<span class="at">node =</span> readout, <span class="at">X =</span> states_test, <span class="at">seq_to_vec =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-674"><a href="#cb36-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-675"><a href="#cb36-675" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-676"><a href="#cb36-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-677"><a href="#cb36-677" aria-hidden="true" tabindex="-1"></a>@fig-seqtovec shows the prediction for the 6 utterances depicted at @fig-vowelpresentation where the model correctly identifies the speaker.</span>
<span id="cb36-678"><a href="#cb36-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-679"><a href="#cb36-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r seqtovec}</span></span>
<span id="cb36-680"><a href="#cb36-680" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-seqtovec</span></span>
<span id="cb36-681"><a href="#cb36-681" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Prediction in a sequence-to-sequence approach 6 samples with 3 speakers and 2 utterance each. The speaker to predict is depicted in blue. For each of the 6 utterance, the model correctly identifies the speaker."</span></span>
<span id="cb36-682"><a href="#cb36-682" aria-hidden="true" tabindex="-1"></a><span class="in"># A figure represents the performance on the test set</span></span>
<span id="cb36-683"><a href="#cb36-683" aria-hidden="true" tabindex="-1"></a><span class="in">dfplotseqtovec &lt;- lapply(vec_sample,</span></span>
<span id="cb36-684"><a href="#cb36-684" aria-hidden="true" tabindex="-1"></a><span class="in">                 FUN = function(i){</span></span>
<span id="cb36-685"><a href="#cb36-685" aria-hidden="true" tabindex="-1"></a><span class="in">                   speaker &lt;- which(Y_test[[i]][1,] == 1)</span></span>
<span id="cb36-686"><a href="#cb36-686" aria-hidden="true" tabindex="-1"></a><span class="in">                   Y_pred[[i]] %&gt;%</span></span>
<span id="cb36-687"><a href="#cb36-687" aria-hidden="true" tabindex="-1"></a><span class="in">                     as.data.frame() %&gt;%</span></span>
<span id="cb36-688"><a href="#cb36-688" aria-hidden="true" tabindex="-1"></a><span class="in">                     tidyr::pivot_longer(cols = everything(),</span></span>
<span id="cb36-689"><a href="#cb36-689" aria-hidden="true" tabindex="-1"></a><span class="in">                                         names_to = "pred_speaker",</span></span>
<span id="cb36-690"><a href="#cb36-690" aria-hidden="true" tabindex="-1"></a><span class="in">                                         values_to = "prediction") %&gt;%</span></span>
<span id="cb36-691"><a href="#cb36-691" aria-hidden="true" tabindex="-1"></a><span class="in">                     mutate(pred_speaker = gsub(x = pred_speaker,</span></span>
<span id="cb36-692"><a href="#cb36-692" aria-hidden="true" tabindex="-1"></a><span class="in">                                                pattern = "V", "")) %&gt;%</span></span>
<span id="cb36-693"><a href="#cb36-693" aria-hidden="true" tabindex="-1"></a><span class="in">                     mutate(speaker = speaker, .before = 1,</span></span>
<span id="cb36-694"><a href="#cb36-694" aria-hidden="true" tabindex="-1"></a><span class="in">                            uterrance = i,</span></span>
<span id="cb36-695"><a href="#cb36-695" aria-hidden="true" tabindex="-1"></a><span class="in">                            target = speaker == pred_speaker) %&gt;%</span></span>
<span id="cb36-696"><a href="#cb36-696" aria-hidden="true" tabindex="-1"></a><span class="in">                     return()</span></span>
<span id="cb36-697"><a href="#cb36-697" aria-hidden="true" tabindex="-1"></a><span class="in">                 }) %&gt;%</span></span>
<span id="cb36-698"><a href="#cb36-698" aria-hidden="true" tabindex="-1"></a><span class="in">  bind_rows()</span></span>
<span id="cb36-699"><a href="#cb36-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-700"><a href="#cb36-700" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dfplotseqtovec,</span></span>
<span id="cb36-701"><a href="#cb36-701" aria-hidden="true" tabindex="-1"></a><span class="in">       mapping = aes(x = pred_speaker,</span></span>
<span id="cb36-702"><a href="#cb36-702" aria-hidden="true" tabindex="-1"></a><span class="in">                     y = prediction,</span></span>
<span id="cb36-703"><a href="#cb36-703" aria-hidden="true" tabindex="-1"></a><span class="in">                     fill = target)) +</span></span>
<span id="cb36-704"><a href="#cb36-704" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = "identity") +</span></span>
<span id="cb36-705"><a href="#cb36-705" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(uterrance ~ speaker,</span></span>
<span id="cb36-706"><a href="#cb36-706" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = label_bquote(cols = "speaker" : .(speaker)),</span></span>
<span id="cb36-707"><a href="#cb36-707" aria-hidden="true" tabindex="-1"></a><span class="in">             ncol = 2) +</span></span>
<span id="cb36-708"><a href="#cb36-708" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("#BDBDBD", "#A3CEF1")) +</span></span>
<span id="cb36-709"><a href="#cb36-709" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb36-710"><a href="#cb36-710" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb36-711"><a href="#cb36-711" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(y = 'Score',</span></span>
<span id="cb36-712"><a href="#cb36-712" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Speaker")</span></span>
<span id="cb36-713"><a href="#cb36-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-714"><a href="#cb36-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-715"><a href="#cb36-715" aria-hidden="true" tabindex="-1"></a>Then, we can also compute the overall accuracy :</span>
<span id="cb36-716"><a href="#cb36-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-719"><a href="#cb36-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-720"><a href="#cb36-720" aria-hidden="true" tabindex="-1"></a><span class="co"># The overall accuracy is evaluated</span></span>
<span id="cb36-721"><a href="#cb36-721" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(pred, truth) <span class="fu">mean</span>(pred <span class="sc">==</span> truth)</span>
<span id="cb36-722"><a href="#cb36-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-723"><a href="#cb36-723" aria-hidden="true" tabindex="-1"></a>Y_pred_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_pred,</span>
<span id="cb36-724"><a href="#cb36-724" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),<span class="dv">1</span>,which.max))</span>
<span id="cb36-725"><a href="#cb36-725" aria-hidden="true" tabindex="-1"></a>Y_test_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_test,</span>
<span id="cb36-726"><a href="#cb36-726" aria-hidden="true" tabindex="-1"></a>                       <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),<span class="dv">1</span>,which.max))</span>
<span id="cb36-727"><a href="#cb36-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-728"><a href="#cb36-728" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="at">pred =</span> Y_test_class, <span class="at">truth =</span> Y_pred_class)</span>
<span id="cb36-729"><a href="#cb36-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-730"><a href="#cb36-730" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Accuracy: "</span>, <span class="fu">round</span>(score <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">3</span>) ,<span class="st">"%"</span>))</span>
<span id="cb36-731"><a href="#cb36-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-732"><a href="#cb36-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-733"><a href="#cb36-733" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transduction (sequence-to-sequence model)</span></span>
<span id="cb36-734"><a href="#cb36-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-735"><a href="#cb36-735" aria-hidden="true" tabindex="-1"></a>For this task, the goal is to predict the speaker for each time step of each utterance. The first step is to get the data where the label is repeated for each time step. This is easily done with the <span class="in">`repeat_targets`</span> argument as follow :</span>
<span id="cb36-736"><a href="#cb36-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-739"><a href="#cb36-739" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-740"><a href="#cb36-740" aria-hidden="true" tabindex="-1"></a><span class="co"># For this new task where we want to forecast for each time step (instead of each utterance)</span></span>
<span id="cb36-741"><a href="#cb36-741" aria-hidden="true" tabindex="-1"></a><span class="co"># we start by getting the data in the appropriate format</span></span>
<span id="cb36-742"><a href="#cb36-742" aria-hidden="true" tabindex="-1"></a><span class="co"># Then we split the train and test data</span></span>
<span id="cb36-743"><a href="#cb36-743" aria-hidden="true" tabindex="-1"></a>japanese_vowels <span class="ot">&lt;-</span> reservoirnet<span class="sc">::</span><span class="fu">generate_data</span>(</span>
<span id="cb36-744"><a href="#cb36-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset =</span> <span class="st">"japanese_vowels"</span>,</span>
<span id="cb36-745"><a href="#cb36-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">repeat_targets=</span><span class="cn">TRUE</span>)<span class="sc">$</span>japanese_vowels</span>
<span id="cb36-746"><a href="#cb36-746" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_train</span>
<span id="cb36-747"><a href="#cb36-747" aria-hidden="true" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_train</span>
<span id="cb36-748"><a href="#cb36-748" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>X_test</span>
<span id="cb36-749"><a href="#cb36-749" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> japanese_vowels<span class="sc">$</span>Y_test</span>
<span id="cb36-750"><a href="#cb36-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-751"><a href="#cb36-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-752"><a href="#cb36-752" aria-hidden="true" tabindex="-1"></a>Then we can train a simple Echo State Network to solve this task. For this example, we will connect both the input layer and the reservoir layer to the readout layer, which is performed by the <span class="in">`%&gt;&gt;%`</span> operator. This direct connection between the input layer and the output layer can be particularly useful when the relationship between the input sequences and the output is mostly linear, potentially improving performance, especially in tasks where linear dependencies play a significant role. @sec-studycase will explore this aspect in more detail through the SARS-CoV-2 prediction task.</span>
<span id="cb36-753"><a href="#cb36-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-756"><a href="#cb36-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-757"><a href="#cb36-757" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an input, a reservoir and an output layers</span></span>
<span id="cb36-758"><a href="#cb36-758" aria-hidden="true" tabindex="-1"></a>source <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Input"</span>)</span>
<span id="cb36-759"><a href="#cb36-759" aria-hidden="true" tabindex="-1"></a>readout <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Ridge"</span>,<span class="at">ridge=</span><span class="fl">1e-6</span>)</span>
<span id="cb36-760"><a href="#cb36-760" aria-hidden="true" tabindex="-1"></a>reservoir <span class="ot">&lt;-</span> <span class="fu">createNode</span>(<span class="st">"Reservoir"</span>,<span class="at">units =</span> <span class="dv">500</span>,<span class="at">lr=</span><span class="fl">0.1</span>, <span class="at">sr=</span><span class="fl">0.9</span>, <span class="at">seed =</span> <span class="dv">1</span>)</span>
<span id="cb36-761"><a href="#cb36-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect the input layer to the reservoir and connect both the input layer and</span></span>
<span id="cb36-762"><a href="#cb36-762" aria-hidden="true" tabindex="-1"></a><span class="co"># the reservoir to the output layer</span></span>
<span id="cb36-763"><a href="#cb36-763" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">list</span>(source <span class="sc">%&gt;&gt;%</span> reservoir, source) <span class="sc">%&gt;&gt;%</span> readout</span>
<span id="cb36-764"><a href="#cb36-764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-765"><a href="#cb36-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-766"><a href="#cb36-766" aria-hidden="true" tabindex="-1"></a>We can then fit the model and predict the labels for the test data. The <span class="in">`reset`</span> parameter is set to <span class="in">`TRUE`</span> to remove information from the reservoir from the training process.</span>
<span id="cb36-767"><a href="#cb36-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-768"><a href="#cb36-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results='hide'}</span></span>
<span id="cb36-769"><a href="#cb36-769" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit the RC model</span></span>
<span id="cb36-770"><a href="#cb36-770" aria-hidden="true" tabindex="-1"></a><span class="in">model_fit &lt;- reservoirnet::reservoirR_fit(node = model,</span></span>
<span id="cb36-771"><a href="#cb36-771" aria-hidden="true" tabindex="-1"></a><span class="in">                                          X = X_train,</span></span>
<span id="cb36-772"><a href="#cb36-772" aria-hidden="true" tabindex="-1"></a><span class="in">                                          Y = Y_train,</span></span>
<span id="cb36-773"><a href="#cb36-773" aria-hidden="true" tabindex="-1"></a><span class="in">                                          warmup = 2)</span></span>
<span id="cb36-774"><a href="#cb36-774" aria-hidden="true" tabindex="-1"></a><span class="in"># Predict with the fitted model</span></span>
<span id="cb36-775"><a href="#cb36-775" aria-hidden="true" tabindex="-1"></a><span class="in">Y_pred &lt;- reservoirnet::predict_seq(node = model_fit$fit,</span></span>
<span id="cb36-776"><a href="#cb36-776" aria-hidden="true" tabindex="-1"></a><span class="in">                                    X = X_test,</span></span>
<span id="cb36-777"><a href="#cb36-777" aria-hidden="true" tabindex="-1"></a><span class="in">                                    reset = TRUE)</span></span>
<span id="cb36-778"><a href="#cb36-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-779"><a href="#cb36-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-780"><a href="#cb36-780" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`Y_pred`</span> and <span class="in">`Y_test`</span> we represent at @fig-figseqtoseq the predictions for the same patients as in @fig-vowelpresentation.</span>
<span id="cb36-781"><a href="#cb36-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-782"><a href="#cb36-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r figseqtoseq}</span></span>
<span id="cb36-783"><a href="#cb36-783" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-figseqtoseq</span></span>
<span id="cb36-784"><a href="#cb36-784" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Prediction in a sequence-to-sequence approach 6 samples with 3 speakers and 2 utterance each. The higher the score of the speaker, the lighter the color."</span></span>
<span id="cb36-785"><a href="#cb36-785" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 8</span></span>
<span id="cb36-786"><a href="#cb36-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-787"><a href="#cb36-787" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a graph with a label for each time of each utterance</span></span>
<span id="cb36-788"><a href="#cb36-788" aria-hidden="true" tabindex="-1"></a><span class="in">dfplotseqtoseq &lt;- lapply(vec_sample,</span></span>
<span id="cb36-789"><a href="#cb36-789" aria-hidden="true" tabindex="-1"></a><span class="in">                 FUN = function(i){</span></span>
<span id="cb36-790"><a href="#cb36-790" aria-hidden="true" tabindex="-1"></a><span class="in">                   speaker &lt;- which(Y_test[[i]][1,] == 1)</span></span>
<span id="cb36-791"><a href="#cb36-791" aria-hidden="true" tabindex="-1"></a><span class="in">                   Y_pred[[i]] %&gt;%</span></span>
<span id="cb36-792"><a href="#cb36-792" aria-hidden="true" tabindex="-1"></a><span class="in">                     as.data.frame() %&gt;%</span></span>
<span id="cb36-793"><a href="#cb36-793" aria-hidden="true" tabindex="-1"></a><span class="in">                     tibble::rowid_to_column(var = "Time") %&gt;%</span></span>
<span id="cb36-794"><a href="#cb36-794" aria-hidden="true" tabindex="-1"></a><span class="in">                     tidyr::pivot_longer(cols = -Time,</span></span>
<span id="cb36-795"><a href="#cb36-795" aria-hidden="true" tabindex="-1"></a><span class="in">                                         names_to = "pred_speaker",</span></span>
<span id="cb36-796"><a href="#cb36-796" aria-hidden="true" tabindex="-1"></a><span class="in">                                         values_to = "prediction") %&gt;%</span></span>
<span id="cb36-797"><a href="#cb36-797" aria-hidden="true" tabindex="-1"></a><span class="in">                     mutate(pred_speaker = gsub(x = pred_speaker,</span></span>
<span id="cb36-798"><a href="#cb36-798" aria-hidden="true" tabindex="-1"></a><span class="in">                                                pattern = "V", ""),</span></span>
<span id="cb36-799"><a href="#cb36-799" aria-hidden="true" tabindex="-1"></a><span class="in">                            speaker = speaker,</span></span>
<span id="cb36-800"><a href="#cb36-800" aria-hidden="true" tabindex="-1"></a><span class="in">                            uterrance = i,</span></span>
<span id="cb36-801"><a href="#cb36-801" aria-hidden="true" tabindex="-1"></a><span class="in">                            .before = 1) %&gt;%</span></span>
<span id="cb36-802"><a href="#cb36-802" aria-hidden="true" tabindex="-1"></a><span class="in">                     return()</span></span>
<span id="cb36-803"><a href="#cb36-803" aria-hidden="true" tabindex="-1"></a><span class="in">                 }) %&gt;%</span></span>
<span id="cb36-804"><a href="#cb36-804" aria-hidden="true" tabindex="-1"></a><span class="in">  bind_rows()</span></span>
<span id="cb36-805"><a href="#cb36-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-806"><a href="#cb36-806" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dfplotseqtoseq, mapping = aes(x = Time,</span></span>
<span id="cb36-807"><a href="#cb36-807" aria-hidden="true" tabindex="-1"></a><span class="in">                                     y = pred_speaker,</span></span>
<span id="cb36-808"><a href="#cb36-808" aria-hidden="true" tabindex="-1"></a><span class="in">                                     fill = prediction)) +</span></span>
<span id="cb36-809"><a href="#cb36-809" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile() +</span></span>
<span id="cb36-810"><a href="#cb36-810" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(uterrance ~ speaker,</span></span>
<span id="cb36-811"><a href="#cb36-811" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = label_bquote(cols = "speaker" : .(speaker)),</span></span>
<span id="cb36-812"><a href="#cb36-812" aria-hidden="true" tabindex="-1"></a><span class="in">             ncol = 2) +</span></span>
<span id="cb36-813"><a href="#cb36-813" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradient2(low = "#8ECAE6", high = "#FB8500", mid = "#023047",</span></span>
<span id="cb36-814"><a href="#cb36-814" aria-hidden="true" tabindex="-1"></a><span class="in">                       midpoint = 0) +</span></span>
<span id="cb36-815"><a href="#cb36-815" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb36-816"><a href="#cb36-816" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(y = 'Predicted speaker',</span></span>
<span id="cb36-817"><a href="#cb36-817" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Prediction score")</span></span>
<span id="cb36-818"><a href="#cb36-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-819"><a href="#cb36-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-820"><a href="#cb36-820" aria-hidden="true" tabindex="-1"></a>For those 6 utterances, the model correctly identify the speaker for most of the time steps. We can then evaluate the overall accuracy of the model :</span>
<span id="cb36-821"><a href="#cb36-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-824"><a href="#cb36-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-825"><a href="#cb36-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy</span></span>
<span id="cb36-826"><a href="#cb36-826" aria-hidden="true" tabindex="-1"></a>Y_pred_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_pred, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),</span>
<span id="cb36-827"><a href="#cb36-827" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1</span>,</span>
<span id="cb36-828"><a href="#cb36-828" aria-hidden="true" tabindex="-1"></a>                                                       which.max))</span>
<span id="cb36-829"><a href="#cb36-829" aria-hidden="true" tabindex="-1"></a>Y_test_class <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Y_test, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">apply</span>(<span class="fu">as.matrix</span>(x),</span>
<span id="cb36-830"><a href="#cb36-830" aria-hidden="true" tabindex="-1"></a>                                                       <span class="dv">1</span>,</span>
<span id="cb36-831"><a href="#cb36-831" aria-hidden="true" tabindex="-1"></a>                                                       which.max))</span>
<span id="cb36-832"><a href="#cb36-832" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="fu">array</span>(<span class="fu">unlist</span>(Y_pred_class)), <span class="fu">array</span>(<span class="fu">unlist</span>(Y_test_class)))</span>
<span id="cb36-833"><a href="#cb36-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-834"><a href="#cb36-834" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Accuracy: "</span>, <span class="fu">round</span>(score <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">3</span>) ,<span class="st">"%"</span>))</span>
<span id="cb36-835"><a href="#cb36-835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-836"><a href="#cb36-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-837"><a href="#cb36-837" aria-hidden="true" tabindex="-1"></a><span class="fu"># Avanced case-study: Covid-19 hospitalizations forecast {#sec-studycase}</span></span>
<span id="cb36-838"><a href="#cb36-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-839"><a href="#cb36-839" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb36-840"><a href="#cb36-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-841"><a href="#cb36-841" aria-hidden="true" tabindex="-1"></a>Since late 2020, millions of cases of SARS-CoV-2 infection have been documented across the globe <span class="co">[</span><span class="ot">@world_health_organisation_who_2020; @noauthor_estimating_2022; @carrat_evidence_2021</span><span class="co">]</span>. This ongoing pandemic has exerted significant strain on healthcare systems, resulting in a surge in hospitalizations. This surge, in turn, necessitated modifications to the healthcare infrastructure and gave rise to population-wide lockdown measures aimed at preventing the saturation of healthcare facilities <span class="co">[</span><span class="ot">@simoes_organisation_2021; @hubner_surgery_2020; @kim_health_2020</span><span class="co">]</span>. The capacity to predict the trajectory of the epidemic on a regional scale is of paramount importance for effective healthcare system management.</span>
<span id="cb36-842"><a href="#cb36-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-843"><a href="#cb36-843" aria-hidden="true" tabindex="-1"></a>Numerous COVID-19 forecasting algorithms have been proposed using different methods (e.g ensemble, deep learning, mechanistic), yet none has proven entirely satisfactory <span class="co">[</span><span class="ot">@cramer_evaluation_2022-1; @rahimi_review_2021</span><span class="co">]</span>. In France, short-term forecasts with different methods have been evaluated with similar results <span class="co">[</span><span class="ot">@paireau_ensemble_2022; @carvalho_analysis_2021; @mohimont_convolutional_2021; @pottier_forecast_2021</span><span class="co">]</span>. In this context a machine learning algorithm based on linear regression with elastic-net penalization, leveraging both Electronic Health Records (EHRs) and public data, was implemented at Bordeaux University Hospital <span class="co">[</span><span class="ot">@ferte_benefit_2022</span><span class="co">]</span>. This model, which aimed at forecasting the number of hospitalized patients at 14 days, showed good performance but struggled to accurately anticipate dynamic shifts of the epidemic.</span>
<span id="cb36-844"><a href="#cb36-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-845"><a href="#cb36-845" aria-hidden="true" tabindex="-1"></a>RC has been used in the context of covid-19 epidemic forecast <span class="co">[</span><span class="ot">@kmet_bezier_2019; @liu_nanophotonic_2023; @ray_optimized_2021; @zhang_sentiment_2023; @ghosh_reservoir_2021</span><span class="co">]</span>. Among them, @ghosh_reservoir_2021, @liu_nanophotonic_2023 and @ray_optimized_2021 used it to forecast epidemic, @zhang_sentiment_2023 performed sentiment analysis and @kmet_bezier_2019 used it to solve optimal control related to vaccine. The evaluation of RC for epidemic forecast showed promising results in all approaches, being competitive with Long-Short Term Memory (LSTM) and Feed-Forward Neural Network (FFNN) in @ray_optimized_2021. However, the test period was short for @ghosh_reservoir_2021} (21 and 14 days) and @ray_optimized_2021 (86 days) making it difficult to evaluate the behavior of the methods during epidemic dynamic shift. This was not the case for @liu_nanophotonic_2023 (6 months) but they implemented daily ahead forecast which would be difficult to use to manage a hospital. Finally, all three implementations used only one time series as input whereas it has been shown that using different data sources could improve forecast @ferte_benefit_2022. Therefore, it is still difficult to assess the usefulness of RC over a large period and using many time series as inputs.</span>
<span id="cb36-846"><a href="#cb36-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-847"><a href="#cb36-847" aria-hidden="true" tabindex="-1"></a>RC can be viewed as an extension of penalized linear regression, where inputs undergo processing by a reservoir, introducing the capacity for memory and non-linear combinations. Given the effectiveness of penalized linear regression in COVID-19 forecasting, as highlighted in @ferte_benefit_2022, and the promising results exhibited by RC in epidemic forecasting, as demonstrated in studies such as @ghosh_reservoir_2021, @liu_nanophotonic_2023, and @ray_optimized_2021, we have opted to employ RC for the prediction of hospitalizations at 14 days at the University Hospital of Bordeaux.</span>
<span id="cb36-848"><a href="#cb36-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-849"><a href="#cb36-849" aria-hidden="true" tabindex="-1"></a>The aim of this study is to showcase the use of <span class="in">`reservoirnet`</span> for an advanced use case in forecasting the SARS-CoV-2 pandemic in <span class="in">`R`</span>. Several architectural choices will be evaluated, such as the connection between the input layer and the output layer, and the use of either individual input scaling per feature or a common input scaling. The performance of Reservoir Computing (RC) will be compared with elastic-net penalized regression (identified as the optimal model in @ferte_benefit_2022), while a more in-depth comparison of performance against other methods can be found in @ferte_reservoir_2024.</span>
<span id="cb36-850"><a href="#cb36-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-851"><a href="#cb36-851" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methods</span></span>
<span id="cb36-852"><a href="#cb36-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-853"><a href="#cb36-853" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb36-854"><a href="#cb36-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-855"><a href="#cb36-855" aria-hidden="true" tabindex="-1"></a>The study utilized aggregated data spanning from May 16, 2020, to January 17, 2022, regarding the COVID-19 epidemic in France, drawing from various sources to enhance forecasting accuracy. These sources encompassed epidemiological statistics from Santé Publique France, weather data from the National Oceanic and Atmospheric Administration (NOAA), both providing department-level data <span class="co">[</span><span class="ot">@smith_integrated_2011; @etalab_les_2020</span><span class="co">]</span> and Electronic Health Record (EHR) data from the Bordeaux Hospital providing hospital-level data. All data were daily updated. Santé Publique France data included information on hospitalizations, RT-PCR tests, positive RT-PCR results, variant prevalence, and vaccination data, categorized by age groups. NOAA data contributed temperature, wind speed, humidity, and dew point data, allowing for the computation of the COVID-19 Climate Transmissibility Predict Index <span class="co">[</span><span class="ot">@roumagnac_etude_2021</span><span class="co">]</span>. EHRs data included hospitalizations, ICU admissions, ambulance service records, and emergency unit notes, with relevant COVID-19-related concepts extracted from the notes. Data are discussed more in depth in @ferte_benefit_2022.</span>
<span id="cb36-856"><a href="#cb36-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-857"><a href="#cb36-857" aria-hidden="true" tabindex="-1"></a>First derivative over the last $7$ days were computed to enrich model information. To take into account measurement error and daily noise variation, data were smoothed using a local polynomial regression with a span of 21 days. As previously described, input features were scaled between -1 and 1 by dividing the observed value by the maximum of the absolute value of the given input feature.</span>
<span id="cb36-858"><a href="#cb36-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-859"><a href="#cb36-859" aria-hidden="true" tabindex="-1"></a>All data are publicly available. Weather data can be obtained from @smith_integrated_2011 using <span class="in">`R`</span> package <span class="in">`worldmet`</span> <span class="co">[</span><span class="ot">@carslaw_worldmet_2023</span><span class="co">]</span>. <span class="co">[</span><span class="ot">Vaccine data</span><span class="co">](https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-personnes-vaccinees-contre-la-covid-19-1/)</span> can be downloaded from @etalab_les_2020. EHRs data can be downloaded on dryad <span class="co">[</span><span class="ot">@ferte_benefit_2023</span><span class="co">]</span>. For privacy issues, publicly available EHRs data below 10 patients were obfuscated to 0. For convenience, all data were downloaded, merged and provided as replication material.</span>
<span id="cb36-860"><a href="#cb36-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-861"><a href="#cb36-861" aria-hidden="true" tabindex="-1"></a><span class="fu">### Evaluation framework</span></span>
<span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-863"><a href="#cb36-863" aria-hidden="true" tabindex="-1"></a>The task was to forecast 14 days ahead the number of hospitalized patients. As seen at @sec-basicregression, we will train the model to predict the variation of hospitalization, denoted as $hosp$, defined as $outcome_{t+14} = hosp_{t+14} - hosp_{t}$ with $t = 1, ..., T$. Metrics computation and visualizations will be performed on the predicted number of hospitalizations denoted as $\widehat{hosp_{t+14}} = \widehat{outcome_{t+14}} + hosp_{t}$.</span>
<span id="cb36-864"><a href="#cb36-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-865"><a href="#cb36-865" aria-hidden="true" tabindex="-1"></a>The dataset was separated into two periods. First period from May 16, 2020 to March 1, 2021 served to identify relevant hyperparameters. Remaining data was used to evaluate the model performance.</span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a>The performance of the model was evaluated according to several metrics:</span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the mean absolute error : $\text{MAE} = \frac{1}{T} \sum_{t=1}^{T} \left| \hat{hosp}_{t+14} - hosp_{t+14} \right|$.</span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the median relative error : $\text{MRE} = \text{median} \left( \left| \frac{\hat{hosp}_{t+14} - hosp_{t+14}}{hosp_{t+14}} \right| \right)$.</span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the mean absolute error to baseline : $\text{MAEB} = \frac{1}{T} \sum_{t=1}^{T} \left( \left| \hat{hosp}_{t+14} - hosp_{t+14} \right| - \left| hosp_{t} - hosp_{t+14} \right| \right)$.</span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the median relative error to baseline : $\text{MREB} = \text{median} \left( \left| \frac{\hat{hosp}_{t+14} - hosp_{t+14}}{hosp_{t} - hosp_{t+14}} \right| \right)$)</span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a>Median was chosen over mean for $MRE$ and $MREB$ because those metrics tend to have extremely high values when the denominator is close to 0 (i.e when the number of hospitalized patients is close to 0 or the number of patients hospitalized at 14 days is close to the current number of hospitalized patients respectively). $MAEB$ and $MREB$ compare model performance to a baseline model which predicts the current number of hospitalized patients at 14 days. Those metrics help to determine the information added by the model and is a good baseline as covid-19 forecast model do not always outperform this basic forecast (@cramer_evaluation_2022-1).</span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>Because the outcome is obfuscated below 10 hospitalizations for privacy reason, we set both the outcome and the forecast to 10 when the observed value was 0 or the forecasted value was below 10 when evaluating the model performance.</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models</span></span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a>We compared RC to elastic-net penalized regression (denoted as Enet). Furthermore we evaluated RC based on several architectures. First we compared RC with a single input scaling common to all features and a RC with a specific input scaling per feature. Second we compared RC where the input layer is connected to the output layer in addition to the connection between reservoir and output layer. Therefore, five models were evaluated :</span>
<span id="cb36-881"><a href="#cb36-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-882"><a href="#cb36-882" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Elastic-net penalized regression denoted *Enet*</span>
<span id="cb36-883"><a href="#cb36-883" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RC with a single input scaling and no connection between input and ouput layers denoted *Common IS R %&gt;&gt;% O*</span>
<span id="cb36-884"><a href="#cb36-884" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RC with a single input scaling and connection between input and ouput layers denoted *Common IS I+R %&gt;&gt;% O*</span>
<span id="cb36-885"><a href="#cb36-885" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RC with multiple input scaling and no connection between input and ouput layers denoted *Multiple IS R %&gt;&gt;% O*</span>
<span id="cb36-886"><a href="#cb36-886" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RC with multiple input scaling and connection between input and ouput layers denoted *Multiple IS I+R %&gt;&gt;% O*</span>
<span id="cb36-887"><a href="#cb36-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-888"><a href="#cb36-888" aria-hidden="true" tabindex="-1"></a>Because of the randomness of the reservoir, we took the median forecast of 10 reservoir on the train set to evaluate the performance of a given hyperparameter set. On the test set we aggregated the forecast of 40 reservoirs, each of them having one of the 40 best hyperparameter sets found on the train set. In addition, because covid-19 hospitalization is a non-stationary process, models were re-trained everyday using all previous days. To ease computation burden, only one day over two was used to find hyperparameters on the training set.</span>
<span id="cb36-889"><a href="#cb36-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-890"><a href="#cb36-890" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameter optimisation using random search</span></span>
<span id="cb36-891"><a href="#cb36-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-892"><a href="#cb36-892" aria-hidden="true" tabindex="-1"></a>RC relies mainly on 4 hyperparameters including the leaking rate (i.e "memory" parameter), spectral radius (i.e "chaoticity" parameter), input scaling (i.e "feature gain" parameter) and ridge (i.e penalization parameter). Input scaling can be either, common to all features or specific to each feature which increases the number of hyperparameter by the number of features.</span>
<span id="cb36-893"><a href="#cb36-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-894"><a href="#cb36-894" aria-hidden="true" tabindex="-1"></a>Following the notation from <span class="in">`glmnet`</span> package <span class="co">[</span><span class="ot">@friedman_regularization_2010</span><span class="co">]</span>, elastic-net penalized linear regression relies on two hyperparameters, lambda (i.e the penalization parameter) and alpha (i.e the compromise between lasso and ridge penalty)</span>
<span id="cb36-895"><a href="#cb36-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-896"><a href="#cb36-896" aria-hidden="true" tabindex="-1"></a>Hyperparameter were selected in the training set (i.e before March 1, 2021) using a wrapper approach and a random search sampler using 2000 samples for each model. The sampling distribution were defined as follow :</span>
<span id="cb36-897"><a href="#cb36-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-898"><a href="#cb36-898" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>(RC) ridge and (Enet) lambda : log-uniform law defined between 1e-10 and 1e5</span>
<span id="cb36-899"><a href="#cb36-899" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>(RC) input scaling and spectral radius : log-uniform law defined between 1e-5 and 1e5</span>
<span id="cb36-900"><a href="#cb36-900" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>(RC) leaking rate : log-uniform law defined between 1e-3 and 1</span>
<span id="cb36-901"><a href="#cb36-901" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>(Enet) alpha : uniform defined between 0 and 1</span>
<span id="cb36-902"><a href="#cb36-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-903"><a href="#cb36-903" aria-hidden="true" tabindex="-1"></a>We provided large search space for all hyper-parameters. Search space was slightly reduced for leaking rate based on previous results and because a leaking rate of 1e-3 already imply that new inputs make the reservoir change really slowly which is not inline with the dynamic of covid-19 but would be appropriate for an application where the phenomena to forecast has a slow dynamic.</span>
<span id="cb36-904"><a href="#cb36-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-905"><a href="#cb36-905" aria-hidden="true" tabindex="-1"></a>Finally, we provided an additional Enet model similar to the one in @ferte_benefit_2022 where alpha was set to $0.5$ and lambda was re-evaluated everyday in the test set based on previous data using the cross-validation procedure provided by <span class="in">`glmnet`</span>.</span>
<span id="cb36-906"><a href="#cb36-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-907"><a href="#cb36-907" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb36-908"><a href="#cb36-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-909"><a href="#cb36-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb36-910"><a href="#cb36-910" aria-hidden="true" tabindex="-1"></a><span class="in"># because computing time for this section is long, all results were computed</span></span>
<span id="cb36-911"><a href="#cb36-911" aria-hidden="true" tabindex="-1"></a><span class="in"># using a calculation server and stored into a rds file</span></span>
<span id="cb36-912"><a href="#cb36-912" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case &lt;- readRDS(file = here::here("data/precomputed_results.rds"))</span></span>
<span id="cb36-913"><a href="#cb36-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-914"><a href="#cb36-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-915"><a href="#cb36-915" aria-hidden="true" tabindex="-1"></a>The goal of this task is to predict 14 days ahead the hospitalization. @fig-ucPresentData shows both the training set (i.e before 2021-03-01) and the test set where the blue curve correspond to the input features (first derivatives are not shown) and the orange curves correspond to the outcome the model is trained on (i.e the hospitalization variation) and the hospitalizations at 14 days on which the performance metrics are computed. The figures outline that the relation between the input features and the outcome evolve over time and that the time series is not stationary. For instance IPTCC (*Index PREDICT de Transmissivité Climatique de la COVID-19*) seems correlated to the outcome except that it completely miss the summer 2021 increase.</span>
<span id="cb36-916"><a href="#cb36-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-917"><a href="#cb36-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ucPresentData, echo = FALSE}</span></span>
<span id="cb36-918"><a href="#cb36-918" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ucPresentData</span></span>
<span id="cb36-919"><a href="#cb36-919" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Covid-19 epidemic at BUH. Outcome of interest is presented in orange. Model is trained to forecast Outcome curve which corresonds to the difference between Hospitalisatiosn at 14 days and current hospitalisations. Other features are scaled (divide by the maximum of the feature) represented in darkblue."</span></span>
<span id="cb36-920"><a href="#cb36-920" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 8</span></span>
<span id="cb36-921"><a href="#cb36-921" aria-hidden="true" tabindex="-1"></a><span class="in"># descriptive plot of the data</span></span>
<span id="cb36-922"><a href="#cb36-922" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_present_data</span></span>
<span id="cb36-923"><a href="#cb36-923" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-924"><a href="#cb36-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-925"><a href="#cb36-925" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameter selection</span></span>
<span id="cb36-926"><a href="#cb36-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-927"><a href="#cb36-927" aria-hidden="true" tabindex="-1"></a>@fig-ucHyperparam shows the hyperparameter optimisation using random search for the different RC architectures. We observe that model with multiple input scaling achieved better performance on the train set compared to model with single input scaling which is expected as they can adapt more closely to the data thanks to specific input scaling for each feature.</span>
<span id="cb36-928"><a href="#cb36-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-929"><a href="#cb36-929" aria-hidden="true" tabindex="-1"></a>As expected, we observe that the optimal leaking rate is above 1e-2 for all RC which is coherent with the short term dynamic of covid-19 epidemic. Trends for other hyperparameters are less clear even though best hyperparameters sets were close for RC with common input scaling and for RC with multiple input scaling.</span>
<span id="cb36-930"><a href="#cb36-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-931"><a href="#cb36-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ucHyperparam, echo=FALSE}</span></span>
<span id="cb36-932"><a href="#cb36-932" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ucHyperparam</span></span>
<span id="cb36-933"><a href="#cb36-933" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Hyperparameter evaluation on training set by random search. Hp sets with MAE above 30 were removed for clarity of visualisation."</span></span>
<span id="cb36-934"><a href="#cb36-934" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 7</span></span>
<span id="cb36-935"><a href="#cb36-935" aria-hidden="true" tabindex="-1"></a><span class="in"># hyperparameter search</span></span>
<span id="cb36-936"><a href="#cb36-936" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_reservoir_hp</span></span>
<span id="cb36-937"><a href="#cb36-937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-938"><a href="#cb36-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-939"><a href="#cb36-939" aria-hidden="true" tabindex="-1"></a>@fig-ucHyperparamMultipleIS shows the hyperparameter search for RC with multiple input scaling and connected input layer. We observe that the random search tends to favor high importance given to derivative of positive RT-PCR (including the elderly) and the derivative of IPTCC. The remaining features do not exhibit a clear pattern.</span>
<span id="cb36-940"><a href="#cb36-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-941"><a href="#cb36-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ucHyperparamMultipleIS, echo=FALSE}</span></span>
<span id="cb36-942"><a href="#cb36-942" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ucHyperparamMultipleIS</span></span>
<span id="cb36-943"><a href="#cb36-943" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Hyperparameter evaluation on training set by random search of the model with multiple input scaling and no connection between input layer and output layer. Hp sets with MAE above 30 were removed for clarity of visualisation."</span></span>
<span id="cb36-944"><a href="#cb36-944" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 9</span></span>
<span id="cb36-945"><a href="#cb36-945" aria-hidden="true" tabindex="-1"></a><span class="in"># hyperparameter search, focus on input scaling</span></span>
<span id="cb36-946"><a href="#cb36-946" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_feature_input_scaling</span></span>
<span id="cb36-947"><a href="#cb36-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-948"><a href="#cb36-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-949"><a href="#cb36-949" aria-hidden="true" tabindex="-1"></a><span class="fu">### Forecast performance</span></span>
<span id="cb36-950"><a href="#cb36-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-951"><a href="#cb36-951" aria-hidden="true" tabindex="-1"></a><span class="in">```{r performance, echo = FALSE}</span></span>
<span id="cb36-952"><a href="#cb36-952" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-performance</span></span>
<span id="cb36-953"><a href="#cb36-953" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Model performance with several reservoir configuration. For each setting, 40 reservoirs are computed and the forecast is the median of the 40 forecasts. Results show the performance metrics : MAE = Mean Absolute Error, MRE = Median Relative Error, MAEB = Mean Absolute Error to Baseline, MREB = Median Relative Error to Baseline."</span></span>
<span id="cb36-954"><a href="#cb36-954" aria-hidden="true" tabindex="-1"></a><span class="in"># performance of the different model</span></span>
<span id="cb36-955"><a href="#cb36-955" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$table_perf_esn %&gt;%</span></span>
<span id="cb36-956"><a href="#cb36-956" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::mutate(model = gsub(model,</span></span>
<span id="cb36-957"><a href="#cb36-957" aria-hidden="true" tabindex="-1"></a><span class="in">                             pattern = "IS \n\n", replacement = "IS:")) %&gt;%</span></span>
<span id="cb36-958"><a href="#cb36-958" aria-hidden="true" tabindex="-1"></a><span class="in">  dplyr::rename(</span></span>
<span id="cb36-959"><a href="#cb36-959" aria-hidden="true" tabindex="-1"></a><span class="in">    Model = model,</span></span>
<span id="cb36-960"><a href="#cb36-960" aria-hidden="true" tabindex="-1"></a><span class="in">    MAE = mae,</span></span>
<span id="cb36-961"><a href="#cb36-961" aria-hidden="true" tabindex="-1"></a><span class="in">    MRE = mre,</span></span>
<span id="cb36-962"><a href="#cb36-962" aria-hidden="true" tabindex="-1"></a><span class="in">    MAEB = mae_baseline,</span></span>
<span id="cb36-963"><a href="#cb36-963" aria-hidden="true" tabindex="-1"></a><span class="in">    MREB = mre_baseline</span></span>
<span id="cb36-964"><a href="#cb36-964" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb36-965"><a href="#cb36-965" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(</span></span>
<span id="cb36-966"><a href="#cb36-966" aria-hidden="true" tabindex="-1"></a><span class="in">    digits = 2,</span></span>
<span id="cb36-967"><a href="#cb36-967" aria-hidden="true" tabindex="-1"></a><span class="in">    caption = "Model Performance",</span></span>
<span id="cb36-968"><a href="#cb36-968" aria-hidden="true" tabindex="-1"></a><span class="in">    format = "html" # Use "latex" for LaTeX output or "markdown" for plain Markdown</span></span>
<span id="cb36-969"><a href="#cb36-969" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb36-970"><a href="#cb36-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-971"><a href="#cb36-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-972"><a href="#cb36-972" aria-hidden="true" tabindex="-1"></a>@tbl-performance shows the performance on the test set. Best model according to all metrics was RC with common input scaling and connection between input and output layers. Having one input scaling per feature did not improve the model which might be due to low generalisability of the hyperparameter of the training set to the test set due to non-stationarity. Additionaly, connecting input layer to output layer improved the model forecast. All RC models performed better than the elastic-net model.</span>
<span id="cb36-973"><a href="#cb36-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-974"><a href="#cb36-974" aria-hidden="true" tabindex="-1"></a>@fig-forecastwithorwithoutUpdate shows the forecast of the different models. We note that models struggle to accurately forecast slope shifts. For instance, summer 2021 initial increase is partially predicted by all models but its decrease is not well predicted. Winter 2021 increase is anticipated by all models but they tend to overestimate it because of the rise of vaccine effect.</span>
<span id="cb36-975"><a href="#cb36-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-976"><a href="#cb36-976" aria-hidden="true" tabindex="-1"></a><span class="in">```{r forecastwithorwithoutUpdate, echo = FALSE}</span></span>
<span id="cb36-977"><a href="#cb36-977" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-forecastwithorwithoutUpdate</span></span>
<span id="cb36-978"><a href="#cb36-978" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Reservoir computing forecast depending on the setting with and without monthly update. Red line is the median forecast of 40 reservoirs. Grey lines are individual forecast of each of the 40 reservoirs."</span></span>
<span id="cb36-979"><a href="#cb36-979" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 6</span></span>
<span id="cb36-980"><a href="#cb36-980" aria-hidden="true" tabindex="-1"></a><span class="in"># plot of the forecast of the different models</span></span>
<span id="cb36-981"><a href="#cb36-981" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_forecast</span></span>
<span id="cb36-982"><a href="#cb36-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-983"><a href="#cb36-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-984"><a href="#cb36-984" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of model to aggregate</span></span>
<span id="cb36-985"><a href="#cb36-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-986"><a href="#cb36-986" aria-hidden="true" tabindex="-1"></a>@fig-ucAggregationSpread show the individual forecast for the 40 best sets of hyperparameters of each RC architecture. Due to the internal random connection of the reservoir, we observe forecast stochasticity and relying on only one forecast is unreliable. We explored the number of model needed at @fig-ucAggregationNb which shows that after 10 models, forecast is stable and even 5 models for the simpler model with common input scaling which rely on less hyperparamters.</span>
<span id="cb36-987"><a href="#cb36-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-988"><a href="#cb36-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ucAggregationSpread, echo = FALSE}</span></span>
<span id="cb36-989"><a href="#cb36-989" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ucAggregationSpread</span></span>
<span id="cb36-990"><a href="#cb36-990" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Individual forecast the 40 best hyperparameter sets for the different RC configuration. Forecast value above 200 were set to 200 for clarity."</span></span>
<span id="cb36-991"><a href="#cb36-991" aria-hidden="true" tabindex="-1"></a><span class="in"># plot of different models without forecast aggregation.</span></span>
<span id="cb36-992"><a href="#cb36-992" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_before_aggregation_forecast</span></span>
<span id="cb36-993"><a href="#cb36-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-994"><a href="#cb36-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-995"><a href="#cb36-995" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ucAggregationNb, echo = FALSE}</span></span>
<span id="cb36-996"><a href="#cb36-996" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ucAggregationNb</span></span>
<span id="cb36-997"><a href="#cb36-997" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Mean absolute error depending on the number of aggregated reservoir."</span></span>
<span id="cb36-998"><a href="#cb36-998" aria-hidden="true" tabindex="-1"></a><span class="in"># plot models depending on number of aggregated reservoir.</span></span>
<span id="cb36-999"><a href="#cb36-999" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_aggregation</span></span>
<span id="cb36-1000"><a href="#cb36-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1001"><a href="#cb36-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1002"><a href="#cb36-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">### Input feature importance</span></span>
<span id="cb36-1003"><a href="#cb36-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1004"><a href="#cb36-1004" aria-hidden="true" tabindex="-1"></a>We compared the coefficients of the output layer estimated for the input layer and the reservoir nodes. Additionally, we compared the coefficient given to the input layer by the output layer in the reservoir and the coefficient estimated by the elastic-net model.</span>
<span id="cb36-1005"><a href="#cb36-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1006"><a href="#cb36-1006" aria-hidden="true" tabindex="-1"></a>@fig-importanceReservoir illustrates the ranking of input layer compared to all connections to the output layer, including the 500 reservoir nodes and the 16 features of the input layer (excluding bias). The figure shows that the model with common input scaling tends to assign less weight to input layer compared to the model with multiple input scaling. This suggests that the reservoir with common input scaling provides more information than the reservoir with multiple input scaling, which aligns with its better performance, as shown in Table @tbl-performance.</span>
<span id="cb36-1007"><a href="#cb36-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1008"><a href="#cb36-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```{r importanceReservoir, echo = FALSE}</span></span>
<span id="cb36-1009"><a href="#cb36-1009" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-importanceReservoir</span></span>
<span id="cb36-1010"><a href="#cb36-1010" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Mean feature importance of the 40 best hyperparameter sets by model, focus on the connection between the input and output layers. Models with direct connection between input and output layer are included. The rank is obtained by comparing the feature input layer and all other connection coefficients (both input and reservoir corresponding coefficients) attributed by the output layer at each date for each hyperparameter set. The higher the output layer's coefficient for the input layer, the closer its rank will be to 1 and the more important the feature is."</span></span>
<span id="cb36-1011"><a href="#cb36-1011" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 8</span></span>
<span id="cb36-1012"><a href="#cb36-1012" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot raw feature importance</span></span>
<span id="cb36-1013"><a href="#cb36-1013" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_reservoir_importance</span></span>
<span id="cb36-1014"><a href="#cb36-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1015"><a href="#cb36-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1016"><a href="#cb36-1016" aria-hidden="true" tabindex="-1"></a>Furthermore, @fig-importanceReservoirvsEnet compares the coefficients assigned to input features by the elastic-net model and the RC models. While the coefficients are generally consistent across RC models, there are some notable differences with elastic-net. Specifically, certain features deemed important by the elastic-net model, such as the derivative of RT-PCR, and the derivative of Vaccine, are less important for the reservoir computing model. This may indicate that these features predictive ability is better conveyed by their relationship with other features, which is captured by the reservoir computing model but might not be by the elastic-net model. Conversely, emergency, IPTCC, proportion of positive RT-PCR, and hospitalizations are more important for the reservoir computing model than for the elastic-net model.</span>
<span id="cb36-1017"><a href="#cb36-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1018"><a href="#cb36-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```{r importanceReservoirvsEnet, echo = FALSE}</span></span>
<span id="cb36-1019"><a href="#cb36-1019" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-importanceReservoirvsEnet</span></span>
<span id="cb36-1020"><a href="#cb36-1020" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Mean feature coefficient of the 40 best hyperparameter sets by model and the elastic-net model. Only models with direct connection between input and output layer are included. The coefficients were calculated as the average value across all dates for each feature, model and hyperparamet set."</span></span>
<span id="cb36-1021"><a href="#cb36-1021" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 8</span></span>
<span id="cb36-1022"><a href="#cb36-1022" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot feature importance of different models</span></span>
<span id="cb36-1023"><a href="#cb36-1023" aria-hidden="true" tabindex="-1"></a><span class="in">ls_use_case$plot_importance</span></span>
<span id="cb36-1024"><a href="#cb36-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1025"><a href="#cb36-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1026"><a href="#cb36-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1027"><a href="#cb36-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">## Discussion</span></span>
<span id="cb36-1028"><a href="#cb36-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1029"><a href="#cb36-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1030"><a href="#cb36-1030" aria-hidden="true" tabindex="-1"></a>In this specific application, we have demonstrated that RC exhibits commendable performance in comparison to Elastic-net, which serves as the reference model. Furthermore, we highlight the inherent challenges in forecasting within this context, primarily stemming from the non-stationarity of the time series.</span>
<span id="cb36-1031"><a href="#cb36-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1032"><a href="#cb36-1032" aria-hidden="true" tabindex="-1"></a>All computations in this study were conducted using the <span class="in">`reservoirnet`</span> package, and the entire codebase is accessible on Zenodo <span class="co">[</span><span class="ot">@ferte_thomasfertejss_reservoirnet_2024</span><span class="co">]</span>. This <span class="in">`R`</span> package demonstrates its efficacy in implementing various reservoir architectures, including connection between the input layer and the output layer, as well as the utilization of several input scaling, all within the context of a real-world use case.</span>
<span id="cb36-1033"><a href="#cb36-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1034"><a href="#cb36-1034" aria-hidden="true" tabindex="-1"></a>Given the substantial number of hyperparameters involved, we acknowledge that random search may not be the most efficient optimization algorithm. We have retained this approach for the sake of simplicity in this tutorial paper; however, meta-heuristic approaches, particularly those utilizing evolutionary algorithms, may prove more efficient, especially when employing multiple input scaling <span class="co">[</span><span class="ot">@bala_applications_2018; @ferte_optimizing_2024</span><span class="co">]</span>. </span>
<span id="cb36-1035"><a href="#cb36-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1036"><a href="#cb36-1036" aria-hidden="true" tabindex="-1"></a>This study represents a novel contribution to epidemic forecasting utilizing RC. Notably, previous literature predominantly focused on simpler problems characterized by fewer input features or shorter evaluation periods <span class="co">[</span><span class="ot">@liu_nanophotonic_2023; @ray_optimized_2021; @ghosh_reservoir_2021</span><span class="co">]</span>. Our findings underscore the potential of this approach for future epidemics, suggesting its potential to surpass more traditional epidemiological tools while maintaining a lightweight model structure compared to other RNNs.</span>
<span id="cb36-1037"><a href="#cb36-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1038"><a href="#cb36-1038" aria-hidden="true" tabindex="-1"></a>It is worth noting that all models, including those presented in @ferte_benefit_2022, face challenges in accurately predicting slope shifts, highlighting the need for further investigation. Specifically, additional work is required to extend the application of Reservoir Computing (RC) to high-dimensional settings, building upon insights gained from models that use a more extensive feature set. While RC has demonstrated promising performance for epidemic forecasting in high-dimensional settings, this task remains challenging <span class="co">[</span><span class="ot">@ferte_reservoir_2024</span><span class="co">]</span>.</span>
<span id="cb36-1039"><a href="#cb36-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1040"><a href="#cb36-1040" aria-hidden="true" tabindex="-1"></a>A new perspective may emerge from integrating New Generation Computing, a method inspired by RC and nonlinear vector-autoregression, where expert insights into the non-linear components of the model can be directly embedded within the reservoir <span class="co">[</span><span class="ot">@zhang2022catch22s</span><span class="co">]</span>. Additionally, we observe that reservoir predictions exhibit high instability, requiring the aggregation of multiple predictions to achieve meaningful results. To address this instability, @zhang2024instability suggests implementing stronger penalization techniques that can be updated as more data becomes available or adopting a "training with noise" approach, where noise is added during training for regularization. These approaches could help mitigate instability in reservoir computing as the problem's dimensionality increases.</span>
<span id="cb36-1041"><a href="#cb36-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1042"><a href="#cb36-1042" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion and conclusion {#sec-discussion-and-conclusion}</span></span>
<span id="cb36-1043"><a href="#cb36-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1044"><a href="#cb36-1044" aria-hidden="true" tabindex="-1"></a>In this paper, we introduce the <span class="in">`R`</span> package <span class="in">`reservoirnet`</span>, which serves as a versatile tool for implementing reservoir computing based on <span class="in">`ReservoirPy`</span>'s <span class="in">`Python`</span> library. It offers flexibility in defining the reservoir architecture, including options for specifying connections between the input layer and the output layer, as well as variations in input scaling as demonstrated on a real-world use case.</span>
<span id="cb36-1045"><a href="#cb36-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1046"><a href="#cb36-1046" aria-hidden="true" tabindex="-1"></a>We provided a comprehensive overview of the basic usage of the <span class="in">`reservoirnet`</span> package through illustrative examples in regression and classification tasks. This introductory section serves as a foundation for <span class="in">`R`</span> users, offering step-by-step guidance on constructing and training reservoir computing models using the package. By demonstrating the application of RC in both regression and classification scenarios, we aim to equip users with the essential knowledge and skills needed to harness the capabilities of reservoir computing for diverse tasks.</span>
<span id="cb36-1047"><a href="#cb36-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1048"><a href="#cb36-1048" aria-hidden="true" tabindex="-1"></a>Drawing on the robust foundation of the <span class="in">`ReservoirPy`</span> structure, a well-maintained <span class="in">`Python`</span> library, this package inherits its reliability and longevity. We have focused on providing access to the fundamental features, building upon the strong base provided by <span class="in">`ReservoirPy`</span>. Therefore, this initial version of <span class="in">`reservoirnet`</span> must evolve in tandem with the growing understanding and adoption of RC within the <span class="in">`R`</span> community.</span>
<span id="cb36-1049"><a href="#cb36-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1050"><a href="#cb36-1050" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- # Introduction --&gt;</span></span>
<span id="cb36-1051"><a href="#cb36-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1052"><a href="#cb36-1052" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## About this document --&gt;</span></span>
<span id="cb36-1053"><a href="#cb36-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1054"><a href="#cb36-1054" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This document, accompanied with the [hopefully finely tuned git repos](https://github.com/computorg/template-computo-R/), provides a template for writing contributions to **Computo** [@computo]. We show how `R` code [@R-base] can be included and how the repository can be set up for triggering github actions for rendering the document, with dependencies handled by `renv`. --&gt;</span></span>
<span id="cb36-1055"><a href="#cb36-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1056"><a href="#cb36-1056" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Setup a github repository for preparing your submission --&gt;</span></span>
<span id="cb36-1057"><a href="#cb36-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1058"><a href="#cb36-1058" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- You can start by clicking the **"use this template"** button, on the top of the page of the [github repository associated to this document](https://github.com/computorg/template-computo-R/). Of course, you can set your repository private during the preparation of your manuscript. --&gt;</span></span>
<span id="cb36-1059"><a href="#cb36-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1060"><a href="#cb36-1060" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Quarto --&gt;</span></span>
<span id="cb36-1061"><a href="#cb36-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1062"><a href="#cb36-1062" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- [Quarto](https://quarto.org/) is a versatile formatting system for authoring documents integrating markdown, LaTeX and code blocks interpreted either via Jupyter or Knitr (thus supporting Python, R and Julia). It relies on the [Pandoc](https://pandoc.org/MANUAL.html) document converter. --&gt;</span></span>
<span id="cb36-1063"><a href="#cb36-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1064"><a href="#cb36-1064" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Requirements --&gt;</span></span>
<span id="cb36-1065"><a href="#cb36-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1066"><a href="#cb36-1066" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- You need [quarto](https://quarto.org/) installed on your system and the [Computo extension](https://github.com/computorg/computo-quarto-extension) to prepare your document. For the latter, once quarto is installed,  run the following to install the extension in the current directory (it creates a `_extension` directory which is ignored by git thanks to `.gitignore` by default): --&gt;</span></span>
<span id="cb36-1067"><a href="#cb36-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1068"><a href="#cb36-1068" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```.bash --&gt;</span></span>
<span id="cb36-1069"><a href="#cb36-1069" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- quarto add computorg/computo-quarto-extension --&gt;</span></span>
<span id="cb36-1070"><a href="#cb36-1070" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1071"><a href="#cb36-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1072"><a href="#cb36-1072" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- [`R`](https://www.r-project.org/) and the following `R` packages must be installed on your computer: [`knitr`](https://cran.r-project.org/package=knitr), [`markdown`](https://cran.r-project.org/package=markdown). --&gt;</span></span>
<span id="cb36-1073"><a href="#cb36-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1074"><a href="#cb36-1074" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Link with your usual tools --&gt;</span></span>
<span id="cb36-1075"><a href="#cb36-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1076"><a href="#cb36-1076" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto is expecting a `.qmd` markdown file, but will also works with a standard [`Rmarkdown`](https://rmarkdown.rstudio.com/) (`.Rmd`) file. In addition, especially if you are not comfortable with the command line interface, quarto is fully integrated inside the [Rstudio IDE](https://quarto.org/docs/get-started/hello/rstudio.html) so that you can write and build your quarto document inside Rstudio. --&gt;</span></span>
<span id="cb36-1077"><a href="#cb36-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1078"><a href="#cb36-1078" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto can also process a [Jupyter notebook](https://quarto.org/docs/get-started/hello/jupyter.html) file if you are used to it (it will just require to add the proper YAML metadata^[the same metadata as in the [`template-computo-R.qmd` file](https://github.com/computorg/template-computo-R/blob/main/template-computo-R.qmd) in the first cell, type "Raw", of the notebook]). --&gt;</span></span>
<span id="cb36-1079"><a href="#cb36-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1080"><a href="#cb36-1080" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- **Note**: _More advanced Jupyter-related functionality like Myst/Jupyter book are not supported in this Quarto setup. The markdown syntax inside the Jupyter notebook should follow the Quarto syntax (c.f. [below](#formatting)). If you are more comfortable with using Myst/Jupyter book, we provide a [specific template](https://github.com/computorg/template-computo-myst) but it will requires more formatting work for Computo editorial team, thus highly encourage authors to use the Quarto templates._ --&gt;</span></span>
<span id="cb36-1081"><a href="#cb36-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1082"><a href="#cb36-1082" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- # Formatting --&gt;</span></span>
<span id="cb36-1083"><a href="#cb36-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1084"><a href="#cb36-1084" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- This section covers basic formatting guidelines for quarto documents. --&gt;</span></span>
<span id="cb36-1085"><a href="#cb36-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1086"><a href="#cb36-1086" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- To render a document, run `quarto render`. By default, both PDF and HTML documents are generated: --&gt;</span></span>
<span id="cb36-1087"><a href="#cb36-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1088"><a href="#cb36-1088" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```.bash --&gt;</span></span>
<span id="cb36-1089"><a href="#cb36-1089" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- quarto render template-computo-R.qmd # will render both to html and PDF --&gt;</span></span>
<span id="cb36-1090"><a href="#cb36-1090" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1091"><a href="#cb36-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1092"><a href="#cb36-1092" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {.callout-tip} --&gt;</span></span>
<span id="cb36-1093"><a href="#cb36-1093" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Note --&gt;</span></span>
<span id="cb36-1094"><a href="#cb36-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1095"><a href="#cb36-1095" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- To check the syntax of the formatting below, you can use the `&lt;/&gt; source` button at the top left of this document. --&gt;</span></span>
<span id="cb36-1096"><a href="#cb36-1096" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1097"><a href="#cb36-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1098"><a href="#cb36-1098" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Basic markdown formatting --&gt;</span></span>
<span id="cb36-1099"><a href="#cb36-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1100"><a href="#cb36-1100" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- **Bold text** or _italic_ --&gt;</span></span>
<span id="cb36-1101"><a href="#cb36-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1102"><a href="#cb36-1102" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - This is a list --&gt;</span></span>
<span id="cb36-1103"><a href="#cb36-1103" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - With more elements --&gt;</span></span>
<span id="cb36-1104"><a href="#cb36-1104" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - It isn't numbered. --&gt;</span></span>
<span id="cb36-1105"><a href="#cb36-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1106"><a href="#cb36-1106" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- But we can also do a numbered list --&gt;</span></span>
<span id="cb36-1107"><a href="#cb36-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1108"><a href="#cb36-1108" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1. This is my first item --&gt;</span></span>
<span id="cb36-1109"><a href="#cb36-1109" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2. This is my second item --&gt;</span></span>
<span id="cb36-1110"><a href="#cb36-1110" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 3. This is my third item --&gt;</span></span>
<span id="cb36-1111"><a href="#cb36-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1112"><a href="#cb36-1112" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Mathematics --&gt;</span></span>
<span id="cb36-1113"><a href="#cb36-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1114"><a href="#cb36-1114" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Mathematical formulae --&gt;</span></span>
<span id="cb36-1115"><a href="#cb36-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1116"><a href="#cb36-1116" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- [LaTeX](https://www.latex-project.org/) code is natively supported[^lualatex], which makes it possible to use mathematical formulae: --&gt;</span></span>
<span id="cb36-1117"><a href="#cb36-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1118"><a href="#cb36-1118" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- [^lualatex]: We use [lualatex](https://lualatex.org/) for this purpose. --&gt;</span></span>
<span id="cb36-1119"><a href="#cb36-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1120"><a href="#cb36-1120" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ --&gt;</span></span>
<span id="cb36-1121"><a href="#cb36-1121" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- f(x_1, \dots, x_n; \mu, \sigma^2) = --&gt;</span></span>
<span id="cb36-1122"><a href="#cb36-1122" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \frac{1}{\sigma \sqrt{2\pi}} \exp{\left(- \frac{1}{2\sigma^2}\sum_{i=1}^n(x_i - \mu)^2\right)} --&gt;</span></span>
<span id="cb36-1123"><a href="#cb36-1123" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ --&gt;</span></span>
<span id="cb36-1124"><a href="#cb36-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1125"><a href="#cb36-1125" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- It is also posible to cross-reference an equation, see @eq-mylabel: --&gt;</span></span>
<span id="cb36-1126"><a href="#cb36-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1127"><a href="#cb36-1127" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ --&gt;</span></span>
<span id="cb36-1128"><a href="#cb36-1128" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \begin{aligned} --&gt;</span></span>
<span id="cb36-1129"><a href="#cb36-1129" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- D_{x_N} &amp; = \frac12 --&gt;</span></span>
<span id="cb36-1130"><a href="#cb36-1130" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \left[\begin{array}{cc} --&gt;</span></span>
<span id="cb36-1131"><a href="#cb36-1131" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- x_L^\top &amp; x_N^\top \end{array}\right] \, --&gt;</span></span>
<span id="cb36-1132"><a href="#cb36-1132" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \left[\begin{array}{cc}  L_L &amp; B \\ B^\top &amp; L_N \end{array}\right] \, --&gt;</span></span>
<span id="cb36-1133"><a href="#cb36-1133" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \left[\begin{array}{c} --&gt;</span></span>
<span id="cb36-1134"><a href="#cb36-1134" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- x_L \\ x_N \end{array}\right] \\ --&gt;</span></span>
<span id="cb36-1135"><a href="#cb36-1135" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &amp; = \frac12 (x_L^\top L_L x_L + 2 x_N^\top B^\top x_L + x_N^\top L_N x_N), --&gt;</span></span>
<span id="cb36-1136"><a href="#cb36-1136" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \end{aligned} --&gt;</span></span>
<span id="cb36-1137"><a href="#cb36-1137" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ {#eq-mylabel} --&gt;</span></span>
<span id="cb36-1138"><a href="#cb36-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1139"><a href="#cb36-1139" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Theorems and other amsthem-like environments --&gt;</span></span>
<span id="cb36-1140"><a href="#cb36-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1141"><a href="#cb36-1141" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto includes a nice support for theorems, with predefined prefix labels for theorems, lemmas, proposition, etc. see [this page](https://quarto.org/docs/authoring/cross-references.html#theorems-and-proofs). Here is a simple example: --&gt;</span></span>
<span id="cb36-1142"><a href="#cb36-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1143"><a href="#cb36-1143" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {#thm-slln} --&gt;</span></span>
<span id="cb36-1144"><a href="#cb36-1144" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Strong law of large numbers --&gt;</span></span>
<span id="cb36-1145"><a href="#cb36-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1146"><a href="#cb36-1146" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The sample average converges almost surely to the expected value: --&gt;</span></span>
<span id="cb36-1147"><a href="#cb36-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1148"><a href="#cb36-1148" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$\overline{X}_n\ \xrightarrow{\text{a.s.}}\ \mu \qquad\textrm{when}\ n \to \infty.$$ --&gt;</span></span>
<span id="cb36-1149"><a href="#cb36-1149" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1150"><a href="#cb36-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1151"><a href="#cb36-1151" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- See @thm-slln. --&gt;</span></span>
<span id="cb36-1152"><a href="#cb36-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1153"><a href="#cb36-1153" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## R Code --&gt;</span></span>
<span id="cb36-1154"><a href="#cb36-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1155"><a href="#cb36-1155" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto uses either Jupyter or knitr to render code chunks. This can be triggered in the yaml header. In this tutorial, we use `knitr` (`R` and packages `knitr`, `markdown` must be installed on your computer). --&gt;</span></span>
<span id="cb36-1156"><a href="#cb36-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1157"><a href="#cb36-1157" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` yaml --&gt;</span></span>
<span id="cb36-1158"><a href="#cb36-1158" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --- --&gt;</span></span>
<span id="cb36-1159"><a href="#cb36-1159" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- title: "My Document" --&gt;</span></span>
<span id="cb36-1160"><a href="#cb36-1160" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- author "Jane Doe" --&gt;</span></span>
<span id="cb36-1161"><a href="#cb36-1161" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --- --&gt;</span></span>
<span id="cb36-1162"><a href="#cb36-1162" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1163"><a href="#cb36-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1164"><a href="#cb36-1164" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- `R` code [@R-base] chunks may be embedded as follows: --&gt;</span></span>
<span id="cb36-1165"><a href="#cb36-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1166"><a href="#cb36-1166" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r r-code, echo=TRUE} --&gt;</span></span>
<span id="cb36-1167"><a href="#cb36-1167" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- x &lt;- rnorm(10) --&gt;</span></span>
<span id="cb36-1168"><a href="#cb36-1168" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1169"><a href="#cb36-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1170"><a href="#cb36-1170" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Figures --&gt;</span></span>
<span id="cb36-1171"><a href="#cb36-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1172"><a href="#cb36-1172" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Plots can be generated as follows: --&gt;</span></span>
<span id="cb36-1173"><a href="#cb36-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1174"><a href="#cb36-1174" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r pressure, message = FALSE} --&gt;</span></span>
<span id="cb36-1175"><a href="#cb36-1175" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- library("ggplot2") --&gt;</span></span>
<span id="cb36-1176"><a href="#cb36-1176" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- p &lt;- ggplot(mpg, aes(displ, hwy)) + --&gt;</span></span>
<span id="cb36-1177"><a href="#cb36-1177" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_point() + --&gt;</span></span>
<span id="cb36-1178"><a href="#cb36-1178" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_smooth() --&gt;</span></span>
<span id="cb36-1179"><a href="#cb36-1179" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- p --&gt;</span></span>
<span id="cb36-1180"><a href="#cb36-1180" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1181"><a href="#cb36-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1182"><a href="#cb36-1182" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- It is also possible to create figures from static images: --&gt;</span></span>
<span id="cb36-1183"><a href="#cb36-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1184"><a href="#cb36-1184" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- :::{#fig-logo} --&gt;</span></span>
<span id="cb36-1185"><a href="#cb36-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1186"><a href="#cb36-1186" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ![](https://computo.sfds.asso.fr/assets/img/logo_text_vertical.png){height=200} --&gt;</span></span>
<span id="cb36-1187"><a href="#cb36-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1188"><a href="#cb36-1188" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Computo logo (label) --&gt;</span></span>
<span id="cb36-1189"><a href="#cb36-1189" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1190"><a href="#cb36-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1191"><a href="#cb36-1191" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- **Note:** _Until Quarto version 1.3+ is released, including a remote image (from a web URL) in a document (like the image above) will work in the rendered HTML document but will generate an error when building the PDF document (c.f. [related bug report](https://github.com/quarto-dev/quarto-cli/issues/4443))._ --&gt;</span></span>
<span id="cb36-1192"><a href="#cb36-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1193"><a href="#cb36-1193" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Tables --&gt;</span></span>
<span id="cb36-1194"><a href="#cb36-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1195"><a href="#cb36-1195" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Tables (with label: `@tbl-mylabel` renders @tbl-mylabel) can be generated with markdown as follows --&gt;</span></span>
<span id="cb36-1196"><a href="#cb36-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1197"><a href="#cb36-1197" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- | Tables   |      Are      |  Cool | --&gt;</span></span>
<span id="cb36-1198"><a href="#cb36-1198" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- |----------|:-------------:|------:| --&gt;</span></span>
<span id="cb36-1199"><a href="#cb36-1199" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- | col 1 is |  left-aligned | $1600 | --&gt;</span></span>
<span id="cb36-1200"><a href="#cb36-1200" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- | col 2 is |    centered   |   $12 | --&gt;</span></span>
<span id="cb36-1201"><a href="#cb36-1201" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- | col 3 is | right-aligned |    $1 | --&gt;</span></span>
<span id="cb36-1202"><a href="#cb36-1202" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- : my table caption {#tbl-mylabel} --&gt;</span></span>
<span id="cb36-1203"><a href="#cb36-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1204"><a href="#cb36-1204" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Table can also be generated by some code, for instance with knitr here: --&gt;</span></span>
<span id="cb36-1205"><a href="#cb36-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1206"><a href="#cb36-1206" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r cars} --&gt;</span></span>
<span id="cb36-1207"><a href="#cb36-1207" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- knitr::kable(summary(cars), caption = "Table caption.") --&gt;</span></span>
<span id="cb36-1208"><a href="#cb36-1208" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1209"><a href="#cb36-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1210"><a href="#cb36-1210" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Handling references {#sec-references} --&gt;</span></span>
<span id="cb36-1211"><a href="#cb36-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1212"><a href="#cb36-1212" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Bibliographic references --&gt;</span></span>
<span id="cb36-1213"><a href="#cb36-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1214"><a href="#cb36-1214" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- References are displayed as footnotes using --&gt;</span></span>
<span id="cb36-1215"><a href="#cb36-1215" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- [BibTeX](http://www.bibtex.org/), e.g. `[@computo]` will be displayed --&gt;</span></span>
<span id="cb36-1216"><a href="#cb36-1216" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- as [@computo], where `computo` is the bibtex key for this specific --&gt;</span></span>
<span id="cb36-1217"><a href="#cb36-1217" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- entry. The bibliographic information is automatically retrieved from --&gt;</span></span>
<span id="cb36-1218"><a href="#cb36-1218" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- the `.bib` file specified in the header of this document (here: --&gt;</span></span>
<span id="cb36-1219"><a href="#cb36-1219" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- `references.bib`). --&gt;</span></span>
<span id="cb36-1220"><a href="#cb36-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1221"><a href="#cb36-1221" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Other cross-references --&gt;</span></span>
<span id="cb36-1222"><a href="#cb36-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1223"><a href="#cb36-1223" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- As already (partially) seen, Quarto includes a mechanism similar to the --&gt;</span></span>
<span id="cb36-1224"><a href="#cb36-1224" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- bibliographic references for sections, equations, theorems, figures, --&gt;</span></span>
<span id="cb36-1225"><a href="#cb36-1225" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- lists, etc. Have a look at [this --&gt;</span></span>
<span id="cb36-1226"><a href="#cb36-1226" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- page](https://quarto.org/docs/authoring/cross-references.html). --&gt;</span></span>
<span id="cb36-1227"><a href="#cb36-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1228"><a href="#cb36-1228" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Advanced formatting --&gt;</span></span>
<span id="cb36-1229"><a href="#cb36-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1230"><a href="#cb36-1230" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Advanced formatting features are possible and documented (including interactive plots, pseudo-code, (Tikz) diagrams, Lua filters, mixing R + Python in the same document), but are beyond the scope of this simple introduction. We point several entries in this direction. --&gt;</span></span>
<span id="cb36-1231"><a href="#cb36-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1232"><a href="#cb36-1232" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {.callout-warning} --&gt;</span></span>
<span id="cb36-1233"><a href="#cb36-1233" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## More information --&gt;</span></span>
<span id="cb36-1234"><a href="#cb36-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1235"><a href="#cb36-1235" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - [The Quarto web site](https://quarto.org) for comprehensive documentation, including: --&gt;</span></span>
<span id="cb36-1236"><a href="#cb36-1236" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   + [Tutorial](https://quarto.org/docs/get-started/) --&gt;</span></span>
<span id="cb36-1237"><a href="#cb36-1237" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   + [User guide](https://quarto.org/docs/guide/) --&gt;</span></span>
<span id="cb36-1238"><a href="#cb36-1238" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   + [Options reference](https://quarto.org/docs/reference/) --&gt;</span></span>
<span id="cb36-1239"><a href="#cb36-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1240"><a href="#cb36-1240" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - [The template distributed with the Computo Quarto extension](https://computo.sfds.asso.fr/computo-quarto-extension/), which uses such advanced features. --&gt;</span></span>
<span id="cb36-1241"><a href="#cb36-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1242"><a href="#cb36-1242" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - [Our mock version of the t-SNE paper](https://computo.sfds.asso.fr/published-paper-tsne/), a full and advanced example using Python and the Jupyter kernel. --&gt;</span></span>
<span id="cb36-1243"><a href="#cb36-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1244"><a href="#cb36-1244" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - [The previously published papers in Computo](https://computo.sfds.asso.fr/publications/) can be used as references. --&gt;</span></span>
<span id="cb36-1245"><a href="#cb36-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1246"><a href="#cb36-1246" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1247"><a href="#cb36-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1248"><a href="#cb36-1248" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- # Finalize your submission --&gt;</span></span>
<span id="cb36-1249"><a href="#cb36-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1250"><a href="#cb36-1250" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Handle `R` dependencies with `renv` --&gt;</span></span>
<span id="cb36-1251"><a href="#cb36-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1252"><a href="#cb36-1252" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- To make your work reproducible, you need to fix the packages and environment used to run your analysis. For the `R` system, the `renv` package is one of the possible reliable method, supported by the community. You basically need a couple of commands to setup your environment on your local machine. First, --&gt;</span></span>
<span id="cb36-1253"><a href="#cb36-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1254"><a href="#cb36-1254" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r, eval = FALSE} --&gt;</span></span>
<span id="cb36-1255"><a href="#cb36-1255" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- renv::init() --&gt;</span></span>
<span id="cb36-1256"><a href="#cb36-1256" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1257"><a href="#cb36-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1258"><a href="#cb36-1258" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- will initialize your repository. Then you just need to install the dependencies required to run your contribution, for instance,  --&gt;</span></span>
<span id="cb36-1259"><a href="#cb36-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1260"><a href="#cb36-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1261"><a href="#cb36-1261" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r, eval=FALSE} --&gt;</span></span>
<span id="cb36-1262"><a href="#cb36-1262" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- renv::install("ggplot2") # or equivalently install.packages("ggplot2") --&gt;</span></span>
<span id="cb36-1263"><a href="#cb36-1263" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1264"><a href="#cb36-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1265"><a href="#cb36-1265" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Non-CRAN packages (*e.g.* Github packages) can be used. Once you are done, you can fix everything with the command --&gt;</span></span>
<span id="cb36-1266"><a href="#cb36-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1267"><a href="#cb36-1267" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r, eval=FALSE} --&gt;</span></span>
<span id="cb36-1268"><a href="#cb36-1268" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- renv::snapshot() --&gt;</span></span>
<span id="cb36-1269"><a href="#cb36-1269" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1270"><a href="#cb36-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1271"><a href="#cb36-1271" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {.callout-important} --&gt;</span></span>
<span id="cb36-1272"><a href="#cb36-1272" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The only file that needs to be versioned by git is `renv.lock`. By default, the rest is ignored thanks to `.gitignore`.  --&gt;</span></span>
<span id="cb36-1273"><a href="#cb36-1273" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1274"><a href="#cb36-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1275"><a href="#cb36-1275" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- More details for using `renv` can be found either --&gt;</span></span>
<span id="cb36-1276"><a href="#cb36-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1277"><a href="#cb36-1277" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - on the [`renv` packge webpage](https://rstudio.github.io/renv/articles/renv.html), or --&gt;</span></span>
<span id="cb36-1278"><a href="#cb36-1278" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- - on the [quarto page dedicated to environments](https://quarto.org/docs/projects/virtual-environments.html#using-renv) --&gt;</span></span>
<span id="cb36-1279"><a href="#cb36-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1280"><a href="#cb36-1280" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Continuous integration --&gt;</span></span>
<span id="cb36-1281"><a href="#cb36-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1282"><a href="#cb36-1282" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The repository associated with this template is pre-configure to trigger an action on push that performs the following: --&gt;</span></span>
<span id="cb36-1283"><a href="#cb36-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1284"><a href="#cb36-1284" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1. Check out repository on the `ubuntu-latest` machine --&gt;</span></span>
<span id="cb36-1285"><a href="#cb36-1285" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2. Install quarto and dependencies, including the Computo extension --&gt;</span></span>
<span id="cb36-1286"><a href="#cb36-1286" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 3. Install R and dependencies with `renv`, using your `renv.lock` file --&gt;</span></span>
<span id="cb36-1287"><a href="#cb36-1287" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 4. Render your .qmd file and Publish the results on a gh-page (both HTML and PDF) --&gt;</span></span>
<span id="cb36-1288"><a href="#cb36-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1289"><a href="#cb36-1289" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The file [.github/workflows/build.yml](https://github.com/computorg/template-computo-R/blob/main/.github/workflows/build.yml) is largely inspired from [this file](https://quarto.org/docs/publishing/github-pages.html#example-knitr-with-renv). --&gt;</span></span>
<span id="cb36-1290"><a href="#cb36-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1291"><a href="#cb36-1291" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Once this is successful, you are ready to submit your manuscript to the [Computo submission platform](https://computo.scholasticahq.com/). --&gt;</span></span>
<span id="cb36-1292"><a href="#cb36-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1293"><a href="#cb36-1293" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {.callout-warning} --&gt;</span></span>
<span id="cb36-1294"><a href="#cb36-1294" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The first time, you possibly need to create the branch for the action to work. This can be done by running the following command from your computer, in your git repository: --&gt;</span></span>
<span id="cb36-1295"><a href="#cb36-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1296"><a href="#cb36-1296" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```.bash --&gt;</span></span>
<span id="cb36-1297"><a href="#cb36-1297" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- quarto publish gh-pages --&gt;</span></span>
<span id="cb36-1298"><a href="#cb36-1298" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb36-1299"><a href="#cb36-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1300"><a href="#cb36-1300" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Then, set the branch `gh-page` as the source of your github page, and trigger the action to check that everything works fine. --&gt;</span></span>
<span id="cb36-1301"><a href="#cb36-1301" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: --&gt;</span></span>
<span id="cb36-1302"><a href="#cb36-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1303"><a href="#cb36-1303" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Data and large files --&gt;</span></span>
<span id="cb36-1304"><a href="#cb36-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1305"><a href="#cb36-1305" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- If your submission materials contain files larger than 50MB, **especially data files**, they won’t fit on a git repository as is. For this reason, we encourage you to put your data or any materials you deem necessary on an external “open data” centered repository hub such a [Zenodo](https://zenodo.org/) or [OSF](https://osf.io/). --&gt;</span></span>
<span id="cb36-1306"><a href="#cb36-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1307"><a href="#cb36-1307" aria-hidden="true" tabindex="-1"></a><span class="fu"># Acknowledgements {.unnumbered}</span></span>
<span id="cb36-1308"><a href="#cb36-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1309"><a href="#cb36-1309" aria-hidden="true" tabindex="-1"></a>We thank Romain Griffier for his expertise on the Bordeaux University Hospital Data.</span>
<span id="cb36-1310"><a href="#cb36-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1311"><a href="#cb36-1311" aria-hidden="true" tabindex="-1"></a>Experiments presented in this paper were conducted using the PlaFRIM experimental testbed, supported by Inria, CNRS (LABRI and IMB), Université de Bordeaux, Bordeaux INP and Conseil Régional d’Aquitaine (see https://www.plafrim.fr), as well as by the MCIA (Mésocentre de Calcul Intensif Aquitain).</span>
<span id="cb36-1312"><a href="#cb36-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1313"><a href="#cb36-1313" aria-hidden="true" tabindex="-1"></a>This study was carried out in the framework of the University of Bordeaux's France 2030 program / RRI PHDS.</span>
<span id="cb36-1314"><a href="#cb36-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1315"><a href="#cb36-1315" aria-hidden="true" tabindex="-1"></a><span class="fu"># References {.unnumbered}</span></span>
<span id="cb36-1316"><a href="#cb36-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1317"><a href="#cb36-1317" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb36-1318"><a href="#cb36-1318" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-1319"><a href="#cb36-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1320"><a href="#cb36-1320" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information {.appendix .unnumbered}</span></span>
<span id="cb36-1321"><a href="#cb36-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1322"><a href="#cb36-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session-info}</span></span>
<span id="cb36-1323"><a href="#cb36-1323" aria-hidden="true" tabindex="-1"></a><span class="in">sessionInfo()</span></span>
<span id="cb36-1324"><a href="#cb36-1324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.captionPrefix || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  




</body></html>